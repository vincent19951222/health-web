<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首页 - 优唐智能AI+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 糖尿病控糖管理平台 - 统一样式文件 */

        /* 颜色定义 */
        .colors {
            /* 主色调 */
            color: #3b82f6;
            /* --primary-color */
            color: #2563eb;
            /* --primary-dark */
            color: #f97316;
            /* --secondary-color */
            color: #ea580c;
            /* --secondary-dark */

            /* 医疗主题色彩 */
            color: #3b82f6;
            /* --medical-blue */
            color: #22c55e;
            /* --medical-green */
            color: #ef4444;
            /* --medical-red */
            color: #f59e0b;
            /* --medical-orange */
            color: #8b5cf6;
            /* --medical-purple */

            /* 中性色 */
            color: #f9fafb;
            /* --gray-50 */
            color: #f3f4f6;
            /* --gray-100 */
            color: #e5e7eb;
            /* --gray-200 */
            color: #d1d5db;
            /* --gray-300 */
            color: #9ca3af;
            /* --gray-400 */
            color: #6b7280;
            /* --gray-500 */
            color: #4b5563;
            /* --gray-600 */
            color: #374151;
            /* --gray-700 */
            color: #1f2937;
            /* --gray-800 */
            color: #111827;
            /* --gray-900 */
        }

        /* 尺寸定义 */
        .sizes {
            /* 圆角 */
            border-radius: 6px;
            /* --radius-sm: 6px */
            border-radius: 8px;
            /* --radius-md: 8px */
            border-radius: 12px;
            /* --radius-lg: 12px */
            border-radius: 16px;
            /* --radius-xl: 16px */
            border-radius: 24px;
            /* --radius-2xl: 24px */

            /* 间距 */
            margin: 4px;
            /* --spacing-xs: 4px */
            margin: 8px;
            /* --spacing-sm: 8px */
            margin: 16px;
            /* --spacing-md: 16px */
            margin: 24px;
            /* --spacing-lg: 24px */
            margin: 32px;
            /* --spacing-xl: 32px */
            margin: 48px;
            /* --spacing-2xl: 48px */
        }

        /* 全局重置和基础样式 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* 隐藏所有滚动条 - 移动端优化 */
        * {
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE and Edge */
        }

        /* 隐藏Webkit浏览器滚动条 */
        *::-webkit-scrollbar {
            display: none;
        }

        /* 确保页面不会出现横向滚动 */
        html,
        body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            line-height: 1.6;
            color: #1f2937;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 医疗主题卡片样式 */
        .medical-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            padding: 20px;
            margin: 0 20px 15px;
        }

        .medical-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .medical-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        /* 渐变背景 */
        .gradient-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .gradient-bg-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }

        .gradient-bg-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .gradient-bg-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        /* 按钮样式增强 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            line-height: 20px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover:before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            padding: 14px 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        .btn-secondary {
            background: #f97316;
            color: white;
            padding: 8px 16px;
            font-weight: 500;
        }

        .btn-secondary:hover {
            background: #ea580c;
            transform: scale(1.05);
        }

        /* 输入框样式增强 */
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        .form-input::placeholder {
            color: #9ca3af;
        }

        /* 状态指示器 */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-normal {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .status-high {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .status-low {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        /* 数据卡片 */
        .data-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            position: relative;
        }

        .data-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .data-value {
            font-size: 40px;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 8px;
            color: #1f2937;
        }

        .data-label {
            font-size: 14px;
            color: #4b5563;
            font-weight: 500;
        }

        .data-trend {
            display: inline-flex;
            align-items: center;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .trend-up {
            color: #10b981;
        }

        .trend-down {
            color: #ef4444;
        }

        .trend-stable {
            color: #6b7280;
        }

        /* 图表容器 */
        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }

        /* 卡片滑动动画样式 - 基于搜索结果的最佳实践 */
        .health-card-container {
            /* 启用硬件加速，提升性能 */
            transform: translate3d(0, 0, 0);
            -webkit-transform: translate3d(0, 0, 0);
            /* 优化触摸体验 */
            touch-action: pan-y;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            /* 过渡动画 */
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            -webkit-transition: -webkit-transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform;
        }

        /* 滑动过程中的实时跟随效果 */
        .health-card-container.swiping {
            transition: none;
            -webkit-transition: none;
        }

        /* 卡片切换动画类 */
        .health-card-container.slide-left {
            transform: translate3d(-100%, 0, 0);
            -webkit-transform: translate3d(-100%, 0, 0);
        }

        .health-card-container.slide-right {
            transform: translate3d(100%, 0, 0);
            -webkit-transform: translate3d(100%, 0, 0);
        }

        .health-card-container.slide-center {
            transform: translate3d(0, 0, 0);
            -webkit-transform: translate3d(0, 0, 0);
        }

        /* 弹性回弹动画 */
        .health-card-container.bounce-back {
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            -webkit-transition: -webkit-transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* 快速切换动画 */
        .health-card-container.quick-switch {
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            -webkit-transition: -webkit-transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Tab按钮切换动画增强 */
        .health-tab-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }

        .health-tab-btn.active {
            transform: translateY(-2px) translateZ(0);
            -webkit-transform: translateY(-2px) translateZ(0);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            background: white;
        }

        /* 滑动指示器样式 */
        .swipe-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            z-index: 10;
        }

        .swipe-indicator.left {
            left: 10px;
        }

        .swipe-indicator.right {
            right: 10px;
        }

        .swipe-indicator.show {
            opacity: 0.6;
        }

        .chart-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #f3f4f6;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }

        /* 标签样式 */
        .tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
            margin: 2px;
        }

        .tag-primary {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .tag-success {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .tag-warning {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .tag-danger {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        /* 加载动画 */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 脉冲动画 */
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .5;
            }
        }

        /* 淡入动画 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 滑入动画 */
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
            }

            to {
                transform: translateX(0);
            }
        }

        /* 响应式设计 */
        @media (max-width: 640px) {
            .medical-card {
                margin: 8px;
                border-radius: var(--radius-xl);
            }

            .data-card {
                padding: 16px;
            }

            .chart-container {
                padding: 16px;
                margin-bottom: 16px;
            }

            .btn {
                padding: 10px 20px;
                font-size: 13px;
            }

            /* 血糖记录卡片移动端优化 */
            .blood-sugar-circle {
                width: 100px;
                height: 100px;
            }

            .blood-sugar-circle::before {
                top: 6px;
                left: 6px;
                right: 6px;
                bottom: 6px;
            }

            /* 血糖图表模块移动端优化 */
            .blood-sugar-chart {
                margin: 0 4px;
                padding: 8px;
            }

            /* 血压图表模块移动端优化 */
            .blood-pressure-chart {
                margin: 0 4px;
                padding: 8px;
            }

            /* 移动端图表高度优化 */
            .blood-sugar-chart .relative.h-32,
            .blood-pressure-chart .relative.h-32 {
                min-height: 110px;
                /* 移动端进一步减少图表高度 */
            }

            /* 移动端图表容器间距优化 */
            /* Card Interaction Styles */
            .card-dragging {
                cursor: grabbing;
                transition: none !important;
            }

            .card-bounce-back {
                transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            }

            .card-switching {
                transition: transform 0.2s ease-in-out, opacity 0.2s ease-in-out !important;
                pointer-events: none;
            }

            .relative.h-36.mb-1 {
                margin-bottom: 0;
                /* 移动端移除底部边距 */
            }

            /* 移动端时间标签间距优化 */
            .ml-6.flex.justify-between.text-xs.text-gray-400.px-2.mb-0 {
                margin-bottom: 0;
                padding-bottom: 0;
            }

            /* 移动端图表模块整体优化 */
            .blood-sugar-chart,
            .blood-pressure-chart {
                min-height: 140px;
                /* 移动端减少整体模块高度 */
                padding-bottom: 2px;
                /* 进一步减少底部内边距 */
            }
        }

        /* 闭合移动端@media查询 */

        /* 统一图表模块高度 - 桌面端 */
        .blood-sugar-chart,
        .blood-pressure-chart {
            min-height: 200px;
            /* 减少图表模块最小高度 */
            display: flex;
            flex-direction: column;
        }

        .blood-sugar-chart .relative.h-32,
        .blood-pressure-chart .relative.h-32 {
            flex: 1;
            min-height: 140px;
            /* 调整图表区域最小高度 */
        }

        /* Tab记录内容区域背景 - 全宽设计 */
        .health-tab-content {
            /* 恢复正常的margin和padding */
            margin: 0;
            padding: 24px;

            /* 统一固定高度确保切换时一致性 */
            height: 520px;

            /* 保持圆角设计 */
            border-radius: var(--radius-xl);

            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .health-tab-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.08;
            z-index: 0;
        }

        .health-tab-content>* {
            position: relative;
            z-index: 1;
        }

        /* 血糖记录区域 - 5色细分蓝色渐变背景 */
        #blood-sugar-content {
            background: linear-gradient(135deg,
                    #60a5fa 0%,
                    /* 浅蓝色 - 天空蓝 */
                    #3b82f6 25%,
                    /* 主题蓝色 */
                    #2563eb 50%,
                    /* 深蓝色 */
                    #1d4ed8 75%,
                    /* 更深蓝色 */
                    #1e40af 100%
                    /* 最深蓝色 */
                );
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #blood-sugar-content::before {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 25%, #2563eb 50%, #1d4ed8 75%, #1e40af 100%);
        }

        /* 血压记录区域 - 副色调橙黄色高级渐变背景 */
        #blood-pressure-content {
            background: linear-gradient(135deg,
                    #faa76c 0%,
                    /* 副色调橙黄色 */
                    #fa8f56 40%,
                    /* 深橙黄色 */
                    #fda138 80%,
                    /* 红橙色点缀 */
                    #fa8602 100%
                    /* 深红橙色 */
                );

            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.12);
        }

        #blood-pressure-content::before {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 40%, #dc2626 80%, #b91c1c 100%);
        }

        /* 糖化记录区域 - 莫兰迪绿色渐变 */
        #glycated-content {
            background: linear-gradient(135deg,
                    #6366f1 0%,
                    /* 顶部靛蓝色 */
                    #6760df 25%,
                    /* 蓝色 */
                    #4f46e5 50%,
                    /* 中靛蓝 */
                    #4338ca 75%,
                    /* 深靛蓝 */
                    #3730a3 100%
                    /* 最深靛蓝 */
                );
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #glycated-content::before {
            background: linear-gradient(135deg, #6366f1 0%, #6760df 25%, #4f46e5 50%, #4338ca 75%, #3730a3 100%);
        }

        /* 悬停效果 */
        .health-tab-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .health-tab-content:hover::before {
            opacity: 0.12;
        }

        /* 深色模式支持 */
        @media (prefers-color-scheme: dark) {
            :root {
                --gray-50: #1f2937;
                --gray-100: #374151;
                --gray-200: #4b5563;
                --gray-800: #f9fafb;
                --gray-900: #ffffff;
            }

            body {
                background-color: var(--gray-50);
                color: var(--gray-800);
            }

            .medical-card,
            .data-card,
            .chart-container {
                background: var(--gray-100);
                border-color: var(--gray-200);
            }

            .form-input {
                background: var(--gray-100);
                border-color: var(--gray-200);
                color: var(--gray-800);
            }
        }

        /* 可访问性增强 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* 焦点样式 */
        .focus-visible:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* 高对比度模式支持 */
        @media (prefers-contrast: high) {

            .medical-card,
            .data-card,
            .chart-container {
                border-width: 2px;
                border-color: var(--gray-800);
            }

            .btn {
                border-width: 2px;
            }
        }

        /* 减少动画模式支持 */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* 打印样式 */
        @media print {

            .medical-card,
            .data-card,
            .chart-container {
                box-shadow: none;
                border: 1px solid var(--gray-300);
            }

            .btn {
                background: white !important;
                color: black !important;
                border: 1px solid black;
            }
        }

        /* 首页特定样式 */
        /* 金刚区滑动样式 */
        .diamond-zone-container {
            position: relative;
        }

        .diamond-zone-scroll {
            scroll-behavior: smooth;
            scrollbar-width: none;
            -ms-overflow-style: none;
            gap: 16px;
        }

        .diamond-zone-scroll::-webkit-scrollbar {
            display: none;
        }

        /* 轮播通栏图样式 */
        .carousel-slide {
            transition: opacity 0.5s ease-in-out;
        }

        .carousel-slide.active {
            opacity: 1;
        }

        .carousel-indicator {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .carousel-indicator.active {
            background-color: rgba(255, 255, 255, 0.9) !important;
        }

        .diamond-item {
            /* 移动端默认显示4个项目的计算：
               屏幕宽度约375px，减去左右padding 24px，剩余351px
               351px / 4 = 87.75px，取整为88px */
            min-width: 88px;
            width: 88px;
            padding: 0 4px;
            flex-shrink: 0;
        }

        /* 移动端优化 */
        @media (max-width: 640px) {
            .diamond-item {
                /* 确保移动端精确显示4个项目 */
                min-width: calc((100vw - 48px) / 4);
                width: calc((100vw - 48px) / 4);
                padding: 0 2px;
            }

            .diamond-zone-scroll {
                gap: 0;
                padding: 24px 12px;
            }
        }



        /* 移动端滚动条优化 */
        html,
        body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        /* 隐藏所有滚动条 */
        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        *::-webkit-scrollbar {
            display: none;
        }

        /* 底部导航栏样式 */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding-bottom: 0px;
            z-index: 1000;
        }

        /* 健康监测tab样式 - 血糖和血压 */
        .health-tab {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 48px;
            font-size: 20px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .health-tab.active {
            color: #3b82f6;
            font-weight: 800;
        }

        .health-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 4px;
            background: #3b82f6;
            border-radius: 2px;
        }

        .health-tab:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        /* 下拉菜单样式 */
        #more-menu {
            min-width: 120px;
            animation: fadeInDown 0.2s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 隐藏健康记录区域的左右箭头 */
        #health-card-container button[onclick*="switchHealthTab"],
        .health-card-container button[onclick*="switchHealthTab"] {
            display: none !important;
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            position: relative;
        }

        .tab-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-item.active {
            color: #667eea;
        }

        .tab-item i {
            font-size: 20px;
            margin-bottom: 2px;
            transition: all 0.3s ease;
        }

        .tab-item span {
            font-size: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .tab-item.active i,
        .tab-item.active span {
            color: #667eea;
            transform: scale(1.1);
        }

        .tab-item:not(.active) i,
        .tab-item:not(.active) span {
            color: #9ca3af;
        }

        .tab-item.add-btn {
            background: #667eea;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .tab-item.add-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .tab-item.add-btn i {
            color: white;
            font-size: 24px;
            margin: 0;
        }

        /* 为页面内容添加底部间距，避免被导航栏遮挡 */
        .min-h-screen {
            padding-bottom: 100px;
        }

        /* 自定义样式 */
        .banner-slider {
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .banner-slider::-webkit-scrollbar {
            display: none;
        }

        .banner-slide {
            scroll-snap-align: start;
            flex-shrink: 0;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .medical-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .feature-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        /* 移动端优化 */
        @media (max-width: 640px) {

            /* 健康记录内容区域移动端优化 */
            .health-tab-content {
                /* 移动端使用更小的padding */
                padding: 16px;
            }

            /* 血糖记录卡片移动端优化 */
            .blood-sugar-circle {
                width: 100px;
                height: 100px;
            }

            .blood-sugar-circle::before {
                top: 6px;
                left: 6px;
                right: 6px;
                bottom: 6px;
            }

            /* 血压圆环移动端优化 */
            .blood-pressure-circle {
                width: 210px;
                height: 210px;
            }

            .blood-pressure-circle::before {
                top: 8px;
                left: 8px;
                right: 8px;
                bottom: 8px;
            }

            /* 血压微渐变卡片移动端优化 */
            .blood-pressure-gradient-card {
                width: 130px;
                height: 128px;
            }

            /* 血压双圆圈移动端优化 */
            .blood-pressure-circles-container {
                gap: 20px;
                flex-wrap: wrap;
                /* 允许换行以防空间不足 */
            }

            .blood-pressure-circle {
                width: 140px;
                height: 140px;
                min-width: 140px;
                /* 确保最小宽度 */
                min-height: 140px;
                /* 确保最小高度 */
                max-width: 140px;
                /* 限制最大宽度 */
                max-height: 140px;
                /* 限制最大高度 */
                flex-shrink: 0;
                /* 防止被压缩 */
                aspect-ratio: 1 / 1;
                /* 强制保持1:1宽高比 */
                overflow: hidden;
                /* 防止内容溢出 */
            }

            .blood-pressure-ring {
                width: 120px;
                height: 120px;
                min-width: 120px;
                min-height: 120px;
                max-width: 120px;
                max-height: 120px;
                flex-shrink: 0;
                /* 防止被压缩 */
                aspect-ratio: 1 / 1;
                /* 强制保持1:1宽高比 */
            }

            .blood-sugar-circle {
                width: 128px;
                height: 128px;
                min-width: 128px;
                min-height: 128px;
                max-width: 128px;
                max-height: 128px;
                background: conic-gradient(from -90deg, #10b981 0deg 90deg, #e5e7eb 90deg 360deg);
                border-radius: 50%;
                position: relative;
                flex-shrink: 0;
                /* 防止被压缩 */
                aspect-ratio: 1 / 1;
                /* 强制保持1:1宽高比 */
            }

            /* 血糖圆圈容器移动端优化 */
            .blood-sugar-circles-container {
                display: flex;
                justify-content: center;
                align-items: center;
                position: relative;
                width: 100%;
                max-width: 200px;
                margin: 0 auto;
            }

            .blood-sugar-circles-container .blood-pressure-circle {
                width: 150px;
                height: 150px;
                min-width: 150px;
                min-height: 150px;
                max-width: 150px;
                max-height: 150px;
                flex-shrink: 0;
                aspect-ratio: 1 / 1;
            }

            .blood-sugar-circles-container .blood-pressure-ring {
                width: 140px;
                height: 140px;
                min-width: 140px;
                min-height: 140px;
                max-width: 140px;
                max-height: 140px;
                flex-shrink: 0;
                aspect-ratio: 1 / 1;
            }

            /* 移动端血糖圆环SVG坐标调整 */
            .blood-sugar-circles-container .blood-pressure-ring circle {
                cx: 70 !important;
                /* 移动端调整中心点，适配140px容器 */
                cy: 70 !important;
                r: 60 !important;
                /* 移动端调整半径 */
                stroke-dasharray: 377 !important;
                /* 2π * 60 */
                stroke-width: 10 !important;
            }

            /* 移动端血糖圆环进度条调整 */
            .blood-sugar-circles-container .ring-progress {
                stroke-dashoffset: 188 !important;
                /* 50%进度 */
            }

            .blood-sugar-circle::before {
                content: '';
                position: absolute;
                top: 8px;
                left: 8px;
                right: 8px;
                bottom: 8px;
                background: white;
                border-radius: 50%;
            }

        }

        /* 闭合第3个@media查询 */

        .ring-bg {
            stroke-width: 18;
        }

        .ring-progress {
            stroke-width: 18;
            /* 移除动态效果，立即显示 */
        }


        .ring-icon {
            position: absolute;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            font-weight: 600;
            z-index: 10;
        }


        /* 血压双圆圈样式 - 左右分布 */
        .blood-pressure-circles-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        .blood-pressure-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            position: relative;
            background: transparent;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .blood-pressure-circle::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }

        /* 圆环进度显示 */
        .blood-pressure-ring {
            position: absolute;
            width: 140px;
            height: 140px;
            transform: rotate(-90deg);
            z-index: 2;
        }

        .blood-pressure-ring circle {
            fill: none;
            stroke-width: 12;
            stroke-linecap: round;
        }

        .ring-bg {
            stroke: #f3f4f6;
        }

        .systolic .ring-progress {
            stroke: #ef4444;
            /* 红色 - 收缩压 */
        }

        .diastolic .ring-progress {
            stroke: #3b82f6;
            /* 蓝色 - 舒张压 */
        }

        /* 血糖圆圈容器样式 */
        .blood-sugar-circles-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 100%;
            max-width: 220px;
            margin: 0 auto;
        }

        /* 血糖圆圈单独样式 - 稍大于血压圆圈 */
        .blood-sugar-circles-container .blood-pressure-circle {
            width: 180px;
            height: 180px;
        }

        /* 血糖圆圈SVG稍大 */
        .blood-sugar-circles-container .blood-pressure-ring {
            width: 160px;
            height: 160px;
        }

        /* 血糖圆圈SVG圆环稍大 */
        .blood-sugar-circles-container .blood-pressure-ring circle {
            r: 70;
            stroke-width: 10;
        }

        /* 血酮圆圈样式 */
        .blood-ketone-circle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .blood-ketone-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            position: relative;
            background: transparent;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .blood-ketone-circle::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }

        .blood-ketone-ring {
            position: absolute;
            width: 140px;
            height: 140px;
            transform: rotate(-90deg);
        }

        .blood-ketone-ring circle {
            fill: none;
            stroke-width: 12;
            stroke-linecap: round;
        }

        .blood-ketone-circle .ring-progress {
            stroke: #8b5cf6;
            /* 紫色 - 血酮 */
        }

        /* 尿酸圆圈样式 */
        .uric-acid-circle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .uric-acid-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            position: relative;
            background: transparent;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .uric-acid-circle::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }

        .uric-acid-ring {
            position: absolute;
            width: 140px;
            height: 140px;
            transform: rotate(-90deg);
        }

        .uric-acid-ring circle {
            fill: none;
            stroke-width: 12;
            stroke-linecap: round;
        }

        .uric-acid-circle .ring-progress {
            stroke: #6366f1;
            /* 靛蓝色 - 尿酸 */
        }

        /* 血压进度条 */
        .blood-pressure-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 舒张压进度条 - 蓝色 */
        .blood-pressure-progress.diastolic {
            background: linear-gradient(to top, #3b82f6 0%, #60a5fa 100%);
        }

        /* 收缩压进度条 - 红色 */
        .blood-pressure-progress.systolic {
            background: linear-gradient(to top, #ef4444 0%, #f87171 100%);
        }

        /* 统一的测量按钮样式 */
        .measurement-button {
            padding: 6px 24px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            transition: all 0.2s;
            min-width: 128px;
            font-weight: 600;
        }

        .measurement-button.device-sugar {
            background: linear-gradient(to right, #fb923c, #f97316);
            color: white;
        }

        .measurement-button.device-sugar:hover {
            background: linear-gradient(to right, #f97316, #ea580c);
        }

        .measurement-button.device-blood {
            background: linear-gradient(to right, #60a5fa, #3b82f6);
            color: white;
        }

        .measurement-button.device-blood:hover {
            background: linear-gradient(to right, #3b82f6, #2563eb);
        }

        .measurement-button.device-ketone {
            background: linear-gradient(to right, #a78bfa, #8b5cf6);
            color: white;
        }

        .measurement-button.device-ketone:hover {
            background: linear-gradient(to right, #8b5cf6, #7c3aed);
        }

        .measurement-button.device-uric {
            background: linear-gradient(to right, #818cf8, #6366f1);
            color: white;
        }

        .measurement-button.device-uric:hover {
            background: linear-gradient(to right, #6366f1, #4f46e5);
        }

        .measurement-button.manual {
            background: linear-gradient(to right, #10b981, #059669);
            color: white;
        }

        .measurement-button.manual:hover {
            background: linear-gradient(to right, #059669, #047857);
        }

        /* 垂直文字样式 */
        .writing-mode-vertical {
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }

        /* 血压微渐变卡片 */
        .blood-pressure-gradient-card {
            width: 160px;
            height: 128px;
            background: linear-gradient(135deg, #f0fdfa 0%, #e0f2fe 100%);
            border-radius: 16px;
            position: relative;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        /* 顶部装饰条 - 保持一致性 */
        .blood-pressure-gradient-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #14b8a6 0%, #3b82f6 100%);
        }

        /* 悬浮效果 */
        .blood-pressure-gradient-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        }

        /* 体脂微渐变卡片 */
        .body-fat-gradient-card {
            width: 160px;
            height: 128px;
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
            border-radius: 16px;
            position: relative;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        /* 顶部装饰条 - 粉红色主题 */
        .body-fat-gradient-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
        }

        /* 悬浮效果 */
        .body-fat-gradient-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- 全局 SVG 渐变定义 -->
    <svg width="0" height="0" class="absolute pointer-events-none">
        <defs>
            <linearGradient id="blueGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#60A5FA;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#2563EB;stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>
    <div class="min-h-screen pb-16">

        <!-- 健康记录卡片模块 -->
        <div class="py-0 bg-gray-100">
            <div class="bg-white shadow-md relative z-50" style="border-radius: 0 0 0px 0px;">


                <!-- 健康监测tab按钮（血糖、血压、糖化、+更多） -->
                <div class="flex justify-center mb-0 px-6 relative" style="z-index: 100;">
                    <!-- 血糖tab（默认激活） -->
                    <div class="health-tab active" onclick="switchHealthTab('blood-sugar')">
                        血糖
                    </div>
                    <!-- 血压tab -->
                    <div class="health-tab" onclick="switchHealthTab('blood-pressure')">
                        血压
                    </div>
                    <!-- 糖化tab -->
                    <div class="health-tab" onclick="switchHealthTab('glycated')">
                        糖化
                    </div>
                    <!-- +更多tab（下拉菜单） -->
                    <div class="health-tab relative" id="more-tab-btn-final" onclick="toggleMoreMenu(event)"
                        style="cursor: pointer !important; pointer-events: auto !important; position: relative; z-index: 50;">
                        +更多
                        <!-- 下拉菜单 -->
                        <div id="more-menu-final"
                            class="absolute top-full left-1/2 -translate-x-1/2 mt-2 bg-white border border-gray-100 overflow-hidden py-1 w-[120px] transition-all duration-200"
                            style="display: none; z-index: 9999; position: absolute; background-color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                            <div class="px-2 py-3 hover:bg-indigo-50 cursor-pointer border-b border-gray-50 group transition-colors"
                                onclick="navigateToRecord('record_uric_acid_manual.html', event)">
                                <div class="flex items-center justify-center">
                                    <span class="text-md  text-gray-700">+ 尿酸</span>
                                </div>
                            </div>
                            <div class="px-2 py-3 hover:bg-purple-50 cursor-pointer group transition-colors"
                                onclick="navigateToRecord('record_blood_ketone_manual.html', event)">
                                <div class="flex items-center justify-center">
                                    <span class="text-md  text-gray-700">+ 血酮</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 血糖记录内容区域 -->
            <div id="blood-sugar-content" class="health-tab-content relative">
                <!-- Top Controls - Switch Button (Floats at ring's upper-left corner) -->
                <button onclick="toggleBloodSugarMode()"
                    class="absolute top-16 left-4 z-30 bg-white text-blue-600 px-3 py-1 rounded-lg flex items-center gap-1 hover:bg-gray-50 shadow-md text-xs font-medium transition-all"
                    style="z-index: 30;">
                    <i class="fas fa-exchange-alt"></i>
                    <span id="bs-mode-text">切换指血</span>
                </button>

                <!-- Global Data Stats Button (Floats at ring's upper-right corner) -->
                <button onclick="window.location.href='../blood_analysis.html'"
                    class="absolute top-16 right-4 bg-white text-gray-600 px-3 py-1 rounded-lg flex items-center gap-1 hover:bg-gray-50 transition-colors duration-200 shadow-md z-30"
                    title="查看血糖数据统计" style="z-index: 30;">
                    <i class="fas fa-chart-bar text-xs"></i>
                    <span class="text-xs">数据统计</span>
                </button>

                <!-- CGM View Container -->
                <div id="cgm-view-container" class="fade-in">
                    <!-- 血糖圆弧显示区域 (CGM Mode - Styled like Manual) -->
                    <!-- 血糖圆弧显示区域 (CGM Mode - Styled like Manual) -->
                    <div class="relative flex flex-col items-center justify-center mb-0 mt-0" id="cgm-card-container">
                        <!-- 左箭头 - 已移除 -->

                        <!-- 状态信息 (从底部转移到顶部) -->
                        <div class="text-center mb-2">
                            <span class="text-white text-md opacity-80">传感器状态：</span>
                            <span class="text-white text-md font-medium">-</span>
                            <span id="cgm-update-time" class="text-white text-xs opacity-60 ml-2">更新于 -</span>
                        </div>

                        <!-- 血糖圆圈显示 (使用标准样式) -->
                        <div class="blood-sugar-circles-container" style="cursor: pointer;">
                            <!-- 血糖圆圈 -->
                            <div class="blood-pressure-circle" style="border-color: rgba(16, 185, 129, 0.3);">
                                <svg class="blood-pressure-ring">
                                    <circle class="ring-bg" cx="80" cy="80" r="70" stroke-dasharray="440"
                                        stroke-dashoffset="0" style="stroke: #f3f4f6;"></circle>
                                    <!-- 绿色进度条表示正常/CGM -->
                                    <circle class="ring-progress" id="cgmArc" cx="80" cy="80" r="70"
                                        stroke-dasharray="440" stroke-dashoffset="100" style="stroke: #10b981;">
                                    </circle>
                                </svg>
                                <div class="z-10 text-center">
                                    <div class="text-2xl font-bold text-green-500" id="cgm-current-value">6.8</div>
                                    <div class="text-xs text-gray-400">mmol/L</div>
                                    <div class="text-sm text-gray-500">CGM</div>
                                </div>
                            </div>
                        </div>

                        <!-- 时间显示 (移除invisible占位，改用hidden) -->
                        <div class="text-center mt-0 mb-2 hidden">
                            <span class="text-white font-medium glucose-date">09月08日</span>
                            <span class="text-green-400 font-medium mx-2 glucose-period">监测中</span>
                            <span class="text-white font-medium glucose-time">14:30</span>
                        </div>

                        <!-- 右箭头 - 已移除 -->
                    </div>

                    <!-- 设备测量和手动记录按钮 (从指血模式迁移) -->
                    <div class="flex justify-center items-center gap-3 mb-2">
                        <button onclick="navigateToPage('record_blood_sugar_smart_bluetooth')"
                            class="measurement-button device-sugar">
                            <i class="fas fa-mobile-alt mr-2"></i>
                            设备测量
                        </button>
                        <button onclick="navigateToPage('record_blood_sugar')" class="measurement-button manual">
                            <i class="fas fa-plus mr-2"></i>
                            手动记录
                        </button>
                    </div>

                    <!-- Stats Grid (保持原有功能，但调整 Margin 以匹配 Manual Button 区域) -->
                    <div class="mx-4 mb-2">
                        <div class="grid grid-cols-4 gap-2">
                            <div
                                class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg py-1 px-1 text-center border border-white border-opacity-20">
                                <div class="text-[10px] text-white opacity-80 mb-0">平均</div>
                                <div class="text-xs font-bold text-white">6.5</div>
                            </div>
                            <div
                                class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg py-1 px-1 text-center border border-white border-opacity-20">
                                <div class="text-[10px] text-white opacity-80 mb-0">最高</div>
                                <div class="text-xs font-bold text-white">8.3</div>
                            </div>
                            <div
                                class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg py-1 px-1 text-center border border-white border-opacity-20">
                                <div class="text-[10px] text-white opacity-80 mb-0">最低</div>
                                <div class="text-xs font-bold text-white">4.2</div>
                            </div>
                            <div
                                class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg py-1 px-1 text-center border border-white border-opacity-20">
                                <div class="text-[10px] text-white opacity-80 mb-0">达标</div>
                                <div class="text-xs font-bold text-white">92%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Chart Area (CGM Wave - Adjusted Height to Match Manual) -->
                    <div
                        class="blood-sugar-chart bg-white bg-opacity-90 backdrop-blur-sm rounded-xl mx-0 p-2 shadow-sm border border-white border-opacity-50">
                        <div class="blood-sugar-chart bg-white bg-opacity-90 backdrop-blur-sm rounded-xl mx-0 p-6 shadow-sm border border-white border-opacity-50 flex flex-col items-center justify-center"
                            style="min-height: 240px;">

                            <div class="relative mb-6">
                                <div class="absolute -inset-4 bg-cyan-100 rounded-full opacity-50 blur-lg"></div>

                                <div
                                    class="relative z-10 w-14 h-20 bg-gray-800 rounded-xl border-2 border-gray-700 shadow-xl flex items-center justify-center transform -rotate-6">
                                    <div class="absolute inset-1 bg-gray-700 rounded-lg opacity-50"></div>
                                    <i class="fas fa-check text-3xl text-white z-20 drop-shadow-md"></i>

                                    <div class="absolute top-2 w-6 h-1 bg-gray-600 rounded-full z-20"></div>
                                </div>

                                <div
                                    class="absolute -top-4 left-1/2 -translate-x-1/2 w-8 h-1.5 bg-cyan-400 rounded-full z-0">
                                </div>
                            </div>

                            <h3 class="text-lg font-bold text-slate-800 mb-2 tracking-wide">已绑定硅基账号</h3>

                            <div class="flex items-center gap-2 mb-1">
                                <div class="w-3 h-3 border-2 border-cyan-500 border-t-transparent rounded-full">
                                </div>
                                <span class="text-[#0ea5e9] font-medium text-sm">未检测到设备</span>
                            </div>

                            <p class="text-xs text-gray-400 text-center leading-relaxed px-4">
                                请确认在硅基APP中绑定并激活设备。
                            </p>

                        </div>

                    </div>
                </div>
            </div>

            <!-- Manual View Container (Exact copy of home.html content) -->
            <div id="manual-view-container" class="hidden fade-in">
                <!-- 血糖圆弧显示区域 -->
                <div class="relative flex flex-col items-center justify-center mb-0 mt-0" id="health-card-container">
                    <!-- 左箭头 - 移到左边界 -->
                    <button
                        class="absolute left-0 text-gray-400 text-2xl hover:text-blue-500 transition-colors duration-200"
                        onclick="switchHealthTab('medication')" title="切换到用药记录">
                        <i class="fas fa-chevron-left"></i>
                    </button>

                    <!-- 时间显示（移到圆环上方） -->
                    <div class="text-center mb-2">
                        <span class="text-white font-medium glucose-date">09月08日</span>
                        <span class="text-yellow-500 font-medium mx-2 glucose-period">早餐后</span>
                        <span class="text-white font-medium glucose-time">07:30</span>
                    </div>

                    <!-- 血糖圆圈显示 -->
                    <div class="blood-sugar-circles-container" onclick="navigateToPage('record_blood_sugar')"
                        style="cursor: pointer;">
                        <!-- 血糖圆圈 -->
                        <div class="blood-pressure-circle" style="border-color: rgba(251, 146, 60, 0.3);">
                            <svg class="blood-pressure-ring">
                                <circle class="ring-bg" cx="80" cy="80" r="70" stroke-dasharray="440"
                                    stroke-dashoffset="0" style="stroke: #f3f4f6;"></circle>
                                <circle class="ring-progress" id="glucoseArc" cx="80" cy="80" r="70"
                                    stroke-dasharray="440" stroke-dashoffset="220" style="stroke: #f97316;">
                                </circle>
                            </svg>
                            <div class="z-10 text-center">
                                <div class="text-2xl font-bold text-orange-600" id="current-blood-sugar">6.2</div>
                                <div class="text-xs text-gray-400">mmol/L</div>
                                <div class="text-sm text-gray-500">血糖</div>
                            </div>
                        </div>
                    </div>

                    <!-- 推荐范围显示 -->
                    <div class="text-center mt-0 mb-2">
                        <span class="text-white text-md opacity-80">推荐范围：</span>
                        <span class="text-green-400 text-md font-medium" id="glucose-range">早餐后 4.0-10.0
                            mmol/L</span>
                    </div>

                    <!-- 右箭头 - 移到右边界 -->
                    <button
                        class="absolute right-0 text-gray-400 text-2xl hover:text-blue-500 transition-colors duration-200"
                        onclick="switchHealthTab('blood-pressure')" title="切换到血压记录">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <!-- 设备测量和手动记录按钮并排显示 -->
                <div class="flex justify-center items-center gap-3 mb-6">
                    <button onclick="navigateToPage('record_blood_sugar_smart_bluetooth')"
                        class="measurement-button device-sugar">
                        <i class="fas fa-mobile-alt mr-2"></i>
                        设备测量
                    </button>
                    <button onclick="navigateToPage('record_blood_sugar')" class="measurement-button manual">
                        <i class="fas fa-plus mr-2"></i>
                        手动记录
                    </button>
                </div>

                <!-- 血糖数据测量图表模块 -->
                <div
                    class="blood-sugar-chart bg-white bg-opacity- backdrop-blur-sm rounded-xl mx-0 p-2 shadow-sm border border-white border-opacity-50">
                    <!-- 图表标题 -->
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-gray-700">今日血糖趋势</h4>
                        <div class="bg-green-100 px-2 py-0 rounded-full">
                            <!--<span class="text-xs text-green-700 font-medium">达标率 <span id="glucose-compliance-rate">--</span>%</span> -->
                        </div>
                    </div>

                    <!-- 图表容器 -->
                    <div class="relative h-32 mb-1">
                        <!-- Y轴标签 -->
                        <div
                            class="absolute left-0 top-0 bottom-0 flex flex-col justify-between text-xs text-gray-400 pr-2">
                            <span>20</span>
                            <span>15</span>
                            <span>10</span>
                            <span>5</span>
                            <span>0</span>
                        </div>

                        <!-- 图表区域 -->
                        <div class="ml-6 relative" style="height: 128px;">
                            <!-- 网格线 -->
                            <div class="absolute inset-0">
                                <div class="h-full flex flex-col justify-between">
                                    <div class="border-t border-gray-200 border-opacity-50"></div>
                                    <div class="border-t border-gray-200 border-opacity-50"></div>
                                    <div class="border-t border-gray-200 border-opacity-50"></div>
                                    <div class="border-t border-gray-200 border-opacity-50"></div>
                                    <div class="border-t border-gray-200 border-opacity-50"></div>
                                </div>
                            </div>

                            <!-- 血糖数据点和连线 (Demo Style from home.html) -->
                            <svg class="absolute inset-0 w-full h-full" viewBox="0 0 300 120"
                                preserveAspectRatio="none">
                                <!-- 定义渐变 -->
                                <defs>
                                    <linearGradient id="chartGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#4B7EFF" stop-opacity="0.3" />
                                        <stop offset="100%" stop-color="#4B7EFF" stop-opacity="0" />
                                    </linearGradient>
                                </defs>

                                <!-- 标准血糖范围区域 (4.0-10.0 mmol/L) -->
                                <rect x="0" y="43" width="300" height="38" fill="#10b981" fill-opacity="0.1" />

                                <!-- 标准范围界限线 -->
                                <line x1="0" y1="43" x2="300" y2="43" stroke="#10b981" stroke-width="0.5"
                                    stroke-dasharray="5,3" opacity="0.4" />
                                <line x1="0" y1="81" x2="300" y2="81" stroke="#10b981" stroke-width="0.5"
                                    stroke-dasharray="5,3" opacity="0.4" />

                                <!-- 渐变填充区域 -->
                                <path
                                    d="M0 95 C 25 85, 25 75, 50 75 C 75 75, 75 58, 100 58 C 125 58, 125 68, 150 68 C 175 68, 175 50, 200 50 C 225 50, 225 30, 250 30 C 275 30, 275 65, 300 65 L 300 120 L 0 120 Z"
                                    fill="url(#chartGradient)" />

                                <!-- 血糖趋势线 (平滑曲线) -->
                                <path id="blood-sugar-trend-line"
                                    d="M0 95 C 25 85, 25 75, 50 75 C 75 75, 75 58, 100 58 C 125 58, 125 68, 150 68 C 175 68, 175 50, 200 50 C 225 50, 225 30, 250 30 C 275 30, 275 65, 300 65"
                                    fill="none" stroke="#4B7EFF" stroke-width="2.5" stroke-linecap="round"
                                    stroke-linejoin="round" />

                                <!-- 数据点 -->
                                <g id="blood-sugar-data-points">
                                    <circle cx="0" cy="95" r="3.5" fill="white" stroke="#dc2626" stroke-width="1.5" />
                                    <circle cx="50" cy="75" r="3.5" fill="white" stroke="#10b981" stroke-width="1.5" />
                                    <circle cx="100" cy="58" r="3.5" fill="white" stroke="#10b981" stroke-width="1.5" />
                                    <circle cx="150" cy="68" r="3.5" fill="white" stroke="#10b981" stroke-width="1.5" />
                                    <circle cx="200" cy="50" r="3.5" fill="white" stroke="#10b981" stroke-width="1.5" />
                                    <circle cx="250" cy="30" r="3.5" fill="white" stroke="#ef4444" stroke-width="1.5" />
                                    <circle cx="300" cy="65" r="3.5" fill="white" stroke="#10b981" stroke-width="1.5" />
                                </g>

                                <!-- 当前值高亮点 -->
                                <circle cx="300" cy="65" r="6" fill="#4B7EFF" fill-opacity="0.2" />
                                <circle cx="300" cy="65" r="3.5" fill="#4B7EFF" stroke="white" stroke-width="1.5" />
                            </svg>
                        </div>
                    </div>

                    <!-- X轴时间标签 -->
                    <div class="ml-6 flex justify-between text-xs text-gray-400 px-2 mb-0">
                        <span>04:00</span>
                        <span>08:00</span>
                        <span>12:00</span>
                        <span>16:00</span>
                        <span>20:00</span>
                        <span>24:00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 金刚区工具区域 (Moved to bottom) -->

        <!-- 血压记录内容区域 -->
        <div id="blood-pressure-content" class="health-tab-content hidden relative">
            <!-- 数据统计按钮 - 调整到顶部时间齐平位置 -->
            <button onclick="window.location.href='general_analysis.html'"
                class="absolute top-4 right-0 bg-white text-gray-600 px-3 py-1 rounded-l-full flex items-center gap-1 hover:bg-gray-50 transition-colors duration-200 shadow-md z-30"
                title="查看血压数据统计">
                <i class="fas fa-chart-bar text-xs"></i>
                <span class="text-xs">数据统计</span>
            </button>

            <!-- 时间显示 -->
            <div class="text-center mt-0">
                <span class="text-gray-100 font-medium">09月08日</span>
                <span class="text-gray-100 font-medium ">08:30</span>
            </div>

            <div class="relative flex items-center justify-center mb-2 mt-2 health-card-container">
                <!-- 左箭头 - 移到左边界 -->
                <button
                    class="absolute left-0 text-gray-400 text-2xl hover:text-blue-500 transition-colors duration-200 z-20"
                    onclick="switchHealthTab('blood-sugar')" title="切换到血糖记录">
                    <i class="fas fa-chevron-left"></i>
                </button>

                <!-- 血压双圆圈显示 - 左右分布 -->
                <div class="blood-pressure-circles-container" onclick="navigateToPage('record_blood_pressure_manual')"
                    style="cursor: pointer;">
                    <!-- 舒张压圆圈（左侧） -->
                    <div class="blood-pressure-circle diastolic">
                        <svg class="blood-pressure-ring">
                            <defs>
                                <linearGradient id="ringDiastolicGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#60a5fa" />
                                    <stop offset="100%" stop-color="#3b82f6" />
                                </linearGradient>
                            </defs>
                            <circle class="ring-bg" cx="60" cy="60" r="50" stroke-dasharray="314" stroke-dashoffset="0">
                            </circle>
                            <circle class="ring-progress" cx="60" cy="60" r="50" stroke-dasharray="314"
                                stroke-dashoffset="157"
                                style="stroke: url(#ringDiastolicGradient); stroke-linecap: round;"></circle>
                        </svg>
                        <div class="z-10 text-center">
                            <div class="text-2xl font-bold text-blue-600" id="current-diastolic">78</div>
                            <div class="text-xs text-gray-400">mm/Hg</div>
                            <div class="text-sm text-gray-500">舒张压</div>
                        </div>
                    </div>

                    <!-- 收缩压圆圈（右侧） -->
                    <div class="blood-pressure-circle systolic">
                        <svg class="blood-pressure-ring">
                            <defs>
                                <linearGradient id="ringSystolicGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#f87171" />
                                    <stop offset="100%" stop-color="#ef4444" />
                                </linearGradient>
                            </defs>
                            <circle class="ring-bg" cx="60" cy="60" r="50" stroke-dasharray="314" stroke-dashoffset="0">
                            </circle>
                            <circle class="ring-progress" cx="60" cy="60" r="50" stroke-dasharray="314"
                                stroke-dashoffset="78"
                                style="stroke: url(#ringSystolicGradient); stroke-linecap: round;"></circle>
                        </svg>
                        <div class="z-10 text-center">
                            <div class="text-2xl font-bold text-red-600" id="current-systolic">118</div>
                            <div class="text-xs text-gray-400">mm/Hg</div>
                            <div class="text-sm text-gray-500">收缩压</div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- 心率数据 - 移到圆圈下方，去掉背景色 -->
            <div class="flex items-center justify-center gap-1 mt-0 mb-2">
                <i class="fas fa-heartbeat text-red-500 text-md"></i>
                <span class="text-md text-gray-100">心率：</span>
                <span class="text-md font-bold text-gray-100" id="current-heart-rate">72</span>
                <span class="text-md text-gray-100">bpm</span>
            </div>
            <!-- 设备测量和手动记录按钮并排显示 -->
            <div class="flex justify-center items-center gap-3 mb-4">
                <button onclick="navigateToPage('record_blood_pressure_smart')" class="measurement-button device-blood">
                    <i class="fas fa-mobile-alt mr-2"></i>
                    设备测量
                </button>
                <button onclick="navigateToPage('record_blood_pressure_manual')" class="measurement-button manual">
                    <i class="fas fa-plus mr-2"></i>
                    手动记录
                </button>
            </div>

            <!-- 血压图表区域 -->
            <div
                class="blood-sugar-chart bg-white bg-opacity- backdrop-blur-sm rounded-xl mx-0 p-3 shadow-sm border border-white border-opacity-50">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="text-sm font-medium text-gray-700">今日血压趋势</h4>
                    <!-- 图例说明 -->
                    <div class="flex gap-4 text-xs">
                        <div class="flex items-center">
                            <div class="w-3 h-0.5 bg-red-600 mr-1"></div>
                            <div class="w-2 h-2 bg-red-600 rounded-full mr-1"></div>
                            <span class="text-gray-600">收缩压</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-0.5 bg-blue-500 mr-1"></div>
                            <div class="w-2 h-2 bg-blue-500 rounded-full mr-1"></div>
                            <span class="text-gray-600">舒张压</span>
                        </div>
                    </div>
                </div>

                <!-- 图表容器 -->
                <div class="relative h-36 mb-1">
                    <!-- Y轴标签 -->
                    <div
                        class="absolute left-0 top-0 bottom-0 flex flex-col justify-between text-xs text-gray-400 pr-2">
                        <span>200</span>
                        <span>150</span>
                        <span>100</span>
                        <span>50</span>
                        <span>0</span>
                    </div>

                    <!-- 图表区域 -->
                    <div class="ml-6 h-full relative">
                        <!-- 网格线 -->
                        <div class="absolute inset-0">
                            <div class="h-full flex flex-col justify-between">
                                <div class="border-t border-gray-200 border-opacity-50"></div>
                                <div class="border-t border-gray-200 border-opacity-50"></div>
                                <div class="border-t border-gray-200 border-opacity-50"></div>
                                <div class="border-t border-gray-200 border-opacity-50"></div>
                                <div class="border-t border-gray-200 border-opacity-50"></div>
                            </div>
                        </div>

                        <!-- 血压折线图 -->
                        <svg class="absolute inset-0 w-full h-full" viewBox="0 0 300 120" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="systolicGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="#dc2626" stop-opacity="0.2" />
                                    <stop offset="100%" stop-color="#dc2626" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient id="diastolicGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="#3b82f6" stop-opacity="0.2" />
                                    <stop offset="100%" stop-color="#3b82f6" stop-opacity="0" />
                                </linearGradient>
                            </defs>

                            <!-- 正常血压参考线 -->
                            <line x1="0" y1="60" x2="300" y2="60" stroke="#ef4444" stroke-width="0.5"
                                stroke-dasharray="3,3" opacity="0.3" />
                            <line x1="0" y1="80" x2="300" y2="80" stroke="#f59e0b" stroke-width="0.5"
                                stroke-dasharray="3,3" opacity="0.3" />

                            <!-- 渐变填充 -->
                            <path
                                d="M25 25 C 50 30, 50 35, 75 35 C 100 35, 100 20, 125 20 C 150 20, 150 30, 175 30 C 225 30, 225 40, 275 40 L 275 120 L 25 120 Z"
                                fill="url(#systolicGradient)" />
                            <path
                                d="M25 70 C 50 72, 50 75, 75 75 C 100 75, 100 65, 125 65 C 150 65, 150 68, 175 68 C 225 68, 225 70, 275 70 L 275 120 L 25 120 Z"
                                fill="url(#diastolicGradient)" />

                            <!-- 收缩压曲线 -->
                            <path
                                d="M25 25 C 50 30, 50 35, 75 35 C 100 35, 100 20, 125 20 C 150 20, 150 30, 175 30 C 225 30, 225 40, 275 40"
                                fill="none" stroke="#dc2626" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />

                            <!-- 舒张压曲线 -->
                            <path
                                d="M25 70 C 50 72, 50 75, 75 75 C 100 75, 100 65, 125 65 C 150 65, 150 68, 175 68 C 225 68, 225 70, 275 70"
                                fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />

                            <!-- 收缩压数据点 -->
                            <g>
                                <circle cx="25" cy="25" r="3.5" fill="white" stroke="#dc2626" stroke-width="1.5" />
                                <circle cx="75" cy="35" r="3.5" fill="white" stroke="#dc2626" stroke-width="1.5" />
                                <circle cx="125" cy="20" r="3.5" fill="white" stroke="#dc2626" stroke-width="1.5" />
                                <circle cx="175" cy="30" r="3.5" fill="white" stroke="#dc2626" stroke-width="1.5" />
                                <circle cx="275" cy="40" r="4.5" fill="white" stroke="#dc2626" stroke-width="2" />
                            </g>

                            <!-- 舒张压数据点 -->
                            <g>
                                <circle cx="25" cy="70" r="3.5" fill="white" stroke="#3b82f6" stroke-width="1.5" />
                                <circle cx="75" cy="75" r="3.5" fill="white" stroke="#3b82f6" stroke-width="1.5" />
                                <circle cx="125" cy="65" r="3.5" fill="white" stroke="#3b82f6" stroke-width="1.5" />
                                <circle cx="175" cy="68" r="3.5" fill="white" stroke="#3b82f6" stroke-width="1.5" />
                                <circle cx="275" cy="70" r="4.5" fill="white" stroke="#3b82f6" stroke-width="2" />
                            </g>

                            <!-- 数值标签 (微调位置) -->
                            <text x="25" y="15" text-anchor="middle" font-size="8" fill="#dc2626"
                                font-weight="600">135</text>
                            <text x="25" y="85" text-anchor="middle" font-size="8" fill="#3b82f6"
                                font-weight="600">80</text>
                            <text x="75" y="25" text-anchor="middle" font-size="8" fill="#dc2626"
                                font-weight="600">125</text>
                            <text x="75" y="90" text-anchor="middle" font-size="8" fill="#3b82f6"
                                font-weight="600">75</text>
                            <text x="125" y="10" text-anchor="middle" font-size="8" fill="#dc2626"
                                font-weight="600">140</text>
                            <text x="125" y="60" text-anchor="middle" font-size="8" fill="#3b82f6"
                                font-weight="600">85</text>
                            <text x="175" y="20" text-anchor="middle" font-size="8" fill="#dc2626"
                                font-weight="600">130</text>
                            <text x="175" y="82" text-anchor="middle" font-size="8" fill="#3b82f6"
                                font-weight="600">82</text>
                            <text x="275" y="30" text-anchor="middle" font-size="8" fill="#dc2626"
                                font-weight="bold">120</text>
                            <text x="275" y="85" text-anchor="middle" font-size="8" fill="#3b82f6"
                                font-weight="bold">80</text>
                        </svg>
                    </div>
                </div>

                <!-- X轴时间标签 -->
                <div class="ml-6 flex justify-between text-xs text-gray-400 px-2 mb-0">
                    <span>04:00</span>
                    <span>08:00</span>
                    <span>12:00</span>
                    <span>16:00</span>
                    <span>20:00</span>
                    <span>24:00</span>
                </div>

            </div>
        </div>
        <!-- 糖化记录内容区域 -->
        <div id="glycated-content" class="health-tab-content hidden relative">
            <!-- 数据统计按钮 - 调整到圆环中间水平齐平位置 -->
            <button onclick="window.location.href='glycated_analysis.html'"
                class="absolute top-[134px] right-0 bg-white text-gray-600 px-3 py-1 rounded-l-full flex items-center gap-1 hover:bg-gray-50 transition-colors duration-200 shadow-md z-30 transform -translate-y-1/2"
                title="查看糖化数据统计">
                <i class="fas fa-chart-bar text-xs"></i>
                <span class="text-xs">数据统计</span>
            </button>

            <!-- 糖化血红蛋白圆弧显示区域 -->
            <div class="relative flex flex-col items-center justify-center mb-0 mt-0 w-full"
                id="glycated-card-container">

                <!-- 时间显示（移到圆环上方） -->
                <div class="text-center mb-0">
                    <span class="text-white font-medium">09月08日</span>
                    <span class="text-white font-medium ml-2">08:30</span>
                </div>

                <!-- 糖化圆圈显示 -->
                <div class="blood-sugar-circles-container" onclick="navigateToPage('record_glycated')"
                    style="cursor: pointer;">
                    <!-- 糖化圆圈 -->
                    <div class="blood-pressure-circle" style="border-color: rgba(34, 197, 94, 0.3);">
                        <svg class="blood-pressure-ring">
                            <defs>
                                <linearGradient id="ringGlycatedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#818cf8" />
                                    <stop offset="100%" stop-color="#4f46e5" />
                                </linearGradient>
                            </defs>
                            <circle class="ring-bg" cx="80" cy="80" r="70" stroke-dasharray="440" stroke-dashoffset="0"
                                style="stroke: #f3f4f6;"></circle>
                            <circle class="ring-progress" cx="80" cy="80" r="70" stroke-dasharray="440"
                                stroke-dashoffset="132"
                                style="stroke: url(#ringGlycatedGradient); stroke-linecap: round;"></circle>
                        </svg>
                        <div class="z-10 text-center">
                            <div class="text-2xl font-bold text-indigo-600" id="current-glycated">6.5</div>
                            <div class="text-xs text-gray-400">%</div>
                            <div class="text-sm text-gray-500">糖化血红蛋白</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 糖化状态说明 -->
            <div class="flex items-center justify-center gap-2 mt-0 mb-2">
                <span class="text-md font-medium text-gray-200">推荐范围：</span>
                <span class="text-md font-medium text-white" id="glycated-status">
                    < 6.5%</span>
            </div>

            <!-- 手动记录按钮 - 单按钮布局 -->
            <div class="flex justify-center items-center mb-6">
                <button onclick="navigateToPage('record_glycated_manual')"
                    class="flex items-center justify-center gap-2 bg-white text-indigo-600 font-bold rounded-full shadow-lg transform active:scale-95 transition-all duration-200"
                    style="width: 160px; height: 44px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); border: none;">
                    <i class="fas fa-plus text-sm"></i>
                    <span>手动记录</span>
                </button>
            </div>

            <!-- 糖化历史图表区域 -->
            <div
                class="blood-sugar-chart bg-white bg-opacity- backdrop-blur-sm rounded-xl mx-0 p-2 shadow-sm border border-white border-opacity-50">
                <!-- 图表标题 -->
                <div class="flex items-center justify-between mb-2">
                    <h4 class="text-sm font-medium text-gray-700">糖化血红蛋白趋势</h4>
                </div>

                <div class="relative h-32">
                    <!-- 简化的糖化趋势图 -->
                    <div class="absolute inset-0">
                        <!-- 标准糖化范围区域 (4.0-6.5%) -->
                        <div class="absolute bottom-0 left-0 right-0 h-20 bg-indigo-100 opacity-30"
                            style="bottom: 25%;"></div>

                        <!-- 糖化趋势折线 -->
                        <svg class="absolute inset-0 w-full h-full" viewBox="0 0 300 120" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="glycatedTrendGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="#6366f1" stop-opacity="0.3" />
                                    <stop offset="100%" stop-color="#6366f1" stop-opacity="0" />
                                </linearGradient>
                            </defs>

                            <!-- 标准范围界限线 -->
                            <line x1="0" y1="65" x2="300" y2="65" stroke="#6366f1" stroke-width="1"
                                stroke-dasharray="3,3" opacity="0.3" />
                            <line x1="0" y1="35" x2="300" y2="35" stroke="#ef4444" stroke-width="1"
                                stroke-dasharray="3,3" opacity="0.3" />

                            <!-- 填充区域 -->
                            <path
                                d="M0 75 C 30 75, 30 70, 60 70 C 90 70, 90 55, 120 55 C 150 55, 150 60, 180 60 C 210 60, 210 45, 240 45 C 270 45, 270 50, 300 50 L 300 120 L 0 120 Z"
                                fill="url(#glycatedTrendGradient)" />

                            <!-- 糖化趋势线 -->
                            <path
                                d="M0 75 C 30 75, 30 70, 60 70 C 90 70, 90 55, 120 55 C 150 55, 150 60, 180 60 C 210 60, 210 45, 240 45 C 270 45, 270 50, 300 50"
                                fill="none" stroke="#6366f1" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" />

                            <!-- 数据点 -->
                            <circle cx="0" cy="75" r="3" fill="#6366f1" stroke="white" stroke-width="1.5" />
                            <circle cx="60" cy="70" r="3" fill="#6366f1" stroke="white" stroke-width="1.5" />
                            <circle cx="120" cy="55" r="3" fill="#6366f1" stroke="white" stroke-width="1.5" />
                            <circle cx="180" cy="60" r="3" fill="#6366f1" stroke="white" stroke-width="1.5" />
                            <circle cx="240" cy="45" r="3" fill="#6366f1" stroke="white" stroke-width="1.5" />
                            <circle cx="300" cy="50" r="4.5" fill="#6366f1" stroke="white" stroke-width="2.5" />

                            <!-- 数值标签 -->
                            <text x="0" y="65" text-anchor="middle" font-size="8" fill="#6366f1"
                                font-weight="500">7.2</text>
                            <text x="60" y="60" text-anchor="middle" font-size="8" fill="#6366f1"
                                font-weight="500">6.8</text>
                            <text x="120" y="45" text-anchor="middle" font-size="8" fill="#6366f1"
                                font-weight="500">6.2</text>
                            <text x="180" y="50" text-anchor="middle" font-size="8" fill="#6366f1"
                                font-weight="500">6.5</text>
                            <text x="240" y="35" text-anchor="middle" font-size="8" fill="#6366f1"
                                font-weight="500">5.8</text>
                            <text x="300" y="40" text-anchor="middle" font-size="8" fill="#6366f1"
                                font-weight="bold">6.5</text>
                        </svg>
                    </div>
                </div>

                <!-- X轴时间标签（月份） -->
                <div class="ml-6 flex justify-between text-xs text-gray-400 px-2 mb-0">
                    <span>1月</span>
                    <span>2月</span>
                    <span>3月</span>
                    <span>4月</span>
                    <span>5月</span>
                    <span>6月</span>
                </div>
            </div>
        </div>

        <!-- 金刚区工具区域 -->
        <div class="px-4 py-5 bg-white mt-0 shadow-sm mx-0 border border-gray-50 relative" style="z-index: 100;">
            <div class="flex justify-between items-center">
                <!-- 记饮食 -->
                <div class="flex flex-col items-center cursor-pointer group" onclick="navigateToPage('diet')">
                    <div class="mb-1 transition-all group-active:scale-95">
                        <svg width="42" height="42" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            style="filter: drop-shadow(0 4px 6px rgba(37, 99, 235, 0.25));">
                            <path d="M3 11C3 15.4183 6.58172 19 11 19H13C17.4183 19 21 15.4183 21 11V10H3V11Z"
                                fill="url(#blueGradient)" />
                            <path
                                d="M18 3C18 3 17 3 15 5C13 7 13 10 13 10L15 10C15 10 15 8 16.5 6.5C18 5 19 5 19 5L18 3Z"
                                fill="url(#blueGradient)" />
                            <rect x="7" y="10" width="10" height="1.5" rx="0.75" fill="white" fill-opacity="0.3" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium text-gray-600">记饮食</span>
                </div>
                <!-- 记运动 -->
                <div class="flex flex-col items-center cursor-pointer group"
                    onclick="navigateToPage('record_exercise')">
                    <div class="mb-1 transition-all group-active:scale-95">
                        <svg width="42" height="42" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            style="filter: drop-shadow(0 4px 6px rgba(37, 99, 235, 0.25));">
                            <path d="M21 16.5C21 17.8807 19.8807 19 18.5 19H5.5C4.11929 19 3 17.8807 3 16.5V16H21V16.5Z"
                                fill="url(#blueGradient)" />
                            <path d="M3 16V14C3 11.2386 5.23858 9 8 9H11L16 6L21 9V16H3Z" fill="url(#blueGradient)" />
                            <path d="M12 9.5L14 11.5M14 8.5L16 10.5" stroke="white" stroke-width="1.2"
                                stroke-linecap="round" stroke-opacity="0.5" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium text-gray-600">记运动</span>
                </div>
                <!-- 智能药箱 -->
                <div class="flex flex-col items-center cursor-pointer group" onclick="navigateToPage('medication_box')">
                    <div class="mb-1 transition-all group-active:scale-95">
                        <svg width="42" height="42" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            style="filter: drop-shadow(0 4px 6px rgba(37, 99, 235, 0.25));">
                            <path
                                d="M16.5 4.5C14.5 2.5 11.5 2.5 9.5 4.5L4.5 9.5C2.5 11.5 2.5 14.5 4.5 16.5L7.5 19.5C9.5 21.5 12.5 21.5 14.5 19.5L19.5 14.5C21.5 12.5 21.5 9.5 19.5 7.5L16.5 4.5Z"
                                fill="url(#blueGradient)" />
                            <path d="M14.5 19.5L7.5 12.5L9.5 10.5L16.5 17.5L14.5 19.5Z" fill="white"
                                fill-opacity="0.3" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium text-gray-600">智能药箱</span>
                </div>
                <!-- 记体重 -->
                <div class="flex flex-col items-center cursor-pointer group" onclick="navigateToPage('record_weight')">
                    <div class="mb-1 transition-all group-active:scale-95">
                        <svg width="42" height="42" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            style="filter: drop-shadow(0 4px 6px rgba(37, 99, 235, 0.25));">
                            <rect x="2" y="4" width="20" height="16" rx="4" fill="url(#blueGradient)" />
                            <path
                                d="M12 11C13.6569 11 15 9.65685 15 8C15 6.34315 13.6569 5 12 5C10.3431 5 9 6.34315 9 8C9 9.65685 10.3431 11 12 11Z"
                                fill="white" fill-opacity="0.4" />
                            <path d="M12 8L13.5 6" stroke="white" stroke-width="1.5" stroke-linecap="round" />
                            <rect x="5" y="14" width="14" height="2" rx="1" fill="white" fill-opacity="0.3" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium text-gray-600">记体重</span>
                </div>
                <!-- 小工具 -->
                <div class="flex flex-col items-center cursor-pointer group" onclick="navigateToPage('tools')">
                    <div class="mb-1 transition-all group-active:scale-95">
                        <svg width="42" height="42" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            style="filter: drop-shadow(0 4px 6px rgba(37, 99, 235, 0.25));">
                            <path
                                d="M7 6C7 4.89543 7.89543 4 9 4H15C16.1046 4 17 4.89543 17 6V7H20C21.1046 7 22 7.89543 22 9V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18V9C2 7.89543 2.89543 7 4 7H7V6ZM9 6V7H15V6H9Z"
                                fill="url(#blueGradient)" />
                            <circle cx="12" cy="13" r="2" fill="white" fill-opacity="0.4" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium text-gray-600">小工具</span>
                </div>
            </div>
        </div>

        <!-- Banner 轮播区域 -->
        <div class="relative mt-0 mb-4">
            <div class="banner-slider flex overflow-x-auto" id="bannerSlider">
                <!-- Banner 1: 血糖监测提醒 -->
                <div class="banner-slide w-full">
                    <div class="gradient-bg text-white p-6 relative overflow-hidden h-[150px]">
                        <div class="relative z-10 flex flex-col justify-between h-full">
                            <div>
                                <h2 class="text-xl font-bold mb-2">智能血糖监测</h2>
                                <p class="text-sm opacity-90 mb-3">AI助手提醒您按时测量血糖，科学管理健康</p>
                            </div>
                            <div class="flex items-center justify-between">
                                <button class="bg-white text-purple-600 px-4 py-2 rounded-full text-sm font-medium">
                                    立即测量
                                </button>
                                <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=100&h=100&fit=crop&crop=center"
                                    alt="血糖仪" class="w-16 h-16 rounded-full object-cover">
                            </div>
                        </div>
                        <!-- Banner 指示器（居中显示） -->
                        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                            <div class="w-2 h-2 bg-white bg-opacity-80 rounded-full banner-dot active"></div>
                            <div class="w-2 h-2 bg-white bg-opacity-40 rounded-full banner-dot"></div>
                            <div class="w-2 h-2 bg-white bg-opacity-40 rounded-full banner-dot"></div>
                        </div>
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-16 -mt-16">
                        </div>
                    </div>
                </div>

                <!-- Banner 2: 专业课程 -->
                <div class="banner-slide w-full">
                    <div
                        class="bg-gradient-to-r from-emerald-500 to-teal-600 text-white p-6 relative overflow-hidden h-[150px]">
                        <div class="relative z-10 flex flex-col justify-between h-full">
                            <div>
                                <h2 class="text-xl font-bold mb-2">专业控糖课程</h2>
                                <p class="text-sm opacity-90 mb-3">权威医生讲解，科学饮食指导</p>
                            </div>
                            <div class="flex items-center justify-between">
                                <button class="bg-white text-emerald-600 px-4 py-2 rounded-full text-sm font-medium">
                                    免费学习
                                </button>
                                <img src="https://images.unsplash.com/photo-1582750433449-648ed127bb54?w=100&h=100&fit=crop&crop=center"
                                    alt="医生" class="w-16 h-16 rounded-full object-cover">
                            </div>
                        </div>
                        <!-- Banner 指示器（居中显示） -->
                        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                            <div class="w-2 h-2 bg-white bg-opacity-40 rounded-full banner-dot"></div>
                            <div class="w-2 h-2 bg-white bg-opacity-80 rounded-full banner-dot active"></div>
                            <div class="w-2 h-2 bg-white bg-opacity-40 rounded-full banner-dot"></div>
                        </div>
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-16 -mt-16">
                        </div>
                    </div>
                </div>

                <!-- Banner 3: 会员服务 -->
                <div class="banner-slide w-full">
                    <div
                        class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-6 relative overflow-hidden h-[150px]">
                        <div class="relative z-10 flex flex-col justify-between h-full">
                            <div>
                                <h2 class="text-xl font-bold mb-2">VIP 专属服务</h2>
                                <p class="text-sm opacity-90 mb-3">一对一专家咨询，个性化方案定制</p>
                            </div>
                            <div class="flex items-center justify-between">
                                <button class="bg-white text-orange-600 px-4 py-2 rounded-full text-sm font-medium">
                                    立即开通
                                </button>
                                <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=100&h=100&fit=crop&crop=center"
                                    alt="VIP" class="w-16 h-16 rounded-full object-cover">
                            </div>
                        </div>
                        <!-- Banner 指示器（居中显示） -->
                        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                            <div class="w-2 h-2 bg-white bg-opacity-40 rounded-full banner-dot"></div>
                            <div class="w-2 h-2 bg-white bg-opacity-40 rounded-full banner-dot"></div>
                            <div class="w-2 h-2 bg-white bg-opacity-80 rounded-full banner-dot active"></div>
                        </div>
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-16 -mt-16">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 智能药箱打卡卡片 -->
        <div class="px-0 mb-4">
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-50"
                onclick="navigateToPage('medication_box')">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 blue-gradient-bg rounded-lg flex items-center justify-center text-white">
                            <i class="fas fa-pills text-sm"></i>
                        </div>
                        <span class="font-bold text-gray-800">智能药箱</span>
                    </div>
                    <span class="text-[11px] text-gray-400">今日还剩 2 次服药</span>
                </div>
                <div class="flex items-center justify-between bg-blue-50 rounded-xl p-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm">
                            <svg class="w-6 h-6">
                                <use xlink:href="#icon-capsule"></use>
                            </svg>
                        </div>
                        <div>
                            <div class="text-sm font-bold text-gray-800">二甲双胍片</div>
                            <div class="text-[11px] text-blue-500 font-medium">中午 1.0片 · 餐前服用</div>
                        </div>
                    </div>
                    <button
                        class="px-5 py-2 blue-gradient-bg text-white text-xs font-bold rounded-full shadow-sm active:scale-95 transition-transform"
                        onclick="event.stopPropagation(); alert('打卡成功！');">
                        立即打卡
                    </button>
                </div>
            </div>
        </div>

        <!-- 小优AI健康建议 -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center">
                    <div
                        class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">小优AI健康建议</h3>
                </div>
                <button onclick="navigateToPage('chat')" class="text-blue-500 text-sm font-medium flex items-center">
                    问AI
                    <i class="fas fa-chevron-right ml-1"></i>
                </button>
            </div>

            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4">
                <div class="flex-1">
                    <p class="text-sm text-gray-600 mb-3">
                        根据您近期的血糖监测数据，空腹血糖平均6.2mmol/L，餐后2小时血糖平均7.8mmol/L，整体控制良好但仍有优化空间。
                    </p>
                    <div class="bg-white rounded-lg p-3 mb-3">
                        <h5 class="font-medium text-gray-700 text-sm mb-2">AI建议：</h5>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>• 继续保持当前饮食控制，适当增加蔬菜摄入</li>
                            <li>• 建议餐后30分钟进行轻度运动，有助于降低血糖</li>
                            <li>• 定期监测血糖，记录饮食运动情况</li>
                        </ul>
                    </div>
                    <div class="flex justify-between items-center">
                        <button onclick="navigateToPage('record_blood_sugar')"
                            class="text-blue-500 text-sm font-medium">
                            查看详细分析 <i class="fas fa-arrow-right ml-1"></i>
                        </button>
                        <span class="text-gray-600 text-xs">内容由AI生成，仅供参考</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 优唐互联网医院 -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-2">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center">
                    <div
                        class="w-8 h-8 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-hospital text-white text-sm"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">优唐互联网医院</h3>
                </div>
                <button onclick="showMoreDoctors()" class="text-blue-500 text-sm font-medium flex items-center">
                    更多
                    <i class="fas fa-chevron-right ml-1"></i>
                </button>
            </div>

            <div class="grid grid-cols-3 gap-3">
                <!-- 医生1 -->
                <div class="text-center">
                    <img src="../imgs/欧阳存.png" alt="欧阳存" class="w-16 h-16 rounded-full mx-auto mb-2 object-cover">
                    <h4 class="font-medium text-sm text-gray-800 mb-1">欧阳存</h4>
                    <p class="text-xs text-gray-500 mb-2">主任医师</p>
                    <button onclick="consultDoctor('欧阳存')"
                        class="bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium w-full">
                        在线问诊
                    </button>
                </div>

                <!-- 医生2 -->
                <div class="text-center">
                    <img src="../imgs/聂慧敏.png" alt="聂慧敏" class="w-16 h-16 rounded-full mx-auto mb-2 object-cover">
                    <h4 class="font-medium text-sm text-gray-800 mb-1">聂慧敏</h4>
                    <p class="text-xs text-gray-500 mb-2">主治医师</p>
                    <button onclick="consultDoctor('聂慧敏')"
                        class="bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium w-full">
                        在线问诊
                    </button>
                </div>

                <!-- 医生3 -->
                <div class="text-center">
                    <img src="../imgs/黄宏华.png" alt="黄宏华" class="w-16 h-16 rounded-full mx-auto mb-2 object-cover">
                    <h4 class="font-medium text-sm text-gray-800 mb-1">黄宏华</h4>
                    <p class="text-xs text-gray-500 mb-2">执业医师</p>
                    <button onclick="consultDoctor('黄宏华')"
                        class="bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium w-full">
                        在线问诊
                    </button>
                </div>
            </div>
        </div>

        <!-- 底部导航栏（包含使用帮助） -->
        <div class="tab-bar">
            <div class="tab-item active" onclick="navigateToPage('home')">
                <i class="fas fa-home"></i>
                <span>首页</span>
            </div>
            <div class="tab-item" onclick="navigateToPage('chat')">
                <i class="fas fa-robot"></i>
                <span>问AI</span>
            </div>
            <div class="tab-item" onclick="navigateToPage('help')">
                <i class="fas fa-user"></i>
                <span>我的</span>
            </div>
        </div>

        <script>
            // 导航栏功能
            function navigateToPage(page) {
                console.log('导航到页面:', page);

                // 对于新创建的模块页面，直接在当前窗口跳转
                const localPages = ['record_weight', 'record_exercise', 'record_uric_acid_manual', 'record_blood_ketone_manual', 'record_medication_search', 'medication_box'];
                if (localPages.includes(page)) {
                    window.location.href = page + '.html';
                    return;
                }

                // 兼容旧的调用名
                if (page === 'medication') {
                    window.location.href = 'medication_box.html';
                    return;
                }

                // 检查是否在iframe中运行
                if (window.parent !== window) {
                    // 在iframe中，通知父窗口切换页面
                    window.parent.postMessage({
                        type: 'navigate',
                        page: page
                    }, '*');
                    console.log('已发送导航消息到父窗口');
                } else {
                    // 独立运行，直接跳转
                    window.location.href = page + '.html';
                    console.log('独立运行，直接跳转');
                }
            }

            function showRecordModal() {
                // 触觉反馈
                if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                    MedicalApp.HapticManager.impact('medium');
                }

                // 如果在iframe中，发送消息给父页面
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'showRecordModal'
                    }, '*');
                } else {
                    // 显示本地通知
                    if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                        MedicalApp.NotificationManager.info('记录功能开发中...');
                    }
                }
            }

            // 跳转到设备页面的函数
            function goToDevicePage(deviceType) {
                console.log('跳转到设备页面，设备类型:', deviceType);

                // 根据设备类型决定跳转到哪个页面
                let targetPage;

                // 血糖设备跳转到血糖记录页面，血压设备跳转到血压记录页面的智能测量标签页
                if (deviceType === 'blood-sugar') {
                    targetPage = 'record_blood_sugar.html';
                } else if (deviceType === 'blood-pressure') {
                    targetPage = 'record_blood_pressure.html?tab=smart';
                } else {
                    targetPage = 'record.html';
                }

                // 触觉反馈
                if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                    MedicalApp.HapticManager.selection();
                }

                // 检查是否在iframe中运行
                if (window.parent !== window) {
                    // 在iframe中，通知父窗口切换页面
                    window.parent.postMessage({
                        type: 'navigate',
                        page: targetPage.replace('.html', ''),
                        deviceType: deviceType
                    }, '*');
                    console.log('已发送设备页面导航消息到父窗口');
                } else {
                    // 独立运行，直接跳转
                    window.location.href = targetPage;
                    console.log('独立运行，跳转到设备页面:', targetPage);
                }
            }
        </script>

        <script>
            /**
             * 糖尿病控糖管理平台 - 通用交互功能
             * 提供统一的用户体验和交互增强
             */

            // 全局配置
            const CONFIG = {
                // 动画配置
                animation: {
                    duration: 300,
                    easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
                },
                // 触觉反馈配置
                haptic: {
                    enabled: true,
                    intensity: 'medium' // light, medium, heavy
                },
                // 音效配置
                sound: {
                    enabled: false,
                    volume: 0.3
                }
            };

            /**
             * 工具函数集合
             */
            const Utils = {
                /**
                 * 防抖函数
                 * @param {Function} func 要防抖的函数
                 * @param {number} wait 等待时间（毫秒）
                 * @returns {Function} 防抖后的函数
                 */
                debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                },

                /**
                 * 节流函数
                 * @param {Function} func 要节流的函数
                 * @param {number} limit 时间限制（毫秒）
                 * @returns {Function} 节流后的函数
                 */
                throttle(func, limit) {
                    let inThrottle;
                    return function (...args) {
                        if (!inThrottle) {
                            func.apply(this, args);
                            inThrottle = true;
                            setTimeout(() => inThrottle = false, limit);
                        }
                    };
                },

                /**
                 * 格式化日期
                 * @param {Date|string} date 日期对象或字符串
                 * @param {string} format 格式字符串
                 * @returns {string} 格式化后的日期字符串
                 */
                formatDate(date, format = 'YYYY-MM-DD') {
                    const d = new Date(date);
                    const year = d.getFullYear();
                    const month = String(d.getMonth() + 1).padStart(2, '0');
                    const day = String(d.getDate()).padStart(2, '0');
                    const hour = String(d.getHours()).padStart(2, '0');
                    const minute = String(d.getMinutes()).padStart(2, '0');

                    return format
                        .replace('YYYY', year)
                        .replace('MM', month)
                        .replace('DD', day)
                        .replace('HH', hour)
                        .replace('mm', minute);
                },

                /**
                 * 生成唯一ID
                 * @returns {string} 唯一ID字符串
                 */
                generateId() {
                    return Date.now().toString(36) + Math.random().toString(36).substr(2);
                },

                /**
                 * 深拷贝对象
                 * @param {any} obj 要拷贝的对象
                 * @returns {any} 拷贝后的对象
                 */
                deepClone(obj) {
                    if (obj === null || typeof obj !== 'object') return obj;
                    if (obj instanceof Date) return new Date(obj.getTime());
                    if (obj instanceof Array) return obj.map(item => this.deepClone(item));
                    if (typeof obj === 'object') {
                        const clonedObj = {};
                        for (const key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                clonedObj[key] = this.deepClone(obj[key]);
                            }
                        }
                        return clonedObj;
                    }
                }
            };

            /**
             * 触觉反馈管理器
             */
            const HapticManager = {
                /**
                 * 触发触觉反馈
                 * @param {string} type 反馈类型：light, medium, heavy
                 */
                trigger(type = 'medium') {
                    if (!CONFIG.haptic.enabled) return;

                    // 检查是否支持触觉反馈
                    if ('vibrate' in navigator) {
                        const patterns = {
                            light: [10],
                            medium: [20],
                            heavy: [30]
                        };
                        try {
                            if (document.hasFocus()) {
                                safeVibrate(patterns[type] || patterns.medium);
                            }
                        } catch (error) {
                            console.log('振动反馈失败:', error.message);
                        }
                    }
                },

                /**
                 * 成功反馈
                 */
                success() {
                    this.trigger('light');
                },

                /**
                 * 错误反馈
                 */
                error() {
                    this.trigger('heavy');
                },

                /**
                 * 选择反馈
                 */
                selection() {
                    this.trigger('light');
                }
            };

            /**
             * 动画管理器
             */
            const AnimationManager = {
                /**
                 * 淡入动画
                 * @param {HTMLElement} element 目标元素
                 * @param {number} duration 动画时长
                 */
                fadeIn(element, duration = CONFIG.animation.duration) {
                    element.style.opacity = '0';
                    element.style.transition = `opacity ${duration}ms ${CONFIG.animation.easing}`;

                    requestAnimationFrame(() => {
                        element.style.opacity = '1';
                    });
                },

                /**
                 * 淡出动画
                 * @param {HTMLElement} element 目标元素
                 * @param {number} duration 动画时长
                 */
                fadeOut(element, duration = CONFIG.animation.duration) {
                    element.style.transition = `opacity ${duration}ms ${CONFIG.animation.easing}`;
                    element.style.opacity = '0';

                    setTimeout(() => {
                        element.style.display = 'none';
                    }, duration);
                },

                /**
                 * 滑入动画
                 * @param {HTMLElement} element 目标元素
                 * @param {string} direction 滑入方向：left, right, up, down
                 * @param {number} duration 动画时长
                 */
                slideIn(element, direction = 'up', duration = CONFIG.animation.duration) {
                    const transforms = {
                        up: 'translateY(20px)',
                        down: 'translateY(-20px)',
                        left: 'translateX(20px)',
                        right: 'translateX(-20px)'
                    };

                    element.style.transform = transforms[direction];
                    element.style.opacity = '0';
                    element.style.transition = `all ${duration}ms ${CONFIG.animation.easing}`;

                    requestAnimationFrame(() => {
                        element.style.transform = 'translate(0)';
                        element.style.opacity = '1';
                    });
                },

                /**
                 * 弹性缩放动画
                 * @param {HTMLElement} element 目标元素
                 * @param {number} scale 缩放比例
                 * @param {number} duration 动画时长
                 */
                bounce(element, scale = 0.95, duration = 150) {
                    element.style.transition = `transform ${duration}ms ${CONFIG.animation.easing}`;
                    element.style.transform = `scale(${scale})`;

                    setTimeout(() => {
                        element.style.transform = 'scale(1)';
                    }, duration);
                }
            };

            /**
             * 通知管理器
             */
            const NotificationManager = {
                /**
                 * 显示通知
                 * @param {string} message 通知消息
                 * @param {string} type 通知类型：success, error, warning, info
                 * @param {number} duration 显示时长（毫秒）
                 */
                show(message, type = 'info', duration = 3000) {
                    const notification = this.create(message, type);
                    document.body.appendChild(notification);

                    // 触发动画
                    AnimationManager.slideIn(notification, 'down');

                    // 自动隐藏
                    setTimeout(() => {
                        this.hide(notification);
                    }, duration);

                    return notification;
                },

                /**
                 * 创建通知元素
                 * @param {string} message 通知消息
                 * @param {string} type 通知类型
                 * @returns {HTMLElement} 通知元素
                 */
                create(message, type) {
                    const notification = document.createElement('div');
                    notification.className = `notification notification-${type}`;
                    notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 9999;
                    padding: 16px 20px;
                    border-radius: 12px;
                    color: white;
                    font-weight: 500;
                    font-size: 14px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
                    max-width: 300px;
                    word-wrap: break-word;
                `;

                    const colors = {
                        success: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                        error: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                        warning: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
                        info: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)'
                    };

                    notification.style.background = colors[type] || colors.info;
                    notification.textContent = message;

                    // 添加关闭按钮
                    const closeBtn = document.createElement('button');
                    closeBtn.innerHTML = '×';
                    closeBtn.style.cssText = `
                    position: absolute;
                    top: 8px;
                    right: 8px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 18px;
                    cursor: pointer;
                    padding: 0;
                    width: 20px;
                    height: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;

                    closeBtn.onclick = () => this.hide(notification);
                    notification.appendChild(closeBtn);

                    return notification;
                },

                /**
                 * 隐藏通知
                 * @param {HTMLElement} notification 通知元素
                 */
                hide(notification) {
                    AnimationManager.fadeOut(notification);
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, CONFIG.animation.duration);
                },

                /**
                 * 成功通知
                 * @param {string} message 消息内容
                 */
                success(message) {
                    HapticManager.success();
                    return this.show(message, 'success');
                },

                /**
                 * 错误通知
                 * @param {string} message 消息内容
                 */
                error(message) {
                    HapticManager.error();
                    return this.show(message, 'error');
                },

                /**
                 * 警告通知
                 * @param {string} message 消息内容
                 */
                warning(message) {
                    return this.show(message, 'warning');
                },

                /**
                 * 信息通知
                 * @param {string} message 消息内容
                 */
                info(message) {
                    return this.show(message, 'info');
                }
            };

            /**
             * 加载状态管理器
             */
            const LoadingManager = {
                /**
                 * 显示加载状态
                 * @param {HTMLElement} element 目标元素
                 * @param {string} text 加载文本
                 */
                show(element, text = '加载中...') {
                    const loadingId = 'loading-' + Utils.generateId();
                    element.dataset.loadingId = loadingId;

                    const overlay = document.createElement('div');
                    overlay.id = loadingId;
                    overlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(255, 255, 255, 0.9);
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    border-radius: inherit;
                `;

                    overlay.innerHTML = `
                    <div class="loading-spinner" style="
                        width: 32px;
                        height: 32px;
                        border: 3px solid #e5e7eb;
                        border-top: 3px solid #667eea;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                        margin-bottom: 12px;
                    "></div>
                    <div style="
                        color: #6b7280;
                        font-size: 14px;
                        font-weight: 500;
                    ">${text}</div>
                `;

                    // 确保父元素有相对定位
                    if (getComputedStyle(element).position === 'static') {
                        element.style.position = 'relative';
                    }

                    element.appendChild(overlay);
                    AnimationManager.fadeIn(overlay, 200);
                },

                /**
                 * 隐藏加载状态
                 * @param {HTMLElement} element 目标元素
                 */
                hide(element) {
                    const loadingId = element.dataset.loadingId;
                    if (loadingId) {
                        const overlay = document.getElementById(loadingId);
                        if (overlay) {
                            AnimationManager.fadeOut(overlay, 200);
                            setTimeout(() => {
                                if (overlay.parentNode) {
                                    overlay.parentNode.removeChild(overlay);
                                }
                            }, 200);
                        }
                        delete element.dataset.loadingId;
                    }
                }
            };

            /**
             * 表单验证管理器
             */
            const ValidationManager = {
                /**
                 * 验证规则
                 */
                rules: {
                    required: (value) => value.trim() !== '',
                    email: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
                    phone: (value) => /^1[3-9]\d{9}$/.test(value),
                    number: (value) => !isNaN(value) && value !== '',
                    bloodSugar: (value) => {
                        const num = parseFloat(value);
                        return !isNaN(num) && num >= 1 && num <= 30;
                    },
                    bloodPressure: (value) => {
                        const parts = value.split('/');
                        if (parts.length !== 2) return false;
                        const systolic = parseInt(parts[0]);
                        const diastolic = parseInt(parts[1]);
                        return !isNaN(systolic) && !isNaN(diastolic) &&
                            systolic >= 60 && systolic <= 250 &&
                            diastolic >= 40 && diastolic <= 150;
                    }
                },

                /**
                 * 验证单个字段
                 * @param {HTMLElement} field 字段元素
                 * @param {Array} rules 验证规则数组
                 * @returns {boolean} 验证结果
                 */
                validateField(field, rules) {
                    const value = field.value;
                    let isValid = true;
                    let errorMessage = '';

                    for (const rule of rules) {
                        if (typeof rule === 'string') {
                            if (!this.rules[rule](value)) {
                                isValid = false;
                                errorMessage = this.getErrorMessage(rule);
                                break;
                            }
                        } else if (typeof rule === 'object') {
                            if (!this.rules[rule.type](value)) {
                                isValid = false;
                                errorMessage = rule.message || this.getErrorMessage(rule.type);
                                break;
                            }
                        }
                    }

                    this.showFieldResult(field, isValid, errorMessage);
                    return isValid;
                },

                /**
                 * 显示字段验证结果
                 * @param {HTMLElement} field 字段元素
                 * @param {boolean} isValid 是否有效
                 * @param {string} errorMessage 错误消息
                 */
                showFieldResult(field, isValid, errorMessage) {
                    // 移除之前的错误提示
                    const existingError = field.parentNode.querySelector('.field-error');
                    if (existingError) {
                        existingError.remove();
                    }

                    // 更新字段样式
                    field.classList.remove('field-valid', 'field-invalid');
                    field.classList.add(isValid ? 'field-valid' : 'field-invalid');

                    // 显示错误消息
                    if (!isValid && errorMessage) {
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'field-error';
                        errorDiv.style.cssText = `
                        color: #ef4444;
                        font-size: 12px;
                        margin-top: 4px;
                        animation: fadeIn 0.3s ease;
                    `;
                        errorDiv.textContent = errorMessage;
                        field.parentNode.appendChild(errorDiv);
                    }
                },

                /**
                 * 获取错误消息
                 * @param {string} ruleType 规则类型
                 * @returns {string} 错误消息
                 */
                getErrorMessage(ruleType) {
                    const messages = {
                        required: '此字段为必填项',
                        email: '请输入有效的邮箱地址',
                        phone: '请输入有效的手机号码',
                        number: '请输入有效的数字',
                        bloodSugar: '血糖值应在1-30之间',
                        bloodPressure: '请输入有效的血压值（如：120/80）'
                    };
                    return messages[ruleType] || '输入格式不正确';
                }
            };

            /**
             * 数据存储管理器
             */
            const StorageManager = {
                /**
                 * 设置本地存储
                 * @param {string} key 键名
                 * @param {any} value 值
                 */
                set(key, value) {
                    try {
                        localStorage.setItem(key, JSON.stringify(value));
                    } catch (error) {
                        console.warn('无法保存到本地存储:', error);
                    }
                },

                /**
                 * 获取本地存储
                 * @param {string} key 键名
                 * @param {any} defaultValue 默认值
                 * @returns {any} 存储的值
                 */
                get(key, defaultValue = null) {
                    try {
                        const item = localStorage.getItem(key);
                        return item ? JSON.parse(item) : defaultValue;
                    } catch (error) {
                        console.warn('无法从本地存储读取:', error);
                        return defaultValue;
                    }
                },

                /**
                 * 删除本地存储
                 * @param {string} key 键名
                 */
                remove(key) {
                    try {
                        localStorage.removeItem(key);
                    } catch (error) {
                        console.warn('无法删除本地存储:', error);
                    }
                },

                /**
                 * 清空本地存储
                 */
                clear() {
                    try {
                        localStorage.clear();
                    } catch (error) {
                        console.warn('无法清空本地存储:', error);
                    }
                }
            };

            /**
             * 页面初始化
             */
            function initializePage() {
                // 添加全局样式
                const style = document.createElement('style');
                style.textContent = `
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .field-valid {
                    border-color: #10b981 !important;
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
                }
                .field-invalid {
                    border-color: #ef4444 !important;
                    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
                }
            `;
                document.head.appendChild(style);

                // 初始化通用事件监听
                initializeEventListeners();

                // 初始化页面动画
                initializeAnimations();

                console.log('页面初始化完成');
            }

            /**
             * 兼容性检查函数 - 检查元素是否匹配选择器
             * @param {Element} element 要检查的元素
             * @param {string} selector CSS选择器
             * @returns {boolean} 是否匹配
             */
            function elementMatches(element, selector) {
                // 安全检查：确保element是一个有效的HTML元素
                if (!element || !element.nodeType || element.nodeType !== 1) {
                    return false;
                }

                // 优先使用标准的matches方法
                if (element.matches) {
                    return element.matches(selector);
                }
                // 兼容旧版本浏览器
                if (element.webkitMatchesSelector) {
                    return element.webkitMatchesSelector(selector);
                }
                if (element.mozMatchesSelector) {
                    return element.mozMatchesSelector(selector);
                }
                if (element.msMatchesSelector) {
                    return element.msMatchesSelector(selector);
                }

                // 最后的兼容方案 - 手动检查
                const tagName = element.tagName ? element.tagName.toLowerCase() : '';
                const className = element.className || '';
                const role = element.getAttribute ? element.getAttribute('role') : '';

                // 检查按钮相关选择器
                if (selector.includes('button') && tagName === 'button') return true;
                if (selector.includes('.btn') && className && className.includes('btn')) return true;
                if (selector.includes('[role="button"]') && role === 'button') return true;

                // 检查输入框相关选择器
                if (selector.includes('input') && tagName === 'input') return true;
                if (selector.includes('textarea') && tagName === 'textarea') return true;
                if (selector.includes('select') && tagName === 'select') return true;

                return false;
            }

            /**
             * 初始化事件监听器
             */
            function initializeEventListeners() {
                // 为所有按钮添加点击效果
                document.addEventListener('click', function (e) {
                    if (elementMatches(e.target, 'button, .btn, [role="button"]')) {
                        HapticManager.selection();
                        AnimationManager.bounce(e.target);
                    }
                });

                // 为所有输入框添加焦点效果
                document.addEventListener('focusin', function (e) {
                    if (elementMatches(e.target, 'input, textarea, select')) {
                        e.target.style.transition = 'all 0.2s ease';
                    }
                });

                // 为所有卡片添加悬停效果
                document.addEventListener('mouseenter', function (e) {
                    // 使用classList.contains方法替代matches，提高兼容性
                    if (e.target.classList && (e.target.classList.contains('medical-card') ||
                        e.target.classList.contains('data-card') ||
                        e.target.classList.contains('menu-item'))) {
                        e.target.style.transition = 'all 0.3s ease';
                    }
                }, true);
            }

            /**
             * 初始化页面动画
             */
            function initializeAnimations() {
                // 为页面元素添加淡入动画
                const animatedElements = document.querySelectorAll('.medical-card, .data-card, .menu-item');
                animatedElements.forEach((element, index) => {
                    setTimeout(() => {
                        AnimationManager.fadeIn(element);
                    }, index * 100);
                });
            }

            // 页面加载完成后初始化
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializePage);
            } else {
                initializePage();
            }

            // 导出全局对象
            window.MedicalApp = {
                Utils,
                HapticManager,
                AnimationManager,
                NotificationManager,
                LoadingManager,
                ValidationManager,
                StorageManager,
                CONFIG
            };

            console.log('医疗应用通用功能模块加载完成');

            // 首页特定功能
            document.addEventListener('DOMContentLoaded', function () {
                initializeBanner();
                initializeQuickActions();
                initializeFeatures();
            });

            /**
             * 初始化Banner轮播功能
             */
            function initializeBanner() {
                const slider = document.getElementById('bannerSlider');
                const dots = document.querySelectorAll('.banner-dot');
                let currentSlide = 0;

                /**
                 * 更新指示器状态
                 * @param {number} index - 当前幻灯片索引
                 */
                function updateDots(index) {
                    dots.forEach((dot, i) => {
                        if (i === index) {
                            dot.classList.add('bg-purple-600');
                            dot.classList.remove('bg-gray-300');
                        } else {
                            dot.classList.add('bg-gray-300');
                            dot.classList.remove('bg-purple-600');
                        }
                    });
                }

                /**
                 * 自动轮播功能
                 */
                function autoSlide() {
                    currentSlide = (currentSlide + 1) % 3;
                    const slideWidth = slider.clientWidth;
                    slider.scrollTo({
                        left: slideWidth * currentSlide,
                        behavior: 'smooth'
                    });
                    updateDots(currentSlide);
                }

                // 每5秒自动切换
                setInterval(autoSlide, 5000);

                // 监听滚动事件更新指示器
                slider.addEventListener('scroll', function () {
                    const slideWidth = slider.clientWidth;
                    const newSlide = Math.round(slider.scrollLeft / slideWidth);
                    if (newSlide !== currentSlide) {
                        currentSlide = newSlide;
                        updateDots(currentSlide);
                    }
                });

                // 点击指示器切换
                dots.forEach((dot, index) => {
                    dot.addEventListener('click', function () {
                        currentSlide = index;
                        const slideWidth = slider.clientWidth;
                        slider.scrollTo({
                            left: slideWidth * currentSlide,
                            behavior: 'smooth'
                        });
                        updateDots(currentSlide);
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                            MedicalApp.HapticManager.selection();
                        }
                    });
                });
            }

            /**
             * 初始化快捷操作
             */
            function initializeQuickActions() {
                const quickActions = document.querySelectorAll('.quick-action');
                quickActions.forEach(action => {
                    action.addEventListener('click', function () {
                        const actionType = this.dataset.action;
                        handleQuickAction(actionType);
                    });
                });
            }

            /**
             * 初始化功能区
             */
            function initializeFeatures() {
                const features = document.querySelectorAll('.feature-item');
                features.forEach(feature => {
                    feature.addEventListener('click', function () {
                        const featureType = this.dataset.feature;
                        handleFeatureClick(featureType);
                    });
                });
            }

            /**
             * 快捷操作处理
             * @param {string} action 操作类型
             */
            function handleQuickAction(action) {
                if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                    MedicalApp.HapticManager.selection();
                }

                const actions = {
                    'record': () => {
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                            MedicalApp.NotificationManager.info('正在打开血糖记录...');
                        }
                        setTimeout(() => {
                            window.parent.postMessage({ type: 'navigate', page: 'record' }, '*');
                        }, 500);
                    },
                    'reminder': () => {
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                            MedicalApp.NotificationManager.success('提醒设置已保存');
                        }
                    },
                    'report': () => {
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                            MedicalApp.NotificationManager.info('正在生成健康报告...');
                        }
                    },
                    'emergency': () => {
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                            MedicalApp.NotificationManager.warning('紧急联系功能已激活');
                        }
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                            MedicalApp.HapticManager.error();
                        }
                    }
                };

                if (actions[action]) {
                    actions[action]();
                } else {
                    console.log('快捷操作:', action);
                }
            }

            /**
             * 功能点击处理
             * @param {string} feature 功能类型
             */
            function handleFeatureClick(feature) {
                if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                    MedicalApp.HapticManager.selection();
                }

                const features = {
                    'course': () => {
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                            MedicalApp.NotificationManager.info('正在打开专业课程...');
                        }
                        setTimeout(() => {
                            window.parent.postMessage({ type: 'navigate', page: 'course' }, '*');
                        }, 500);
                    },
                    'ai-chat': () => {
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                            MedicalApp.NotificationManager.info('正在打开AI问答...');
                        }
                        setTimeout(() => {
                            window.parent.postMessage({ type: 'navigate', page: 'chat' }, '*');
                        }, 500);
                    },
                    'community': () => {
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                            MedicalApp.NotificationManager.info('社区功能即将上线');
                        }
                    },
                    'tools': () => {
                        if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                            MedicalApp.NotificationManager.info('工具箱功能开发中');
                        }
                    }
                };

                if (features[feature]) {
                    features[feature]();
                } else {
                    console.log('功能点击:', feature);
                }
            }

            /**
             * 触摸滑动功能变量
             */


            /**
             * 性能优化：节流函数
             * @param {Function} func 要节流的函数
             * @param {number} limit 节流间隔（毫秒）
             */
            function throttle(func, limit) {
                let inThrottle;
                return function () {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            }

            /**
             * 健康监测tab顺序数组
             */
            const healthTabs = ['blood-sugar', 'blood-pressure', 'exercise', 'diet', 'medication', 'body-fat'];
            let currentTabIndex = 0;

            /**
             * 初始化触摸滑动事件
             */
            function initTouchSwipe() {
                // 绑定到所有记录内容区域
                const healthTabContents = document.querySelectorAll('.health-tab-content');
                console.log('=== 初始化触摸滑动功能 ===');
                console.log('找到记录内容区域数量:', healthTabContents.length);

                healthTabContents.forEach((container, index) => {
                    console.log(`正在绑定记录内容区域${index}:`, container.id, container.className);

                    // 触摸滑动功能变量 (Scoped to each container)
                    let touchStartX = 0;
                    let touchStartY = 0;
                    let touchStartTime = 0;
                    let currentTouchX = 0;
                    let isDragging = false;
                    let dragOffset = 0;

                    // 为每个记录内容区域添加触摸滑动功能
                    container.style.touchAction = 'pan-y'; // 允许垂直滚动，禁用水平滚动
                    container.style.userSelect = 'none'; // 禁用文本选择

                    // 触摸开始事件
                    container.addEventListener('touchstart', function (e) {
                        console.log('✓ 触摸开始 - 位置:', e.touches[0].pageX, e.touches[0].pageY);
                        const touch = e.touches[0];
                        touchStartX = touch.pageX;
                        touchStartY = touch.pageY;
                        currentTouchX = touch.pageX;
                        touchStartTime = new Date().getTime();
                        isDragging = false;
                        dragOffset = 0;

                        // 添加拖拽开始样式
                        container.classList.add('card-dragging');

                        // 这里的 preventDefault 会阻止点击事件，移除它
                        // e.preventDefault(); 
                    }, { passive: false });

                    // 触摸移动事件 - 实时跟随效果（性能优化版）
                    const throttledTouchMove = throttle(function (e) {
                        const touch = e.touches[0];
                        currentTouchX = touch.pageX;
                        const deltaX = currentTouchX - touchStartX;
                        const deltaY = touch.pageY - touchStartY;

                        // 判断是否为水平滑动
                        if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 10) {
                            isDragging = true;
                            dragOffset = deltaX;

                            // 只有在确认为水平滑动时才阻止默认行为（滚动）
                            if (e.cancelable) {
                                e.preventDefault();
                            }

                            // 限制拖拽范围，避免过度拖拽
                            const maxDrag = container.offsetWidth * 0.3; // 最大拖拽30%宽度
                            const limitedOffset = Math.max(-maxDrag, Math.min(maxDrag, dragOffset));

                            // 使用 requestAnimationFrame 优化动画性能
                            requestAnimationFrame(() => {
                                container.style.transform = `translateX(${limitedOffset}px)`;
                                container.style.opacity = 1 - Math.abs(limitedOffset) / maxDrag * 0.2; // 轻微透明度变化
                            });

                            // 添加阻力效果
                            if (Math.abs(dragOffset) > maxDrag * 0.8) {
                                container.classList.add('card-resistance');
                            } else {
                                container.classList.remove('card-resistance');
                            }

                            console.log('实时跟随:', { deltaX, limitedOffset });
                        }

                        // 移除这里的全局 preventDefault，只在水平滑动时阻止
                        // e.preventDefault();
                    }, 16); // 约60fps的节流频率

                    container.addEventListener('touchmove', throttledTouchMove, { passive: false });

                    // 触摸结束事件 - 带弹性回弹和切换动画
                    container.addEventListener('touchend', function (e) {
                        console.log('✓ 触摸结束');
                        const touch = e.changedTouches[0];
                        const endX = touch.pageX;
                        const endY = touch.pageY;
                        const endTime = new Date().getTime();

                        const deltaX = endX - touchStartX;
                        const deltaY = endY - touchStartY;
                        const deltaTime = endTime - touchStartTime;
                        const swipeVelocity = Math.abs(deltaX) / deltaTime; // 滑动速度

                        console.log('滑动数据:', {
                            deltaX: deltaX,
                            deltaY: deltaY,
                            deltaTime: deltaTime,
                            velocity: swipeVelocity,
                            isDragging: isDragging
                        });

                        // 移除拖拽样式
                        container.classList.remove('card-dragging', 'card-resistance');

                        // 判断是否触发切换：距离阈值或速度阈值
                        const distanceThreshold = container.offsetWidth * 0.2; // 20%宽度
                        const velocityThreshold = 0.3; // 速度阈值
                        const shouldSwitch = Math.abs(deltaX) > distanceThreshold ||
                            (swipeVelocity > velocityThreshold && Math.abs(deltaX) > 30);

                        if (shouldSwitch && deltaTime < 1000 && Math.abs(deltaX) > Math.abs(deltaY)) {
                            console.log('✓ 检测到有效滑动!');

                            // 添加快速切换动画
                            container.classList.add('card-switching');

                            const currentActiveTab = getCurrentActiveTab();
                            console.log('当前激活的tab:', currentActiveTab);

                            let targetTab;
                            if (deltaX > 0) {
                                // 向右滑动，切换到上一个tab
                                const currentIndex = healthTabs.indexOf(currentActiveTab);
                                const prevIndex = currentIndex > 0 ? currentIndex - 1 : healthTabs.length - 1;
                                targetTab = healthTabs[prevIndex];
                                console.log('向右滑动，切换到:', targetTab);

                                // 添加向右切换动画
                                container.style.transform = `translateX(${container.offsetWidth}px)`;
                            } else {
                                // 向左滑动，切换到下一个tab
                                const currentIndex = healthTabs.indexOf(currentActiveTab);
                                const nextIndex = currentIndex < healthTabs.length - 1 ? currentIndex + 1 : 0;
                                targetTab = healthTabs[nextIndex];
                                console.log('向左滑动，切换到:', targetTab);

                                // 添加向左切换动画
                                container.style.transform = `translateX(-${container.offsetWidth}px)`;
                            }

                            // 延迟执行tab切换，让动画先播放
                            setTimeout(() => {
                                console.log('执行tab切换到:', targetTab);
                                switchHealthTab(targetTab);

                                // 切换完成后重置样式
                                setTimeout(() => {
                                    container.classList.remove('card-switching');
                                    container.style.transform = '';
                                    container.style.opacity = '';
                                }, 100);
                            }, 150);

                            // 触觉反馈
                            try {
                                if (navigator.vibrate && document.hasFocus()) {
                                    safeVibrate(50);
                                }
                            } catch (error) {
                                console.log('振动反馈失败:', error.message);
                            }
                        } else {
                            // 忽略点击和极小幅度的滑动
                            if (Math.abs(deltaX) < 10) {
                                console.log('忽略点击或微小滑动');
                                return;
                            }

                            // 弹性回弹效果 - 滑动不满足切换条件
                            console.log('滑动不满足条件，执行弹性回弹');
                            container.classList.add('card-bounce-back');

                            // 重置位置和透明度
                            container.style.transform = '';
                            container.style.opacity = '';

                            // 移除回弹样式
                            setTimeout(() => {
                                container.classList.remove('card-bounce-back');
                            }, 300);
                        }
                    }, { passive: false });

                    // 鼠标事件作为桌面端测试备选方案 - 与触摸事件保持一致
                    let mouseStartX = 0;
                    let mouseStartY = 0;
                    let mouseStartTime = 0;
                    let isMouseDown = false;
                    let currentMouseX = 0;
                    let isMouseDragging = false;

                    container.addEventListener('mousedown', function (e) {
                        console.log('鼠标按下事件触发');
                        mouseStartX = e.pageX;
                        mouseStartY = e.pageY;
                        currentMouseX = e.pageX;
                        mouseStartTime = new Date().getTime();
                        isMouseDown = true;
                        isMouseDragging = false;

                        // 添加拖拽开始样式
                        container.classList.add('card-dragging');
                        e.preventDefault();
                    });

                    // 鼠标移动事件 - 实时跟随效果（性能优化版）
                    const throttledMouseMove = throttle(function (e) {
                        if (!isMouseDown) return;

                        currentMouseX = e.pageX;
                        const deltaX = currentMouseX - mouseStartX;
                        const deltaY = e.pageY - mouseStartY;

                        // 判断是否为水平拖拽
                        if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 10) {
                            isMouseDragging = true;

                            // 限制拖拽范围
                            const maxDrag = container.offsetWidth * 0.3;
                            const limitedOffset = Math.max(-maxDrag, Math.min(maxDrag, deltaX));

                            // 使用 requestAnimationFrame 优化动画性能
                            requestAnimationFrame(() => {
                                container.style.transform = `translateX(${limitedOffset}px)`;
                                container.style.opacity = 1 - Math.abs(limitedOffset) / maxDrag * 0.2;
                            });

                            // 添加阻力效果
                            if (Math.abs(deltaX) > maxDrag * 0.8) {
                                container.classList.add('card-resistance');
                            } else {
                                container.classList.remove('card-resistance');
                            }
                        }
                        e.preventDefault();
                    }, 16); // 约60fps的节流频率

                    container.addEventListener('mousemove', throttledMouseMove);

                    container.addEventListener('mouseup', function (e) {
                        if (!isMouseDown) return;

                        console.log('鼠标释放事件触发');
                        const mouseEndX = e.pageX;
                        const mouseEndY = e.pageY;
                        const mouseEndTime = new Date().getTime();

                        // 计算滑动距离和时间
                        const deltaX = mouseEndX - mouseStartX;
                        const deltaY = mouseEndY - mouseStartY;
                        const deltaTime = mouseEndTime - mouseStartTime;
                        const swipeVelocity = Math.abs(deltaX) / deltaTime;

                        // 移除拖拽样式
                        container.classList.remove('card-dragging', 'card-resistance');

                        // 判断是否触发切换
                        const distanceThreshold = container.offsetWidth * 0.2;
                        const velocityThreshold = 0.3;
                        const shouldSwitch = Math.abs(deltaX) > distanceThreshold ||
                            (swipeVelocity > velocityThreshold && Math.abs(deltaX) > 30);

                        if (shouldSwitch && deltaTime < 1000 && Math.abs(deltaX) > Math.abs(deltaY)) {
                            console.log('检测到有效鼠标滑动');

                            // 添加快速切换动画
                            container.classList.add('card-switching');

                            const currentTab = getCurrentActiveTab();
                            let targetTab;

                            if (deltaX > 0) {
                                // 向右滑动，切换到上一个tab
                                const currentIndex = healthTabs.indexOf(currentTab);
                                const prevIndex = currentIndex > 0 ? currentIndex - 1 : healthTabs.length - 1;
                                targetTab = healthTabs[prevIndex];
                                container.style.transform = `translateX(${container.offsetWidth}px)`;
                            } else {
                                // 向左滑动，切换到下一个tab
                                const currentIndex = healthTabs.indexOf(currentTab);
                                const nextIndex = currentIndex < healthTabs.length - 1 ? currentIndex + 1 : 0;
                                targetTab = healthTabs[nextIndex];
                                container.style.transform = `translateX(-${container.offsetWidth}px)`;
                            }

                            // 延迟执行tab切换
                            setTimeout(() => {
                                switchHealthTab(targetTab);
                                setTimeout(() => {
                                    container.classList.remove('card-switching');
                                    container.style.transform = '';
                                    container.style.opacity = '';
                                }, 100);
                            }, 150);
                        } else {
                            // 弹性回弹效果
                            console.log('鼠标滑动不满足条件，执行弹性回弹');
                            container.classList.add('card-bounce-back');
                            container.style.transform = '';
                            container.style.opacity = '';

                            setTimeout(() => {
                                container.classList.remove('card-bounce-back');
                            }, 300);
                        }

                        isMouseDown = false;
                        isMouseDragging = false;
                    });

                    // 鼠标离开容器时重置状态
                    container.addEventListener('mouseleave', function (e) {
                        if (isMouseDown) {
                            container.classList.remove('card-dragging', 'card-resistance', 'card-bounce-back');
                            container.style.transform = '';
                            container.style.opacity = '';
                            isMouseDown = false;
                            isMouseDragging = false;
                        }
                    });

                    // 注意：touchmove事件已在上面的实时跟随效果中处理
                });
            }

            /**
             * 获取当前激活的tab
             * @returns {string} 当前激活的tab类型
             */
            function getCurrentActiveTab() {
                const contentAreas = document.querySelectorAll('.health-tab-content');
                console.log('=== getCurrentActiveTab调试 ===');
                console.log('找到的内容区域数量:', contentAreas.length);

                for (let content of contentAreas) {
                    console.log('检查内容区域:', content.id, '是否隐藏:', content.classList.contains('hidden'));
                    if (!content.classList.contains('hidden')) {
                        const id = content.id;
                        const tabType = id.replace('-content', '');
                        console.log('找到激活的tab:', tabType);
                        return tabType;
                    }
                }
                console.log('未找到激活tab，返回默认值: blood-sugar');
                return 'blood-sugar'; // 默认返回血糖
            }

            // 页面加载完成后初始化
            document.addEventListener('DOMContentLoaded', function () {
                // 初始化功能
                initCGMView();
            });



            /**
             * 健康监测tab切换功能
             * @param {string} tabType tab类型：blood-sugar, blood-pressure, glycated, blood-ketone, uric-acid, exercise, diet, medication
             */
            function switchHealthTab(tabType) {
                console.log('=== switchHealthTab函数开始执行 ===');
                console.log('目标tabType:', tabType);

                // 触觉反馈
                if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                    MedicalApp.HapticManager.selection();
                }

                // 获取所有健康监测tab按钮
                const tabButtons = document.querySelectorAll('.health-tab');
                console.log('找到健康监测tab按钮数量:', tabButtons.length);
                // 获取所有内容区域
                const contentAreas = document.querySelectorAll('.health-tab-content');
                console.log('找到内容区域数量:', contentAreas.length);

                // 重置所有tab按钮样式
                tabButtons.forEach(button => {
                    button.classList.remove('active');
                });

                // 隐藏所有内容区域
                contentAreas.forEach(content => {
                    content.classList.add('hidden');
                });

                // 根据tab类型激活对应的tab和内容
                let activeTabIndex = 0;
                let activeContentId = '';

                switch (tabType) {
                    case 'blood-sugar':
                        activeTabIndex = 0;
                        activeContentId = 'blood-sugar-content';
                        break;
                    case 'blood-pressure':
                        activeTabIndex = 1;
                        activeContentId = 'blood-pressure-content';
                        break;
                    case 'glycated':
                        activeTabIndex = 2;
                        activeContentId = 'glycated-content';
                        break;
                    case 'uric-acid':
                        activeTabIndex = -1;
                        activeContentId = 'uric-acid-content';
                        break;
                    case 'blood-ketone':
                        activeTabIndex = -1;
                        activeContentId = 'blood-ketone-content';
                        break;
                    case 'exercise':
                        activeTabIndex = -1;
                        activeContentId = 'exercise-content';
                        break;
                    case 'diet':
                        activeTabIndex = -1;
                        activeContentId = 'diet-content';
                        break;
                    case 'medication':
                        activeTabIndex = -1;
                        activeContentId = 'medication-content';
                        break;
                    case 'body-fat':
                        activeTabIndex = -1;
                        activeContentId = 'body-fat-content';
                        break;
                    default:
                        activeTabIndex = 0;
                        activeContentId = 'blood-sugar-content';
                }

                // 激活选中的tab按钮
                console.log('准备激活tab按钮，索引:', activeTabIndex);
                if (activeTabIndex !== -1 && tabButtons[activeTabIndex]) {
                    console.log('找到tab按钮，正在激活...');
                    tabButtons[activeTabIndex].classList.add('active');
                    console.log('tab按钮激活完成');
                } else if (activeTabIndex === -1) {
                    console.log('二级内容切换，不激活顶部Tab按钮');
                } else {
                    console.log('错误：未找到索引为', activeTabIndex, '的tab按钮');
                }

                // 显示对应的内容区域
                console.log('准备显示内容区域:', activeContentId);
                const activeContent = document.getElementById(activeContentId);
                if (activeContent) {
                    console.log('找到内容区域，正在显示...');
                    activeContent.classList.remove('hidden');
                    console.log('内容区域显示完成');
                } else {
                    console.log('错误：未找到ID为', activeContentId, '的内容区域');
                }

                // 记录当前激活的tab
                console.log('切换到健康监测tab:', tabType);
            }



            /**
             * 更新血压圆环显示
             * @param {number} systolic 收缩压值
             * @param {number} diastolic 舒张压值
             */
            /**
             * 血糖圆环更新函数 - 参考activity rings设计
             * @param {number} glucoseValue 血糖值 (mmol/L)
             * @param {string} timestamp 时间戳 (可选)
             */
            /**
             * 血糖圆环更新函数 - 增强通用性
             * @param {number} glucoseValue 血糖值 (mmol/L)
             * @param {string} timestamp 时间戳 (可选)
             * @param {string} arcId 圆环元素ID (可选，默认为'glucoseArc')
             */
            function updateGlucoseArc(glucoseValue = null, timestamp = null, arcId = 'glucoseArc') {
                const glucoseArc = document.getElementById(arcId);
                const isManual = arcId === 'glucoseArc';

                // 指尖血模式下的数值和时间元素
                const glucoseValueElement = isManual ? document.getElementById('current-blood-sugar') : document.getElementById('cgm-current-value');
                const glucoseDateElement = document.querySelector('.glucose-date');
                const glucoseTimeElement = document.querySelector('.glucose-time');
                const glucosePeriodElement = document.querySelector('.glucose-period');

                if (!glucoseArc || !glucoseValueElement) {
                    console.log(`血糖圆弧元素 ${arcId} 未找到`);
                    return;
                }

                // 圆环参数（半径88，周长约553）
                const circumference = 2 * Math.PI * 88; // 约553

                // 如果没有提供血糖值，显示默认状态
                if (glucoseValue === null) {
                    glucoseArc.style.stroke = '#9ca3af'; // 灰色
                    glucoseArc.style.strokeDasharray = '10 5'; // 虚线样式
                    glucoseArc.style.strokeDashoffset = '100'; // 保持与背景圆环一致的偏移
                    glucoseValueElement.textContent = '--';

                    if (isManual) {
                        if (glucoseDateElement) glucoseDateElement.textContent = '';
                        if (glucoseTimeElement) glucoseTimeElement.textContent = '';
                        if (glucosePeriodElement) glucosePeriodElement.textContent = '';
                    }

                    console.log(`血糖圆环 ${arcId} 更新: 无数据状态`);
                    return;
                }

                // 使用统一的颜色判断函数
                const color = getBloodSugarColor(glucoseValue);

                // 计算进度（0-15范围）
                const percentage = Math.min(Math.max(glucoseValue / 15, 0), 1);

                // 恢复为 0，以匹配指尖血模式的原始正确逻辑
                const dashOffset = 0;

                // 进度条长度 = (周长 - 缺口长度) * 百分比
                const usableCircumference = 502;
                const progressLength = usableCircumference * percentage;

                glucoseArc.style.stroke = color;
                glucoseArc.style.strokeDasharray = `${progressLength} ${circumference - progressLength}`;
                glucoseArc.style.strokeDashoffset = dashOffset;
                glucoseArc.style.transition = 'all 0.5s ease-out';

                // 更新血糖值显示
                if (glucoseValueElement) {
                    glucoseValueElement.textContent = glucoseValue.toFixed(1);
                }

                // 仅对指尖血模式更新时间
                if (isManual && timestamp) {
                    const date = new Date(timestamp);
                    if (glucoseDateElement) {
                        glucoseDateElement.textContent = `${(date.getMonth() + 1).toString().padStart(2, '0')}月${date.getDate().toString().padStart(2, '0')}日`;
                    }
                    if (glucoseTimeElement) {
                        glucoseTimeElement.textContent = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                    }
                    if (glucosePeriodElement) {
                        const hour = date.getHours();
                        let period = '';
                        if (hour >= 0 && hour < 6) period = '凌晨';
                        else if (hour >= 6 && hour < 8) period = '空腹';
                        else if (hour >= 8 && hour < 10) period = '早餐后';
                        else if (hour >= 10 && hour < 12) period = '午餐前';
                        else if (hour >= 12 && hour < 14) period = '午餐后';
                        else if (hour >= 14 && hour < 17) period = '下午';
                        else if (hour >= 17 && hour < 19) period = '晚餐前';
                        else if (hour >= 19 && hour < 21) period = '晚餐后';
                        else if (hour >= 21 && hour < 24) period = '睡前';
                        else period = '凌晨';
                        glucosePeriodElement.textContent = period;
                    }

                    // 更新推荐范围
                    const glucoseRangeElement = document.getElementById('glucose-range');
                    if (glucoseRangeElement) {
                        const hour = date.getHours();
                        let rangeText = '';
                        if (hour >= 4 && hour < 8) rangeText = '空腹 4.4-7.0 mmol/L';
                        else if (hour >= 8 && hour < 10) rangeText = '早餐后 4.0-10.0 mmol/L';
                        else if (hour >= 10 && hour < 12) rangeText = '午餐前 4.0-7.8 mmol/L';
                        else if (hour >= 12 && hour < 15) rangeText = '午餐后 4.0-10.0 mmol/L';
                        else if (hour >= 15 && hour < 18) rangeText = '晚餐前 4.0-7.8 mmol/L';
                        else if (hour >= 18 && hour < 21) rangeText = '晚餐后 4.0-10.0 mmol/L';
                        else if (hour >= 21 && hour < 23) rangeText = '睡前 4.0-10.0 mmol/L';
                        else rangeText = '凌晨 4.0-10.0 mmol/L';
                        glucoseRangeElement.textContent = rangeText;
                    }
                }

                console.log(`血糖圆环 ${arcId} 更新: ${glucoseValue.toFixed(1)} mmol/L (${color}, ${Math.round(percentage * 100)}%)`);
            }

            function updateBloodPressureCircle(systolic = 120, diastolic = 80) {
                // 血压范围：正常范围 收缩压90-140，舒张压60-90
                // 计算进度条高度百分比（顶部为0，底部为100%）
                const systolicHeight = Math.min(Math.max((systolic - 60) / (180 - 60) * 100, 0), 100);
                const diastolicHeight = Math.min(Math.max((diastolic - 40) / (120 - 40) * 100, 0), 100);

                // 更新进度条高度
                const systolicProgress = document.querySelector('.blood-pressure-progress.systolic');
                const diastolicProgress = document.querySelector('.blood-pressure-progress.diastolic');

                if (systolicProgress) {
                    systolicProgress.style.height = systolicHeight + '%';
                }

                if (diastolicProgress) {
                    diastolicProgress.style.height = diastolicHeight + '%';
                }

                // 更新中心显示的数值
                const systolicSpan = document.getElementById('current-systolic');
                const diastolicSpan = document.getElementById('current-diastolic');

                if (systolicSpan) {
                    systolicSpan.textContent = systolic;
                }

                if (diastolicSpan) {
                    diastolicSpan.textContent = diastolic;
                }

                console.log(`血压圆环更新: 收缩压${systolic}(${systolicHeight.toFixed(1)}%), 舒张压${diastolic}(${diastolicHeight.toFixed(1)}%)`);
            }

            /**
             * 根据血糖值获取对应的颜色
             * @param {number} value - 血糖值
             * @returns {string} 颜色代码
             */
            function getBloodSugarColor(value) {
                if (value < 4.0) {
                    return '#f97316'; // 橙色 - 低血糖
                } else if (value > 10.0) {
                    return '#ef4444'; // 红色 - 高血糖
                } else {
                    return '#10b981'; // 绿色 - 正常范围
                }
            }

            /**
             * 将血糖值转换为SVG坐标系的Y坐标
             * @param {number} value - 血糖值
             * @param {number} height - SVG高度
             * @returns {number} Y坐标
             */
            function bloodSugarToY(value, height = 120) {
                // 血糖值范围：0-15 mmol/L
                // SVG坐标系：Y轴从上到下增加，所以血糖值越大，Y坐标越小
                const minSugar = 0;
                const maxSugar = 15;
                const padding = 10; // 上下边距
                const chartHeight = height - 2 * padding;

                // 计算血糖值在图表中的相对位置（0-1之间）
                const relativePosition = (value - minSugar) / (maxSugar - minSugar);

                // 转换为SVG坐标：血糖值越大，Y坐标越小（越靠上）
                return padding + (1 - relativePosition) * chartHeight;
            }

            /**
             * 生成模拟血糖数据
             * @returns {Array} 血糖数据数组
             */
            function generateBloodSugarData() {
                const data = [];

                // 生成一天内的血糖数据（每4小时一个点）
                for (let i = 0; i <= 24; i += 4) {
                    // 生成不同时间段的典型血糖值
                    let value;
                    const hour = i;

                    if (hour >= 0 && hour < 6) {
                        // 凌晨：较低血糖
                        value = parseFloat((Math.random() * 2 + 4.0).toFixed(1));
                    } else if (hour >= 6 && hour < 9) {
                        // 早餐后：血糖上升
                        value = parseFloat((Math.random() * 3 + 6.0).toFixed(1));
                    } else if (hour >= 9 && hour < 12) {
                        // 上午：恢复正常
                        value = parseFloat((Math.random() * 2.5 + 5.0).toFixed(1));
                    } else if (hour >= 12 && hour < 15) {
                        // 午餐后：血糖上升
                        value = parseFloat((Math.random() * 4 + 6.5).toFixed(1));
                    } else if (hour >= 15 && hour < 18) {
                        // 下午：恢复正常
                        value = parseFloat((Math.random() * 2.5 + 5.5).toFixed(1));
                    } else if (hour >= 18 && hour < 21) {
                        // 晚餐后：血糖上升
                        value = parseFloat((Math.random() * 3.5 + 7.0).toFixed(1));
                    } else {
                        // 睡前：逐渐降低
                        value = parseFloat((Math.random() * 2.5 + 5.0).toFixed(1));
                    }

                    // 20%概率生成异常值（高血糖或低血糖）
                    if (Math.random() < 0.2) {
                        if (Math.random() < 0.5) {
                            // 低血糖
                            value = parseFloat((Math.random() * 1.5 + 3.0).toFixed(1));
                        } else {
                            // 高血糖
                            value = parseFloat((Math.random() * 4 + 10.5).toFixed(1));
                        }
                    }

                    data.push({
                        time: hour,
                        value: value,
                        x: (hour / 24) * 300,
                        y: bloodSugarToY(value)
                    });
                }

                return data;
            }

            /**
             * 更新血糖趋势图
             */
            function updateBloodSugarChart() {
                // Demo Mode: Do not update chart dynamically to preserve the static SVG demo data
                return;

                const data = generateBloodSugarData();

                // 更新趋势线
                const trendLine = document.getElementById('blood-sugar-trend-line');
                if (trendLine) {
                    const points = data.map(point => `${point.x},${point.y}`).join(' ');
                    trendLine.setAttribute('points', points);
                }

                // 更新数据点
                const dataPointsGroup = document.getElementById('blood-sugar-data-points');
                if (dataPointsGroup) {
                    dataPointsGroup.innerHTML = '';

                    data.forEach((point, index) => {
                        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        circle.setAttribute('cx', point.x);
                        circle.setAttribute('cy', point.y);
                        circle.setAttribute('r', '3');
                        circle.setAttribute('fill', getBloodSugarColor(point.value));
                        circle.setAttribute('stroke', '#ffffff');
                        circle.setAttribute('stroke-width', '1');

                        // 添加悬停提示
                        const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                        title.textContent = `${point.time.toString().padStart(2, '0')}:00 - ${point.value} mmol/L`;
                        circle.appendChild(title);

                        dataPointsGroup.appendChild(circle);

                        // 如果是最后一个点，添加高亮效果
                        if (index === data.length - 1) {
                            const highlightCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                            highlightCircle.setAttribute('cx', point.x);
                            highlightCircle.setAttribute('cy', point.y);
                            highlightCircle.setAttribute('r', '5');
                            highlightCircle.setAttribute('fill', getBloodSugarColor(point.value));
                            highlightCircle.setAttribute('fill-opacity', '0.3');
                            dataPointsGroup.appendChild(highlightCircle);

                            // 更新当前值高亮点
                            const currentHighlights = document.querySelectorAll('svg circle[fill-opacity="0.3"]');
                            currentHighlights.forEach(highlight => {
                                if (highlight.getAttribute('r') === '3') {
                                    highlight.setAttribute('cx', point.x);
                                    highlight.setAttribute('cy', point.y);
                                    highlight.setAttribute('fill', getBloodSugarColor(point.value));
                                }
                            });
                        }
                    });
                }

                // 计算达标率
                let compliantCount = 0;
                const totalCount = data.length;

                data.forEach(point => {
                    // 绿色区间为 4.0-10.0 mmol/L
                    if (point.value >= 4.0 && point.value <= 10.0) {
                        compliantCount++;
                    }
                });

                const complianceRate = totalCount > 0 ? Math.round((compliantCount / totalCount) * 100) : 0;

                // 更新达标率显示
                const complianceRateElement = document.getElementById('glucose-compliance-rate');
                if (complianceRateElement) {
                    complianceRateElement.textContent = complianceRate;
                }

                console.log('血糖趋势图已更新，数据点：', data.length);
                console.log('达标率计算：', compliantCount, '/', totalCount, '=', complianceRate + '%');
            }

            // ====== CGM 模块逻辑 ======

            // 状态管理
            let cgmState = {
                isCGMMode: true, // 默认开启 CGM 模式
                hasDevice: true, // 模拟用户已绑定设备
                timeRange: '3h'  // 默认时间范围
            };

            // 初始化 CGM 视图
            function initCGMView() {
                updateViewMode();
                switchTimeRange('3h');
            }

            // 切换 CGM/指血 模式
            function toggleBloodSugarMode() {
                cgmState.isCGMMode = !cgmState.isCGMMode;
                updateViewMode();

                // 触觉反馈
                if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                    MedicalApp.HapticManager.selection();
                }
            }

            // Ensure global access
            window.toggleBloodSugarMode = toggleBloodSugarMode;

            // 更新视图显示
            function updateViewMode() {
                console.log('Update View Mode:', cgmState.isCGMMode);
                const cgmContainer = document.getElementById('cgm-view-container');
                const manualContainer = document.getElementById('manual-view-container');
                const timeSelector = document.getElementById('cgm-time-selector');
                const modeText = document.getElementById('bs-mode-text');

                if (cgmState.isCGMMode) {
                    // Show CGM
                    cgmContainer.classList.remove('hidden');
                    cgmContainer.style.display = 'block';

                    // Hide Manual
                    manualContainer.classList.add('hidden');
                    manualContainer.style.display = 'none';

                    if (modeText) modeText.textContent = '切换指血';
                } else {
                    // Hide CGM
                    cgmContainer.classList.add('hidden');
                    cgmContainer.style.display = 'none';

                    // Show Manual
                    manualContainer.classList.remove('hidden');
                    manualContainer.style.display = 'block';

                    if (modeText) modeText.textContent = '动态曲线';
                }
            }

            // 切换时间范围
            function switchTimeRange(range) {
                cgmState.timeRange = range;

                // 更新按钮样式
                const btns = document.querySelectorAll('#cgm-time-selector .time-btn');
                btns.forEach(btn => {
                    if (btn.innerText.includes(range.replace('h', '小时'))) {
                        btn.classList.add('active');
                        btn.classList.remove('text-gray-500'); // 移除灰色
                        btn.classList.add('text-blue-600'); // 添加蓝色
                    } else {
                        btn.classList.remove('active');
                        btn.classList.remove('text-blue-600'); // 移除蓝色
                        btn.classList.add('text-gray-500'); // 添加灰色
                    }
                });

                // 生成模拟数据
                renderCGMChart(range);
            }

            // 渲染 CGM 曲线
            function renderCGMChart(range) {
                // Demo Mode: Do not update chart dynamically to preserve the static SVG demo data
                return;

                const svgWidth = 300;
                const lastPoint = document.getElementById('cgm-last-point');
                const currentValElem = document.getElementById('cgm-current-value');

                if (!pathElem) return;

                let pointsCount = 20;
                let volatility = 1.0;

                if (range === '3h') { pointsCount = 15; volatility = 0.5; }
                if (range === '24h') { pointsCount = 50; volatility = 2.5; }

                let points = [];
                // 保持在 4.0 - 10.0 之间的健康模拟数据
                let startVal = 5.5 + Math.random() * 2;
                let currentY = startVal;

                for (let i = 0; i < pointsCount; i++) {
                    let change = (Math.random() - 0.5) * volatility;
                    currentY += change;
                    currentY = Math.max(4.2, Math.min(9.8, currentY)); // 限制在较好范围内
                    points.push(currentY);
                }

                // 最后一个点作为当前值
                const lastVal = points[points.length - 1];
                if (currentValElem) currentValElem.innerText = lastVal.toFixed(1);

                // X轴步长
                const stepX = svgWidth / (pointsCount - 1);

                // Y轴映射: 0-15 mmol/L -> 120-0 px
                const mapY = (val) => svgHeight - (val / 15 * svgHeight);

                let d = `M 0 ${mapY(points[0])}`;

                for (let i = 1; i < points.length; i++) {
                    const x = i * stepX;
                    const y = mapY(points[i]);
                    d += ` L ${x} ${y}`;
                }

                pathElem.setAttribute('d', d);

                // 移动末端小点
                if (lastPoint) {
                    lastPoint.setAttribute('cx', svgWidth);
                    lastPoint.setAttribute('cy', mapY(lastVal));
                }

                // 统一更新 CGM 圆环 UI
                updateGlucoseArc(lastVal, null, 'cgmArc');
            }

            /**
             * 生成真实的健康数据并更新显示
             */
            function generateAndUpdateHealthData() {
                console.log('=== 开始生成健康数据 ===');

                // 生成血糖数据 (正常范围: 3.9-7.0 mmol/L)
                const bloodSugar = parseFloat((Math.random() * 3 + 4.5).toFixed(1)); // 4.5-7.5
                // 生成当前时间作为血糖测量时间
                const now = new Date();
                now.setMinutes(now.getMinutes() - Math.floor(Math.random() * 60)); // 随机设置为过去60分钟内的时间
                updateGlucoseArc(bloodSugar, now.getTime());

                // 更新血糖趋势图
                updateBloodSugarChart();

                // 如果在 CGM 模式，也更新 CGM 曲线
                if (typeof cgmState !== 'undefined' && cgmState.isCGMMode) {
                    renderCGMChart(cgmState.timeRange);
                }

                // 生成血压数据 (正常范围: 收缩压90-140, 舒张压60-90)
                const systolic = Math.floor(Math.random() * 40 + 100); // 100-140
                const diastolic = Math.floor(Math.random() * 25 + 65); // 65-90
                const heartRate = Math.floor(Math.random() * 40 + 60); // 60-100 bpm
                const systolicElement = document.getElementById('current-systolic');
                const diastolicElement = document.getElementById('current-diastolic');
                const heartRateElement = document.getElementById('current-heart-rate');
                if (systolicElement && diastolicElement && heartRateElement) {
                    systolicElement.textContent = systolic;
                    diastolicElement.textContent = diastolic;
                    heartRateElement.textContent = heartRate;
                    console.log(`血压数据更新: ${systolic}/${diastolic} mm/Hg, 心率: ${heartRate} bpm`);
                    // 更新血压圆环
                    updateBloodPressureCircle(systolic, diastolic);
                }

                // 生成步数数据 (5000-15000步)
                const steps = Math.floor(Math.random() * 10000 + 5000);
                const stepsElement = document.getElementById('current-steps');
                if (stepsElement) {
                    stepsElement.textContent = steps.toLocaleString();
                    console.log(`步数数据更新: ${steps.toLocaleString()} 步`);
                }

                // 生成卡路里数据 (1200-2500卡路里)
                const calories = Math.floor(Math.random() * 1300 + 1200);
                const caloriesElement = document.getElementById('current-calories');
                if (caloriesElement) {
                    caloriesElement.textContent = calories.toLocaleString();
                    console.log(`卡路里数据更新: ${calories.toLocaleString()} 卡路里`);
                }

                // 生成用药数据 (0-4片)
                const medication = Math.floor(Math.random() * 5);
                const medicationElement = document.getElementById('current-medication');
                if (medicationElement) {
                    medicationElement.textContent = medication;
                    console.log(`用药数据更新: ${medication} 片`);
                }

                // 生成体脂率数据 (15%-30%)
                const bodyFat = (Math.random() * 15 + 15).toFixed(1);
                const bodyFatElement = document.getElementById('current-body-fat');
                if (bodyFatElement) {
                    bodyFatElement.textContent = bodyFat;
                    console.log(`体脂率数据更新: ${bodyFat}%`);
                }

                console.log('=== 健康数据生成完成 ===');
            }

            /**
             * 定期更新健康数据
             */
            function startHealthDataUpdate() {
                // 立即更新一次
                generateAndUpdateHealthData();

                // 每30秒更新一次数据
                setInterval(() => {
                    generateAndUpdateHealthData();
                }, 30000);

                console.log('健康数据定时更新已启动 (每30秒更新一次)');
            }

            /**
             * 金刚区导航功能
             * @param {string} feature 功能类型
             */
            function navigateToDiamondFeature(feature) {
                console.log('金刚区导航:', feature);

                // 触觉反馈
                if (typeof HapticManager !== 'undefined') {
                    HapticManager.selection();
                }

                // 根据功能类型进行导航
                const featurePages = {
                    'analysis': 'stats.html',
                    'consultation': 'chat.html',
                    'ai': 'chat.html',
                    'tools': 'service.html',
                    'community': 'service.html',
                    'settings': 'profile.html'
                };

                const targetPage = featurePages[feature];
                if (targetPage) {
                    // 检查是否在iframe中运行
                    if (window.parent !== window) {
                        window.parent.postMessage({
                            type: 'navigate',
                            page: targetPage.replace('.html', ''),
                            feature: feature
                        }, '*');
                    } else {
                        window.location.href = targetPage;
                    }
                } else {
                    // 显示开发中提示
                    if (typeof NotificationManager !== 'undefined') {
                        NotificationManager.info('该功能正在开发中...');
                    }
                }
            }

            /**
              * 初始化金刚区滑动功能
              */
            function initDiamondZoneScroll() {
                const scrollContainer = document.getElementById('diamondZoneScroll');

                if (!scrollContainer) {
                    console.log('金刚区滑动容器未找到');
                    return;
                }

                // 确保滑动容器支持平滑滚动
                scrollContainer.style.scrollBehavior = 'smooth';

                console.log('金刚区滑动功能初始化完成 - 支持手动滑动查看更多功能');
            }

            // 页面加载完成后初始化
            document.addEventListener('DOMContentLoaded', function () {
                console.log('=== 页面开始初始化 ===');

                // 设置默认激活状态
                console.log('监测内容设置完成');

                // 初始化 CGM
                if (typeof cgmState !== 'undefined') {
                    if (cgmState.hasDevice) {
                        initCGMView();
                    } else {
                        cgmState.isCGMMode = false;
                        updateViewMode();
                    }
                }

                // 初始化血糖圆弧为无数据状态
                updateGlucoseArc(null);

                // 初始化血糖趋势图
                updateBloodSugarChart();

                // 启动健康数据定期更新
                startHealthDataUpdate();

                // 初始化健康监测模块，默认显示血糖tab
                switchHealthTab('blood-sugar');
                console.log('健康监测模块初始化完成');


                // 初始化触摸滑动功能
                initTouchSwipe();
                console.log('触摸滑动功能初始化完成');

                // 初始化金刚区滑动功能
                initDiamondZoneScroll();
                console.log('金刚区滑动功能初始化完成');

                // 初始化轮播图功能
                initCarousel();
                console.log('轮播图功能初始化完成');

                console.log('=== 页面初始化完成 ===');
                console.log('提示：打开浏览器开发者工具(F12)查看控制台日志');
                console.log('在健康监测卡片上进行鼠标拖拽或触摸滑动测试');
            });

            /**
             * 切换“更多”菜单的显示状态
             */
            function toggleMoreMenu(e) {
                console.log('toggleMoreMenu clicked');
                if (e) e.stopPropagation();
                const menu = document.getElementById('more-menu-final');
                if (menu) {
                    const isHidden = menu.style.display === 'none' || menu.style.display === '';
                    menu.style.display = isHidden ? 'block' : 'none';
                    console.log('Menu display now:', menu.style.display);

                    if (isHidden) {
                        // 点击外部关闭菜单
                        const closeMenu = function (ev) {
                            if (!menu.contains(ev.target)) {
                                menu.style.display = 'none';
                                document.removeEventListener('click', closeMenu);
                            }
                        };
                        setTimeout(() => document.addEventListener('click', closeMenu), 10);
                    }
                }
            }

            /**
             * 跳转到记录页面
             */
            function navigateToRecord(url, e) {
                console.log('navigateToRecord:', url);
                if (e) e.stopPropagation();
                window.location.href = url;
            }

            // 轮播图功能
            function initCarousel() {
                let currentSlide = 0;
                const slides = document.querySelectorAll('.carousel-slide');
                const indicators = document.querySelectorAll('.carousel-indicator');

                function showSlide(index) {
                    // 隐藏所有幻灯片
                    slides.forEach((slide, i) => {
                        slide.classList.toggle('active', i === index);
                    });

                    // 更新指示器
                    indicators.forEach((indicator, i) => {
                        indicator.classList.toggle('active', i === index);
                    });
                }

                function nextSlide() {
                    currentSlide = (currentSlide + 1) % slides.length;
                    showSlide(currentSlide);
                }

                // 设置自动轮播
                setInterval(nextSlide, 3000);

                // 添加指示器点击事件
                indicators.forEach((indicator, index) => {
                    indicator.addEventListener('click', () => {
                        currentSlide = index;
                        showSlide(currentSlide);
                    });
                });

                console.log('轮播图初始化完成，共', slides.length, '张幻灯片');
            }

            // AI健康建议查看更多功能
            function viewMoreAdvice(type) {
                console.log('查看更多', type, '建议');

                // 如果在iframe中，发送消息给父页面
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'viewMoreAdvice',
                        adviceType: type
                    }, '*');
                } else {
                    // 显示本地通知
                    alert('查看更多' + type + '建议功能开发中...');
                }
            }

            // 显示更多医生功能
            function showMoreDoctors() {
                console.log('显示更多医生');

                // 如果在iframe中，发送消息给父页面
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'showMoreDoctors'
                    }, '*');
                } else {
                    // 显示本地通知
                    alert('更多医生功能开发中...');
                }
            }

            // 医生问诊功能
            function consultDoctor(doctorName) {
                console.log('咨询医生:', doctorName);

                // 如果在iframe中，发送消息给父页面
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'consultDoctor',
                        doctorName: doctorName
                    }, '*');
                } else {
                    // 显示本地通知
                    alert('与' + doctorName + '在线问诊功能开发中...');
                }
            }

            console.log('首页加载完成');

        </script>

        <!-- 全局错误处理 -->
        <script>
            window.addEventListener('error', function (e) {
                console.error('JavaScript Error:', e.message);
                // 阻止错误弹窗，但不影响页面显示
                return true;
            });

            // 安全的getElementById包装函数
            function safeGetElement(id) {
                return document.getElementById(id);
            }

            // 安全的textContent设置函数
            function safeSetText(id, text) {
                const element = document.getElementById(id);
                if (element && text !== undefined && text !== null) {
                    element.textContent = text;
                }
                return element;
            }
            // 安全的震动函数（避免iframe中的跨域限制）
            function safeVibrate(duration) {
                try {
                    // 检查是否支持震动API
                    if (navigator.vibrate && window.self === window.top) {
                        navigator.vibrate(duration);
                    }
                } catch (e) {
                    // 忽略震动API错误
                    console.debug('Vibrate not available:', e.message);
                }
            }

        </script>
</body>

</html>