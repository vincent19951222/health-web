<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>血糖数据 - 优唐智能AI+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 全局样式 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        /* 主容器布局 */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* 标签栏样式 */
        .tab-button {
            flex: 1;
            padding: 12px 24px;
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button.active {
            color: #3b82f6;
            border-bottom: 2px solid #3b82f6;
        }

        .tab-button:hover:not(.active) {
            color: #374151;
            background: rgba(107, 114, 128, 0.1);
        }

        /* 内容区域样式 - 简化版本 */
        .tab-content {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 血糖趋势图样式 */
        .trend-chart-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .trend-chart-area {
            height: 200px;
            display: flex;
            align-items: end;
            padding: 20px 10px 20px 40px;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
        }

        .trend-chart-y-axis {
            position: absolute;
            left: 0;
            top: 20px;
            bottom: 20px;
            width: 30px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 10px;
            color: #6b7280;
        }

        .trend-chart-bars {
            position: relative;
            flex: 1;
            height: 100%;
            padding: 0 2px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .trend-chart-bar {
            background: linear-gradient(to top, #3b82f6, #60a5fa);
            border-radius: 2px 2px 0 0;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            min-height: 2px;
            flex: 1;
            min-width: 3px;
            max-width: 6px;
        }

        .trend-chart-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #6b7280;
            padding-left: 40px;
        }

        /* 表格样式 */
        .data-table {
            font-size: 14px;
            border-collapse: collapse;
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            border: 1px solid #e5e7eb;
            text-align: center;
            padding: 8px 4px;
            font-size: 12px;
        }

        .data-table td {
            padding: 8px 4px;
            border: 1px solid #e5e7eb;
            text-align: center;
            font-size: 13px;
        }

        .data-table tbody tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .data-table tbody tr:nth-child(odd) {
            background-color: white;
        }

        /* 月份切换器样式 */
        .month-selector {
            background: white;
            border-radius: 12px;
            padding: 12px;
            margin: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .month-display {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }

        /* 状态标签样式 */
        .status-normal {
            color: #10b981;
            font-weight: 600;
        }

        .status-high {
            color: #ef4444;
            font-weight: 600;
        }

        .status-low {
            color: #ee9c62;
            font-weight: 600;
        }

        /* 统计卡片样式 */
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        /* 设备图标样式 */
        .device-indicator {
            display: inline-flex;
            align-items: center;
            color: #3b82f6;
            margin-left: 6px;
            vertical-align: middle;
            font-size: 12px;
        }

        .stat-card:hover {
            transform: scale(1.02);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        /* 隐藏滚动条样式 */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        /* 数值选择器样式 */
        .value-item {
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .value-item:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .value-item.selected {
            color: #3b82f6;
            font-weight: 600;
            font-size: 20px;
        }

        /* 底部弹出动画 */
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }

        /* 响应式设计 */
        @media (max-width: 640px) {
            .stat-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .tab-container {
                padding: 8px;
            }

            .tab-button {
                font-size: 16px;
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 白色标题栏 -->
        <div class="bg-white text-gray-800 border-b border-gray-200">
            <div class="flex justify-between items-center px-4 py-3">
                <button onclick="window.location.href='home.html'" class="text-gray-600">
                    <i class="fas fa-chevron-left text-xl"></i>
                </button>
                <div class="flex-1 text-center">
                    <h1 class="text-lg font-semibold">血糖数据</h1>
                </div>
                <div class="w-6"></div>
            </div>
        </div>

        <!-- 四个主要标签 -->
        <div class="bg-white border-b border-gray-200">
            <div class="flex">
                <button class="tab-button" data-tab="dynamic" onclick="switchTab('dynamic')">
                    动态曲线
                </button>
                <button class="tab-button active" data-tab="curve" onclick="switchTab('curve')">
                    指血曲线
                </button>
                <button class="tab-button" data-tab="table" onclick="switchTab('table')">
                    数值
                </button>
                <button class="tab-button" data-tab="list" onclick="switchTab('list')">
                    记录
                </button>
                <button class="tab-button" data-tab="target" onclick="switchTab('target')">
                    目标
                </button>
            </div>
        </div>

        <!-- 四个主要标签页的容器 -->
        <div class="flex-1" style="margin-top: 0;">
            <!-- 血糖曲线内容 -->
            <div id="curve-content" class="tab-content show" style="display: block; min-height: 100vh; background: #f5f5f5;">
                <!-- 日期选择器 -->
                <div class="date-selector bg-white mx-4 mt-4 rounded-lg shadow-sm overflow-hidden">
                    <div class="flex items-center justify-between px-4 py-3">
                        <button class="text-gray-400 hover:text-gray-600" onclick="previousDate()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="flex items-center space-x-2 cursor-pointer" onclick="openDatePicker()">
                            <span id="curveDateDisplay" class="date-display text-lg font-medium text-gray-900">2024年9月13日</span>
                            <i class="dropdown-icon fas fa-chevron-down text-gray-400"></i>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600" onclick="nextDate()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- 日期范围选择器 -->
                <div class="tab-container bg-gray-100 mx-4 mt-4 rounded-lg shadow-sm overflow-hidden">
                    <div class="flex">
                        <div class="tab flex-1 text-center py-3 px-4 rounded-lg font-medium cursor-pointer transition-all active bg-white text-gray-900 shadow-sm">
                            日
                        </div>
                        <div class="tab flex-1 text-center py-3 px-4 rounded-lg font-medium cursor-pointer transition-all text-gray-500 hover:text-gray-700">
                            周
                        </div>
                        <div class="tab flex-1 text-center py-3 px-4 rounded-lg font-medium cursor-pointer transition-all text-gray-500 hover:text-gray-700">
                            月
                        </div>
                    </div>
                </div>

                <!-- 统计信息卡片 -->
                <div class="bg-white mx-4 mt-4 rounded-lg shadow-sm p-4">
                    <div class="grid grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600">28</div>
                            <div class="text-xs text-gray-500">测量次数</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-red-600">3</div>
                            <div class="text-xs text-gray-500">偏高次数</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600">2</div>
                            <div class="text-xs text-gray-500">偏低次数</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600">23</div>
                            <div class="text-xs text-gray-500">正常次数</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600">82%</div>
                            <div class="text-xs text-gray-500">正常比例</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600">5.8</div>
                            <div class="text-xs text-gray-500">最低血糖</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-red-600">8.1</div>
                            <div class="text-xs text-gray-500">最高血糖</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600">6.6</div>
                            <div class="text-xs text-gray-500">平均血糖</div>
                        </div>
                    </div>
                </div>

                <!-- 血糖趋势图卡片 -->
                <div class="blood-sugar-chart bg-white bg-opacity-90 backdrop-blur-sm rounded-xl mx-4 mt-4 p-3 shadow-sm border border-white border-opacity-50">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-sm font-medium text-gray-700">今日血糖趋势</h4>
                            <!--<div class="bg-green-100 px-2 py-0 rounded-full">
                                <span class="text-xs text-green-700 font-medium">达标率 <span id="glucose-compliance-rate">85</span>%</span>
                            </div>-->
                        </div>

                        <!-- 图表容器 -->
                        <div class="relative h-32 mb-3">
                            <!-- Y轴标签 -->
                            <div class="absolute left-0 top-0 bottom-0 flex flex-col justify-between text-xs text-gray-400 pr-2">
                                <span>15</span>
                                <span>10</span>
                                <span>5</span>
                                <span>0</span>
                            </div>

                            <!-- 图表区域 -->
                            <div class="ml-6 h-full relative">
                                <!-- 网格线 -->
                                <div class="absolute inset-0">
                                    <div class="h-full flex flex-col justify-between">
                                        <div class="border-t border-gray-200 border-opacity-50"></div>
                                        <div class="border-t border-gray-200 border-opacity-50"></div>
                                        <div class="border-t border-gray-200 border-opacity-50"></div>
                                        <div class="border-t border-gray-200 border-opacity-50"></div>
                                    </div>
                                </div>

                                <!-- 血糖折线图 -->
                                <svg class="absolute inset-0 w-full h-full" viewBox="0 0 300 120" preserveAspectRatio="none">
                                    <!-- 正常范围参考线 -->
                                    <line x1="0" y1="40" x2="300" y2="40" stroke="#10b981" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
                                    <line x1="0" y1="87" x2="300" y2="87" stroke="#10b981" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
                                    <!-- 标准范围标签 -->
                                    <text x="5" y="40" fill="#10b981" font-size="8" font-weight="500">10.0</text>
                                    <text x="5" y="87" fill="#10b981" font-size="8" font-weight="500">4.4</text>
                                    <!-- 血糖趋势线 -->
                                    <polyline
                                        id="blood-sugar-trend-line"
                                        data-chart-line="curve"
                                        points="0,95 50,75 100,58 150,68 200,50 250,30 300,65"
                                        fill="none"
                                        stroke="#6b7280"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"/>
                                    <!-- 数据点 -->
                                    <g id="blood-sugar-data-points" data-chart-points="curve">
                                        <!-- 血糖值2.5 (小于4.4，显示为橙色) -->
                                        <circle cx="0" cy="95" r="3" fill="#f97316"/>
                                        <!-- 血糖值6.2 (正常范围，显示为绿色) -->
                                        <circle cx="50" cy="75" r="3" fill="#10b981"/>
                                        <!-- 血糖值8.5 (正常范围，显示为绿色) -->
                                        <circle cx="100" cy="58" r="3" fill="#10b981"/>
                                        <!-- 血糖值7.0 (正常范围，显示为绿色) -->
                                        <circle cx="150" cy="68" r="3" fill="#10b981"/>
                                        <!-- 血糖值9.2 (正常范围，显示为绿色) -->
                                        <circle cx="200" cy="50" r="3" fill="#10b981"/>
                                        <!-- 血糖值11.5 (高于10.0，显示为红色) -->
                                        <circle cx="250" cy="30" r="3" fill="#ef4444"/>
                                        <!-- 血糖值6.8 (正常范围，显示为绿色) -->
                                        <circle cx="300" cy="65" r="3" fill="#10b981"/>
                                    </g>
                                </svg>
                            </div>
                        </div>

                        <!-- X轴标签 -->
                        <div class="flex justify-between text-xs text-gray-400 px-6">
                            <span>00:00</span>
                            <span>06:00</span>
                            <span>12:00</span>
                            <span>18:00</span>
                            <span>24:00</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="dynamic-content" class="tab-content" style="display: none; min-height: 100vh; background: #f5f5f5;">
                <div class="date-selector bg-white mx-4 mt-4 rounded-lg shadow-sm overflow-hidden">
                    <div class="flex items-center justify-between px-4 py-3">
                        <button class="text-gray-400 hover:text-gray-600" onclick="previousDate()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="flex items-center space-x-2 cursor-pointer" onclick="openDatePicker()">
                            <span id="dynamicDateDisplay" class="date-display text-lg font-medium text-gray-900">2024年9月13日</span>
                            <i class="dropdown-icon fas fa-chevron-down text-gray-400"></i>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600" onclick="nextDate()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <div class="bg-white mx-4 mt-4 rounded-lg shadow-sm p-4">
                    <div class="grid grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600">6.6</div>
                            <div class="text-xs text-gray-500">平均值</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-red-600">8.1</div>
                            <div class="text-xs text-gray-500">最高值</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600">5.8</div>
                            <div class="text-xs text-gray-500">最低值</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600">82%</div>
                            <div class="text-xs text-gray-500">目标范围时间</div>
                        </div>
                    </div>
                </div>

                <div class="blood-sugar-chart bg-white bg-opacity-90 backdrop-blur-sm rounded-xl mx-4 mt-4 p-3 shadow-sm border border-white border-opacity-50">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-sm font-medium text-gray-700">今日血糖趋势</h4>
                        </div>

                        <div class="relative h-32 mb-3">
                            <div class="absolute left-0 top-0 bottom-0 flex flex-col justify-between text-xs text-gray-400 pr-2">
                                <span>15</span>
                                <span>10</span>
                                <span>5</span>
                                <span>0</span>
                            </div>

                            <div class="ml-6 h-full relative">
                                <div class="absolute inset-0">
                                    <div class="h-full flex flex-col justify-between">
                                        <div class="border-t border-gray-200 border-opacity-50"></div>
                                        <div class="border-t border-gray-200 border-opacity-50"></div>
                                        <div class="border-t border-gray-200 border-opacity-50"></div>
                                        <div class="border-t border-gray-200 border-opacity-50"></div>
                                    </div>
                                </div>

                                <svg class="absolute inset-0 w-full h-full" viewBox="0 0 300 120" preserveAspectRatio="none">
                                    <line x1="0" y1="40" x2="300" y2="40" stroke="#10b981" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
                                    <line x1="0" y1="87" x2="300" y2="87" stroke="#10b981" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
                                    <text x="5" y="40" fill="#10b981" font-size="8" font-weight="500">10.0</text>
                                    <text x="5" y="87" fill="#10b981" font-size="8" font-weight="500">4.4</text>
                                    <polyline
                                        data-chart-line="dynamic"
                                        points="0,95 50,75 100,58 150,68 200,50 250,30 300,65"
                                        fill="none"
                                        stroke="#6b7280"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"/>
                                    <g data-chart-points="dynamic">
                                        <circle cx="0" cy="95" r="3" fill="#f97316"/>
                                        <circle cx="50" cy="75" r="3" fill="#10b981"/>
                                        <circle cx="100" cy="58" r="3" fill="#10b981"/>
                                        <circle cx="150" cy="68" r="3" fill="#10b981"/>
                                        <circle cx="200" cy="50" r="3" fill="#10b981"/>
                                        <circle cx="250" cy="30" r="3" fill="#ef4444"/>
                                        <circle cx="300" cy="65" r="3" fill="#10b981"/>
                                    </g>
                                </svg>
                            </div>
                        </div>

                        <div class="flex justify-between text-xs text-gray-400 px-6">
                            <span>00:00</span>
                            <span>06:00</span>
                            <span>12:00</span>
                            <span>18:00</span>
                            <span>24:00</span>
                        </div>
                    </div>
            </div>

            <!-- 血糖表格内容 -->
            <div id="table-content" class="tab-content" style="display: none; min-height: 100vh; background: #f5f5f5;">
                <!-- 月份切换器 -->
                <div class="bg-white mx-2 rounded-lg shadow-sm overflow-hidden mt-4">
                    <div class="flex items-center justify-between px-4 py-3">
                        <button class="text-gray-400 hover:text-gray-600" onclick="previousMonth()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="flex items-center space-x-2">
                            <span id="monthDisplay" class="text-lg font-medium text-gray-900">2024年9月</span>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600" onclick="nextMonth()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- 表格 -->
                <div class="bg-white mx-2 rounded-lg shadow-sm overflow-hidden mt-4">
                    <!-- 表格头部 -->
                    <div class="bg-gray-0 px-4 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-center text-gray-700">血糖数据表</h3>
                    </div>

                    <!-- 表格内容 -->
                    <div class="overflow-x-auto">
                        <table class="w-full data-table" style="table-layout: auto; min-width: 300px;">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th style="width: 20px;" class="text-xs font-medium text-gray-500">日期</th>
                                    <th style="width: 32px;" class="text-xs font-medium text-gray-500">凌晨</th>
                                    <th style="width: 32px;" class="text-xs font-medium text-gray-500">早餐前</th>
                                    <th style="width: 32px;" class="text-xs font-medium text-gray-500">早餐后</th>
                                    <th style="width: 32px;" class="text-xs font-medium text-gray-500">午餐前</th>
                                    <th style="width: 30px;" class="text-xs font-medium text-gray-500">午餐后</th>
                                    <th style="width: 30px;" class="text-xs font-medium text-gray-500">晚餐前</th>
                                    <th style="width: 30px;" class="text-xs font-medium text-gray-500">晚餐后</th>
                                    <th style="width: 3px;" class="text-xs font-medium text-gray-500">睡前</th>
                                </tr>
                            </thead>
                            <tbody id="bloodSugarTableBody">
                                <!-- 动态生成的血糖数据将在这里显示 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 记录列表内容 -->
            <div id="list-content" class="tab-content" style="display: none; min-height: 100vh; background: #f5f5f5;">
                <!-- 记录列表 -->
                <div class="px-4 py-4 space-y-4">
                        <!-- 9月13日 -->
                        <div class="daily-card bg-white rounded-lg shadow-sm p-4">
                            <div class="daily-header cursor-pointer" onclick="toggleDailyGroup('2024-09-13')">
                                <div class="flex items-center justify-between pb-3 border-b border-gray-200">
                                    <div class="flex items-center space-x-3">
                                        <div class="text-lg font-bold text-gray-900">9月13日</div>
                                        <div class="text-sm bg-blue-100 text-blue-600 px-3 py-1 rounded-full">6次测量</div>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <div class="text-sm text-gray-600">
                                            平均: <span class="font-medium">6.4</span>
                                        </div>
                                        <i class="fas fa-chevron-down text-gray-400 transition-transform" id="icon-2024-09-13"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="daily-records space-y-0" id="records-2024-09-13">
                                <div class="record-item flex items-center justify-between p-3 border-b border-gray-100">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="text-base font-medium text-gray-900">08:30 早餐后<i onclick="navigateToBloodSugarDevice()" class="fas fa-mobile-alt text-blue-500 text-xs ml-2 cursor-pointer hover:text-blue-600" title="设备记录"></i></div>
                                            <div class="flex items-center space-x-2">
                                                <div class="text-lg font-bold status-high">7.2</div>
                                                <div class="text-sm status-high font-medium">偏高</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 mt-2">
                                            <span class="text-xs bg-yellow-100 text-yellow-600 px-2 py-1 rounded-full">
                                                <i class="fas fa-utensils mr-1"></i>饥饿
                                            </span>
                                            <span class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full">
                                                <i class="fas fa-battery-quarter mr-1"></i>乏力
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="record-item flex items-center justify-between p-3 border-b border-gray-100">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="text-base font-medium text-gray-900">07:00 早餐前</div>
                                            <div class="flex items-center space-x-2">
                                                <div class="text-lg font-bold status-normal">5.8</div>
                                                <div class="text-sm status-normal font-medium">正常</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 mt-2">
                                            <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">
                                                <i class="fas fa-smile mr-1"></i>无不适
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="record-item flex items-center justify-between p-3">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="text-base font-medium text-gray-900">12:30 午餐后<i onclick="navigateToBloodSugarDevice()" class="fas fa-mobile-alt text-blue-500 text-xs ml-2 cursor-pointer hover:text-blue-600" title="设备记录"></i></div>
                                            <div class="flex items-center space-x-2">
                                                <div class="text-lg font-bold status-low">6.8</div>
                                                <div class="text-sm status-low font-medium">正常</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 mt-2">
                                            <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full">
                                                <i class="fas fa-tint mr-1"></i>尿多
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 9月12日 -->
                        <div class="daily-card bg-white rounded-lg shadow-sm p-4">
                            <div class="daily-header cursor-pointer" onclick="toggleDailyGroup('2024-09-12')">
                                <div class="flex items-center justify-between pb-3 border-b border-gray-200">
                                    <div class="flex items-center space-x-3">
                                        <div class="text-lg font-medium text-gray-900">9月12日</div>
                                        <div class="text-sm bg-blue-100 text-blue-600 px-3 py-1 rounded-full">5次测量</div>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <div class="text-sm text-gray-600">
                                            平均: <span class="font-medium">6.7</span>
                                        </div>
                                        <i class="fas fa-chevron-down text-gray-400 transition-transform" id="icon-2024-09-12"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="daily-records space-y-0" id="records-2024-09-12">
                                <div class="record-item flex items-center justify-between p-3 border-b border-gray-100">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="text-base font-medium text-gray-900">22:00 睡前<i onclick="navigateToBloodSugarDevice()" class="fas fa-mobile-alt text-blue-500 text-xs ml-2 cursor-pointer hover:text-blue-600" title="设备记录"></i></div>
                                            <div class="flex items-center space-x-2">
                                                <div class="text-lg font-bold status-low">6.1</div>
                                                <div class="text-sm status-low font-medium">正常</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 mt-2">
                                            <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">
                                                <i class="fas fa-smile mr-1"></i>无不适
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="record-item flex items-center justify-between p-3">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="text-base font-medium text-gray-900">14:00 午餐后<i onclick="navigateToBloodSugarDevice()" class="fas fa-mobile-alt text-blue-500 text-xs ml-2 cursor-pointer hover:text-blue-600" title="设备记录"></i></div>
                                            <div class="flex items-center space-x-2">
                                                <div class="text-lg font-bold status-high">7.8</div>
                                                <div class="text-sm status-high font-medium">偏高</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 mt-2">
                                            <span class="text-xs bg-cyan-100 text-cyan-600 px-2 py-1 rounded-full">
                                                <i class="fas fa-tint mr-1"></i>口渴
                                            </span>
                                            <span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full">
                                                <i class="fas fa-headache mr-1"></i>头痛
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>

            <!-- 血糖目标内容 -->
            <div id="target-content" class="tab-content" style="display: none; min-height: 100vh; background: #f5f5f5;">
                <!-- 目标设置卡片 -->
                <div class="bg-white mx-4 mt-2 rounded-lg shadow-sm p-4">
                    <!-- 目标设置头部 -->
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium text-gray-900">血糖目标设置</h3>
                        <button id="editTargetBtn" onclick="toggleEditMode()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            修改目标
                        </button>
                    </div>

                    <!-- 目标值表格 -->
                    <div class="overflow-hidden border border-gray-200 rounded-lg">
                        <table class="w-full" id="targetTableBody">
                            <thead>
                                <tr>
                                    <th class="text-left py-3 px-2 text-sm font-medium text-gray-700" style="width: 18%;">节点</th>
                                    <th class="text-center py-3 px-2 text-sm font-medium text-gray-700 bg-gray-100" style="width: 28%;">推荐值</th>
                                    <th class="text-center py-3 px-2 text-sm font-medium text-gray-700 bg-blue-50" style="width: 56%;">目标值</th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr class="border-t border-gray-200">
                                    <td class="py-3 px-2">
                                        <div class="font-medium text-gray-900">空腹</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-gray-50">
                                        <div class="text-sm text-gray-700 font-medium">4.4-7.0</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-blue-50">
                                        <span id="target-value-2" class="text-sm text-gray-900 font-medium">4.4-7.0</span>
                                        <div id="target-input-container-2" style="display: none;" class="flex items-center justify-center space-x-1">
                                            <input type="text" id="target-input-2-min" value="4.4" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                            <span class="text-gray-500 font-medium">-</span>
                                            <input type="text" id="target-input-2-max" value="7.0" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="border-t border-gray-200">
                                    <td class="py-3 px-2">
                                        <div class="font-medium text-gray-900">餐前</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-gray-50">
                                        <div class="text-sm text-gray-700 font-medium">4.0-7.8</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-blue-50">
                                        <span id="target-value-3" class="text-sm text-gray-900 font-medium">4.0-7.8</span>
                                        <div id="target-input-container-3" style="display: none;" class="flex items-center justify-center space-x-1">
                                            <input type="text" id="target-input-3-min" value="4.0" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                            <span class="text-gray-500 font-medium">-</span>
                                            <input type="text" id="target-input-3-max" value="7.8" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="border-t border-gray-200">
                                    <td class="py-3 px-2">
                                        <div class="font-medium text-gray-900">餐后</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-gray-50">
                                        <div class="text-sm text-gray-700 font-medium">4.0-10.0</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-blue-50">
                                        <span id="target-value-4" class="text-sm text-gray-900 font-medium">4.0-10.0</span>
                                        <div id="target-input-container-4" style="display: none;" class="flex items-center justify-center space-x-1">
                                            <input type="text" id="target-input-4-min" value="4.0" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                            <span class="text-gray-500 font-medium">-</span>
                                            <input type="text" id="target-input-4-max" value="10.0" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="border-t border-gray-200">
                                    <td class="py-3 px-2">
                                        <div class="font-medium text-gray-900">睡前</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-gray-50">
                                        <div class="text-sm text-gray-700 font-medium">4.0-10.0</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-blue-50">
                                        <span id="target-value-5" class="text-sm text-gray-900 font-medium">4.0-10.0</span>
                                        <div id="target-input-container-5" style="display: none;" class="flex items-center justify-center space-x-1">
                                            <input type="text" id="target-input-5-min" value="4.0" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                            <span class="text-gray-500 font-medium">-</span>
                                            <input type="text" id="target-input-5-max" value="10.0" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="border-t border-gray-200">
                                    <td class="py-3 px-2">
                                        <div class="font-medium text-gray-900">凌晨</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-gray-50">
                                        <div class="text-sm text-gray-700 font-medium">4.0-10.0</div>
                                    </td>
                                    <td class="py-3 px-2 text-center bg-blue-50">
                                        <span id="target-value-1" class="text-sm text-gray-900 font-medium">4.0-10.0</span>
                                        <div id="target-input-container-1" style="display: none;" class="flex items-center justify-center space-x-1">
                                            <input type="text" id="target-input-1-min" value="4.0" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                            <span class="text-gray-500 font-medium">-</span>
                                            <input type="text" id="target-input-1-max" value="10.0" class="w-16 text-center border border-blue-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" readonly>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 保存按钮 -->
                    <div class="mt-4" id="saveSection" style="display: none;">
                        <button onclick="saveTargets()" class="w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                            保存目标设置
                        </button>
                    </div>
                </div>

                <!-- 数值选择弹窗 -->
                <div id="valuePickerModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end justify-center" style="display: none;" onclick="closeValuePicker()">
                    <div class="bg-white rounded-t-2xl shadow-2xl w-full max-w-md max-h-96 overflow-hidden animate-slide-up" onclick="event.stopPropagation()">
                        <!-- 弹窗头部 -->
                        <div class="flex items-center justify-between p-4 border-b border-gray-200">
                            <div class="w-8"></div>
                            <h3 class="text-lg font-medium text-gray-900 flex-1 text-center">选择数值</h3>
                            <button onclick="closeValuePicker()" class="text-gray-400 hover:text-gray-600 w-8">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- 数值选择区域 -->
                        <div class="p-4">
                            <div class="text-center mb-4">
                                <p class="text-sm text-gray-500">点击任意数值即可选择</p>
                            </div>
                            <div class="relative">
                                <!-- 中心突出显示的数值 -->
                                <div class="text-center py-6">
                                    <div id="selectedValue" class="text-4xl font-bold text-blue-600">5.0</div>
                                    <div class="text-sm text-gray-500 mt-1">mmol/L</div>
                                </div>

                                <!-- 可滑动的数值选择器 -->
                                <div class="relative h-48 overflow-hidden">
                                    <div id="valuePicker" class="absolute inset-0 overflow-y-auto scrollbar-hide">
                                        <!-- 数值列表将通过JavaScript生成 -->
                                    </div>

                                    <!-- 中心指示器 -->
                                    <div class="absolute inset-x-0 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                        <div class="h-12 border-t-2 border-b-2 border-blue-500 mx-4"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 温馨提示卡片 -->
                <div class="bg-white mx-4 mt-2 rounded-lg shadow-sm p-4 mb-4">
                    <h4 class="font-medium text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-info-circle text-gray-600 mr-2"></i>
                        温馨提示
                    </h4>
                    <div class="space-y-2 text-sm text-gray-700">
                        <p>1、血糖推荐值是根据您填写的年龄、身高、体重、糖尿病类型等情况，智能分析得出，个人信息越精准，推荐值越符合您的个体需求。您也可以修改为医生或健康管理师建议您的控糖目标。</p>
                        <p>2、血糖控制需要根据自身情况合理设置，谨防过高或过低。如不确定，请咨询您的健康管理师。</p>
                        <p>3、以上数据内容仅供参考，不作为诊断治疗依据。</p>
                    </div>
                </div>

                <!-- 联系客服按钮 -->
                <div class="px-4 pb-6">
                    <div class="text-center">
                        <p class="text-gray-600 mb-4 mt-6">对血糖目标设置有疑问？请联系客服获取专业指导。</p>
                        <button onclick="contactCustomerService()" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-3 rounded-full font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                            <i class="fas fa-comments mr-2"></i>
                            联系客服
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 血糖趋势图相关函数
        /**
         * 计算血糖值在SVG图表中的Y坐标
         * @param {number} value - 血糖值
         * @param {number} height - 图表高度
         * @returns {number} Y坐标
         */
        function calculateBloodSugarY(value, height = 120) {
            // 血糖值范围：0-15 mmol/L
            // SVG坐标系：Y轴从上到下增加，所以血糖值越大，Y坐标越小
            const minSugar = 0;
            const maxSugar = 15;
            const padding = 10; // 上下边距
            const chartHeight = height - 2 * padding;
            // 计算血糖值在图表中的相对位置（0-1之间）
            const relativePosition = (value - minSugar) / (maxSugar - minSugar);
            // 转换为SVG坐标：血糖值越大，Y坐标越小（越靠上）
            return padding + (1 - relativePosition) * chartHeight;
        }

        /**
         * 获取血糖值对应的颜色
         * @param {number} value - 血糖值
         * @returns {string} 颜色值
         */
        function getBloodSugarColor(value) {
            if (value < 4.4) {
                return '#f97316'; // 偏低 - 橙色
            } else if (value > 10.0) {
                return '#ef4444'; // 偏高 - 红色
            } else {
                return '#10b981'; // 正常 - 绿色
            }
        }

        /**
         * 生成模拟血糖数据
         * @returns {Array} 血糖数据数组
         */
        function generateBloodSugarData() {
            const data = [];
            // 生成一天内的血糖数据（每4小时一个点）
            for (let i = 0; i <= 24; i += 4) {
                // 生成不同时间段的典型血糖值
                let value;
                const hour = i;
                if (hour >= 0 && hour < 6) {
                    // 凌晨：较低血糖
                    value = parseFloat((Math.random() * 2 + 4.0).toFixed(1));
                } else if (hour >= 6 && hour < 9) {
                    // 早餐后：血糖上升
                    value = parseFloat((Math.random() * 3 + 6.0).toFixed(1));
                } else if (hour >= 9 && hour < 12) {
                    // 上午：血糖逐渐下降
                    value = parseFloat((Math.random() * 2 + 5.0).toFixed(1));
                } else if (hour >= 12 && hour < 15) {
                    // 午餐后：血糖上升
                    value = parseFloat((Math.random() * 3 + 6.5).toFixed(1));
                } else if (hour >= 15 && hour < 18) {
                    // 下午：血糖逐渐下降
                    value = parseFloat((Math.random() * 2 + 5.5).toFixed(1));
                } else if (hour >= 18 && hour < 21) {
                    // 晚餐后：血糖上升
                    value = parseFloat((Math.random() * 3 + 6.8).toFixed(1));
                } else {
                    // 睡前：血糖趋于平稳
                    value = parseFloat((Math.random() * 2 + 5.0).toFixed(1));
                }

                const x = (i / 24) * 300; // X坐标（0-300）
                const y = calculateBloodSugarY(value);

                data.push({ x, y, value, hour });
            }
            return data;
        }

        /**
         * 更新血糖趋势图
         */
        function updateBloodSugarChart() {
            try {
                const data = generateBloodSugarData();

                const updateChartFor = (key) => {
                    const trendLine = document.querySelector(`[data-chart-line="${key}"]`);
                    if (trendLine) {
                        const points = data.map(point => `${point.x},${point.y}`).join(' ');
                        trendLine.setAttribute('points', points);
                    }

                    const dataPointsGroup = document.querySelector(`[data-chart-points="${key}"]`);
                    if (dataPointsGroup) {
                        dataPointsGroup.innerHTML = '';
                        data.forEach(point => {
                            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                            circle.setAttribute('cx', point.x);
                            circle.setAttribute('cy', point.y);
                            circle.setAttribute('r', '3');
                            circle.setAttribute('fill', getBloodSugarColor(point.value));
                            circle.setAttribute('stroke', '#ffffff');
                            circle.setAttribute('stroke-width', '1');
                            dataPointsGroup.appendChild(circle);
                        });
                    }
                };

                ['curve', 'dynamic'].forEach(updateChartFor);

                let compliantCount = 0;
                let totalCount = data.length;
                data.forEach(point => {
                    if (point.value >= 4.4 && point.value <= 10.0) {
                        compliantCount++;
                    }
                });
                const complianceRate = Math.round((compliantCount / totalCount) * 100);

                const complianceRateElement = document.getElementById('glucose-compliance-rate');
                if (complianceRateElement) {
                    complianceRateElement.textContent = complianceRate;
                }

                console.log('血糖趋势图已更新，数据点：', data.length);
                console.log('达标率计算：', compliantCount, '/', totalCount, '=', complianceRate + '%');
            } catch (error) {
                console.error('更新血糖趋势图时出错：', error);
            }
        }

        // 日期切换功能
        let currentDate = new Date(2024, 8, 13); // 2024年9月13日

        function previousDate() {
            currentDate.setDate(currentDate.getDate() - 1);
            updateDateDisplay();
            updateBloodSugarChart(); // 更新对应日期的血糖数据
        }

        function nextDate() {
            currentDate.setDate(currentDate.getDate() + 1);
            updateDateDisplay();
            updateBloodSugarChart(); // 更新对应日期的血糖数据
        }

        function updateDateDisplay() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            const day = currentDate.getDate();
            const dateStr = `${year}年${month}月${day}日`;
            const curveDisplay = document.getElementById('curveDateDisplay');
            const dynamicDisplay = document.getElementById('dynamicDateDisplay');
            if (curveDisplay) curveDisplay.textContent = dateStr;
            if (dynamicDisplay) dynamicDisplay.textContent = dateStr;
        }

        function openDatePicker() {
            // 创建一个简单的日期选择器
            const input = document.createElement('input');
            input.type = 'date';
            input.value = currentDate.toISOString().split('T')[0];

            input.onchange = function() {
                currentDate = new Date(this.value);
                updateDateDisplay();
                updateBloodSugarChart(); // 更新对应日期的血糖数据
            };

            input.click();
        }

        // 月份切换功能
        let currentMonth = 8; // 2024年9月 (0-11)
        let currentYear = 2024;

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateMonthDisplay();
            generateBloodSugarTable(); // 重新生成表格数据
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateMonthDisplay();
            generateBloodSugarTable(); // 重新生成表格数据
        }

        function updateMonthDisplay() {
            const monthNames = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
            document.getElementById('monthDisplay').textContent = currentYear + '年' + monthNames[currentMonth];
        }

        // 标签切换功能 - 完全重写，使用直接样式控制
        function switchTab(tabName) {
            console.log('切换到标签:', tabName);

            const tabToContent = {
                curve: 'curve',
                dynamic: 'dynamic',
                table: 'table',
                list: 'list',
                target: 'target'
            };

            const contentIds = Array.from(new Set(Object.values(tabToContent)));
            contentIds.forEach(id => {
                const content = document.getElementById(id + '-content');
                if (content) {
                    content.style.display = 'none';
                }
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            const contentKey = tabToContent[tabName] || 'curve';
            const selectedContent = document.getElementById(contentKey + '-content');
            if (selectedContent) {
                selectedContent.style.display = 'block';
                console.log('显示选中内容:', contentKey);
            }

            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
                console.log('激活标签按钮:', tabName);
            }
        }

        // 页面初始化 - 简化版本
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面开始初始化...');

            // 隐藏所有标签页
            const tabKeys = ['curve', 'dynamic', 'table', 'list', 'target'];
            const contentIds = ['curve', 'dynamic', 'table', 'list', 'target'];
            contentIds.forEach(id => {
                const content = document.getElementById(id + '-content');
                if (content) {
                    content.style.display = 'none';
                }
            });

            // 检查URL参数，确定默认显示的标签页
            const urlParams = new URLSearchParams(window.location.search);
            const requestedTab = urlParams.get('tab');

            // 处理URL参数：records对应list标签
            let defaultTab = 'curve';
            if (requestedTab === 'records') {
                defaultTab = 'list';
            } else if (requestedTab && tabKeys.includes(requestedTab)) {
                defaultTab = requestedTab;
            }

            // 显示指定的标签页
            switchTab(defaultTab);
            console.log('根据URL参数切换到标签:', defaultTab, '(原始参数:', requestedTab + ')');

            // 初始化血糖数据表格
            generateBloodSugarTable();

            // 初始化血糖趋势图
            setTimeout(() => {
                updateBloodSugarChart();
                console.log('血糖趋势图初始化完成');
            }, 100);

            // 设置触摸滑动支持
            setupTouchScroll();

            // 日期范围选择器点击事件
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // 重置所有标签样式
                    tabs.forEach(t => {
                        t.classList.remove('active', 'bg-white', 'text-gray-900', 'shadow-sm');
                        t.classList.add('text-gray-500');
                    });

                    // 激活当前标签
                    this.classList.add('active', 'bg-white', 'text-gray-900', 'shadow-sm');
                    this.classList.remove('text-gray-500');
                });
            });
        });

        /**
         * 生成血糖数据表格
         */
        function generateBloodSugarTable() {
            const tableBody = document.getElementById('bloodSugarTableBody');
            if (!tableBody) return;

            // 获取当前日期
            const today = new Date();
            const todayYear = today.getFullYear();
            const todayMonth = today.getMonth();
            const todayDay = today.getDate();

            // 清空表格内容
            tableBody.innerHTML = '';

            // 确定要显示的年月和最大日期
            let maxDay;

            // 如果不是当前月份，显示该月的所有天数
            if (currentYear !== todayYear || currentMonth !== todayMonth) {
                // 获取该月的最后一天
                maxDay = new Date(currentYear, currentMonth + 1, 0).getDate();
            } else {
                // 当前月份，只显示到今天
                maxDay = todayDay;
            }

            // 生成从最大日期到1号的所有日期（倒序）
            for (let day = maxDay; day >= 1; day--) {
                const row = generateBloodSugarRow(day);
                tableBody.appendChild(row);
            }
        }

        /**
         * 生成单行血糖数据
         * @param {number} day 日期
         * @returns {HTMLElement} 表格行元素
         */
        function generateBloodSugarRow(day) {
            const row = document.createElement('tr');

            // 日期列
            const dateCell = document.createElement('td');
            dateCell.className = 'text-sm';
            dateCell.textContent = day;
            row.appendChild(dateCell);

            // 8个时间段的血糖数据
            const timeSlots = ['凌晨', '早餐前', '早餐后', '午餐前', '午餐后', '晚餐前', '晚餐后', '睡前'];

            timeSlots.forEach(() => {
                const cell = document.createElement('td');
                cell.className = 'text-sm';

                // 随机生成血糖数据（70%概率有数据，30%概率为空）
                if (Math.random() < 0.7) {
                    const bloodSugar = generateRandomBloodSugar();
                    cell.textContent = bloodSugar.value;
                    cell.classList.add(bloodSugar.status);
                } else {
                    cell.textContent = '-';
                }

                row.appendChild(cell);
            });

            return row;
        }

        /**
         * 生成随机血糖值和状态
         * @returns {Object} 包含血糖值和状态的对象
         */
        function generateRandomBloodSugar() {
            // 生成4.0-12.0之间的血糖值
            const value = (Math.random() * 8 + 4).toFixed(1);
            const numValue = parseFloat(value);

            // 根据血糖值确定状态
            let status = 'status-normal';
            if (numValue < 4.4) {
                status = 'status-low';
            } else if (numValue > 10.0) {
                status = 'status-high';
            }

            return {
                value: value,
                status: status
            };
        }

        // 展开/收起日记录功能
        function toggleDailyGroup(date) {
            const records = document.getElementById('records-' + date);
            const icon = document.getElementById('icon-' + date);

            if (records.style.display === 'none') {
                records.style.display = 'block';
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-down');
            } else {
                records.style.display = 'none';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-right');
            }
        }

        // 血糖目标编辑模式切换
        let isEditMode = false;
        let currentEditingInput = null; // 当前正在编辑的输入框
        let currentValueIndex = 0; // 当前选中的数值索引

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editBtn = document.getElementById('editTargetBtn');
            const saveSection = document.getElementById('saveSection');

            for (let i = 1; i <= 5; i++) {
                const valueSpan = document.getElementById('target-value-' + i);
                const inputContainer = document.getElementById('target-input-container-' + i);

                if (valueSpan && inputContainer) {
                    if (isEditMode) {
                        valueSpan.style.display = 'none';
                        inputContainer.style.display = 'flex';
                        editBtn.textContent = '取消修改';
                        saveSection.style.display = 'block';

                        // 为输入框添加点击事件
                        const minInput = document.getElementById('target-input-' + i + '-min');
                        const maxInput = document.getElementById('target-input-' + i + '-max');

                        if (minInput) {
                            console.log('为最小值输入框绑定事件:', minInput.id);
                            // 移除旧的事件监听器
                            minInput.onclick = null;
                            minInput.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                console.log('点击了最小值输入框:', this.id, '值:', this.value);
                                this.dataset.clicked = 'true';
                                openValuePicker(this);
                            });
                        }
                        if (maxInput) {
                            console.log('为最大值输入框绑定事件:', maxInput.id);
                            // 移除旧的事件监听器
                            maxInput.onclick = null;
                            maxInput.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                console.log('点击了最大值输入框:', this.id, '值:', this.value);
                                this.dataset.clicked = 'true';
                                openValuePicker(this);
                            });
                        }
                    } else {
                        valueSpan.style.display = 'inline';
                        inputContainer.style.display = 'none';
                        editBtn.textContent = '修改目标';
                        saveSection.style.display = 'none';
                    }
                }
            }
        }

        // 打开数值选择器
        function openValuePicker(inputElement) {
            console.log('打开数值选择器，输入框:', inputElement.id, '当前值:', inputElement.value);

            currentEditingInput = inputElement;
            const modal = document.getElementById('valuePickerModal');
            const valuePicker = document.getElementById('valuePicker');
            const selectedValue = document.getElementById('selectedValue');

            // 生成数值列表 (2.0 - 20.0，步长0.1)
            valuePicker.innerHTML = '';
            const values = [];
            for (let i = 20; i <= 200; i++) {
                values.push((i / 10).toFixed(1));
            }

            values.forEach((value, index) => {
                const valueItem = document.createElement('div');
                valueItem.className = 'value-item';
                valueItem.textContent = value;
                valueItem.onclick = () => {
                    console.log('点击了数值:', value);
                    selectValue(value, index);
                };

                valuePicker.appendChild(valueItem);
            });

            // 设置当前值为显示状态（但不触发确认）
            const currentValue = parseFloat(inputElement.value) || 5.0;
            console.log('当前数值:', currentValue);
            const currentIndex = values.findIndex(v => parseFloat(v) === currentValue);

            if (currentIndex >= 0) {
                currentValueIndex = currentIndex;
                // 只更新显示值，不调用selectValue函数
                selectedValue.textContent = currentValue;

                // 更新选中状态
                setTimeout(() => {
                    const valueItems = document.querySelectorAll('.value-item');
                    valueItems.forEach((item, i) => {
                        if (i === currentIndex) {
                            item.classList.add('selected');
                        } else {
                            item.classList.remove('selected');
                        }
                    });
                }, 10);

                // 滚动到当前位置
                setTimeout(() => {
                    const scrollTop = currentIndex * 48 - 96;
                    valuePicker.scrollTop = scrollTop;
                    console.log('滚动到位置:', scrollTop);
                }, 100);
            } else {
                // 如果当前值不在列表中，默认显示5.0
                const defaultIndex = values.findIndex(v => parseFloat(v) === 5.0);
                if (defaultIndex >= 0) {
                    selectedValue.textContent = '5.0';
                    setTimeout(() => {
                        const valueItems = document.querySelectorAll('.value-item');
                        valueItems.forEach((item, i) => {
                            if (i === defaultIndex) {
                                item.classList.add('selected');
                            } else {
                                item.classList.remove('selected');
                            }
                        });
                    }, 10);

                    setTimeout(() => {
                        valuePicker.scrollTop = defaultIndex * 48 - 96;
                    }, 100);
                }
            }

            modal.style.display = 'flex';
            console.log('数值选择器弹窗已显示');
        }

        // 选择数值并直接确认
        function selectValue(value, index) {
            console.log('选择数值函数调用:', value, '索引:', index);
            currentValueIndex = index;
            document.getElementById('selectedValue').textContent = value;

            // 更新选中状态
            const valueItems = document.querySelectorAll('.value-item');
            console.log('找到数值项数量:', valueItems.length);

            valueItems.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('selected');
                    console.log('设置选中状态:', value);
                } else {
                    item.classList.remove('selected');
                }
            });

            console.log('当前显示的选中值:', document.getElementById('selectedValue').textContent);

            // 添加短暂延迟，让用户看到选中效果后确认
            setTimeout(() => {
                confirmValueSelection();
            }, 150);
        }

        // 关闭数值选择器
        function closeValuePicker() {
            document.getElementById('valuePickerModal').style.display = 'none';
            currentEditingInput = null;
        }

        // 确认数值选择
        function confirmValueSelection() {
            console.log('确认数值选择被调用');
            console.log('当前编辑的输入框:', currentEditingInput);

            const selectedValue = document.getElementById('selectedValue').textContent;
            console.log('选择的数值:', selectedValue);

            if (currentEditingInput) {
                // 设置输入框的值
                currentEditingInput.value = selectedValue;
                console.log('输入框值已设置为:', currentEditingInput.value);

                // 添加视觉反馈
                currentEditingInput.style.backgroundColor = '#dbeafe';
                setTimeout(() => {
                    currentEditingInput.style.backgroundColor = '';
                }, 300);

                // 更新对应的显示值
                updateTargetValueDisplay();
                console.log('目标值显示已更新');

                // 显示成功提示
                showSuccessMessage('数值已更新: ' + selectedValue);
            } else {
                console.error('没有正在编辑的输入框，尝试备用方案');

                // 备用方案：检查最后点击的输入框
                const allInputs = document.querySelectorAll('input[readonly]');
                let lastClickedInput = null;

                allInputs.forEach(input => {
                    if (input.dataset && input.dataset.clicked === 'true') {
                        lastClickedInput = input;
                    }
                });

                if (lastClickedInput) {
                    lastClickedInput.value = selectedValue;
                    updateTargetValueDisplay();
                    showSuccessMessage('数值已更新: ' + selectedValue);
                    console.log('使用备用方案更新成功');
                } else {
                    alert('请先选择一个输入框进行编辑');
                    return; // 不关闭弹窗，让用户重新选择
                }
            }

            // 关闭弹窗
            closeValuePicker();
        }

        // 更新目标值显示
        function updateTargetValueDisplay() {
            for (let i = 1; i <= 5; i++) {
                const minInput = document.getElementById('target-input-' + i + '-min');
                const maxInput = document.getElementById('target-input-' + i + '-max');
                const valueSpan = document.getElementById('target-value-' + i);

                if (minInput && maxInput && valueSpan) {
                    const minValue = minInput.value;
                    const maxValue = maxInput.value;
                    valueSpan.textContent = `${minValue}-${maxValue}`;
                }
            }
        }

        // 保存血糖目标
        function saveTargets() {
            // 更新所有目标值显示
            updateTargetValueDisplay();

            // 退出编辑模式
            toggleEditMode();

            // 显示保存成功提示
            showSuccessMessage('血糖目标已保存');
        }

        // 添加触摸滑动支持
        function setupTouchScroll() {
            const valuePicker = document.getElementById('valuePicker');
            if (!valuePicker) return;

            let startY = 0;
            let scrollTop = 0;
            let isScrolling = false;

            valuePicker.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                scrollTop = valuePicker.scrollTop;
                isScrolling = true;
            });

            valuePicker.addEventListener('touchmove', (e) => {
                if (!isScrolling) return;

                const currentY = e.touches[0].clientY;
                const deltaY = startY - currentY;
                valuePicker.scrollTop = scrollTop + deltaY;
                e.preventDefault();
            });

            valuePicker.addEventListener('touchend', () => {
                isScrolling = false;
                updateSelectedValueFromScroll();
            });

            // 鼠标滚轮支持
            valuePicker.addEventListener('scroll', () => {
                updateSelectedValueFromScroll();
            });
        }

        // 根据滚动位置更新选中的数值
        function updateSelectedValueFromScroll() {
            const valuePicker = document.getElementById('valuePicker');
            const scrollTop = valuePicker.scrollTop;
            const itemHeight = 48;
            const centerOffset = 96; // 居中偏移

            const index = Math.round((scrollTop + centerOffset) / itemHeight);
            const valueItems = document.querySelectorAll('.value-item');

            if (index >= 0 && index < valueItems.length) {
                const value = valueItems[index].textContent;

                // 只更新显示和选中状态，不触发确认
                currentValueIndex = index;
                document.getElementById('selectedValue').textContent = value;

                // 更新选中状态
                valueItems.forEach((item, i) => {
                    if (i === index) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                });

                console.log('滚动更新选中值:', value);
            }
        }

        // 显示成功消息
        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // 联系客服函数
        function contactCustomerService() {
            // 模拟联系客服功能
            const customerServicePhone = '400-123-4567';
            const customerServiceTime = '工作日 9:00-18:00';
            if (confirm(`客服电话：${customerServicePhone}\n服务时间：${customerServiceTime}\n\n是否拨打电话联系客服？`)) {
                // 在实际应用中，这里可以调用拨号功能
                alert(`正在拨打客服电话：${customerServicePhone}`);
            }
        }

        /**
         * 导航到血糖智能设备页面
         */
        function navigateToBloodSugarDevice() {
            // 触觉反馈
            if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                MedicalApp.HapticManager.impact('light');
            }

            // 如果在iframe中，发送消息给父页面
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'navigateToPage',
                    page: 'blood_sugar_device'
                }, '*');
            } else {
                // 直接导航到血糖智能设备页面
                window.location.href = 'blood_sugar_device.html';
            }
        }
    </script>

    <!-- 全局错误处理 -->
    <script>
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.message);
            // 阻止错误弹窗，但不影响页面显示
            return true;
        });

        // 安全的getElementById包装函数
        function safeGetElement(id) {
            return document.getElementById(id);
        }

        // 安全的textContent设置函数
        function safeSetText(id, text) {
            const element = document.getElementById(id);
            if (element && text !== undefined && text !== null) {
                element.textContent = text;
            }
            return element;
        }
        // 安全的震动函数（避免iframe中的跨域限制）
        function safeVibrate(duration) {
            try {
                // 检查是否支持震动API
                if (navigator.vibrate && window.self === window.top) {
                    navigator.vibrate(duration);
                }
            } catch (e) {
                // 忽略震动API错误
                console.debug('Vibrate not available:', e.message);
            }
        }

    </script>
</body>
</html>