<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡€å‹è®°å½•ç»“æœ - æ§ç³–åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Markdownæ¸²æŸ“åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- ä»£ç é«˜äº®åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        /* ç³–å°¿ç—…æ§ç³–ç®¡ç†å¹³å° - ç»Ÿä¸€æ ·å¼æ–‡ä»¶ */

        /* æ ¹æ®UI_design.mdçš„è®¾è®¡è§„åˆ™å®šä¹‰é¢œè‰² */
        /* ä¸»è‰²è°ƒ */
        .primary-color { color: #3b82f6; }
        .primary-dark { color: #2563eb; }
        .secondary-color { color: #f97316; }
        .secondary-dark { color: #ea580c; }
        
        /* åŒ»ç–—ä¸»é¢˜è‰²å½© */
        .medical-blue { color: #3b82f6; }
        .medical-green { color: #22c55e; }
        .medical-red { color: #ef4444; }
        .medical-orange { color: #f59e0b; }
        .medical-purple { color: #8b5cf6; }
        
        /* ä¸­æ€§è‰² */
        .gray-50 { color: #f9fafb; }
        .gray-100 { color: #f3f4f6; }
        .gray-200 { color: #e5e7eb; }
        .gray-300 { color: #d1d5db; }
        .gray-400 { color: #9ca3af; }
        .gray-500 { color: #6b7280; }
        .gray-600 { color: #4b5563; }
        .gray-700 { color: #374151; }
        .gray-800 { color: #1f2937; }
        .gray-900 { color: #111827; }

        /* éšè—æ‰€æœ‰æ»šåŠ¨æ¡ */
        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        *::-webkit-scrollbar {
            display: none;
        }

        /* è¡€å‹ç»“æœåŒåœ†ç¯æ ·å¼ */
        .blood-pressure-result-container {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .blood-pressure-result-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            position: relative;
        }

        .blood-pressure-result-circle.systolic {
            background: conic-gradient(from -90deg, #ef4444 0deg 216deg, #e5e7eb 216deg 360deg);
        }

        .blood-pressure-result-circle.diastolic {
            background: conic-gradient(from -90deg, #3b82f6 0deg 216deg, #e5e7eb 216deg 360deg);
        }

        .blood-pressure-result-circle::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            background: white;
            border-radius: 50%;
        }

        .blood-pressure-display {
            text-align: center;
            margin-top: 16px;
        }

        .pressure-values {
            font-size: 32px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 8px;
        }

        .pressure-unit {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 16px;
        }

        .pressure-labels {
            display: flex;
            justify-content: center;
            gap: 48px;
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }

        .systolic-label {
            color: #dc2626;
            font-weight: 600;
        }

        .diastolic-label {
            color: #2563eb;
            font-weight: 600;
        }

        /* å¿ƒç‡æ˜¾ç¤º */
        .heart-rate-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
            padding: 8px 16px;
            background: #f3f4f6;
            border-radius: 16px;
            display: inline-flex;
        }

        .heart-rate-icon {
            color: #ef4444;
            font-size: 16px;
        }

        .heart-rate-value {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }

        /* å¤šåª’ä½“æŠ¥å‘Šå¡ç‰‡æ ·å¼ */
        .medical-report-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .report-content {
            line-height: 1.6;
        }

        .report-content h1, .report-content h2, .report-content h3 {
            color: #374151;
            margin-bottom: 12px;
            margin-top: 0px;
        }

        .report-content h1 { font-size: 24px; font-weight: 700; }
        .report-content h2 { font-size: 16px; font-weight: 600; }
        .report-content h3 { font-size: 18px; font-weight: 600; }

        .report-content p {
            margin-bottom: 12px;
            color: #374151;
        }

        .report-content ul, .report-content ol {
            margin-bottom: 12px;
            padding-left: 20px;
        }

        .report-content li {
            margin-bottom: 4px;
            color: #374151;
        }

        .report-content blockquote {
            border-left: 4px solid #3b82f6;
            padding-left: 16px;
            margin: 16px 0;
            background: #f9fafb;
            padding: 12px 16px;
            border-radius: 8px;
        }

        .report-content code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .report-content pre {
            background: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .media-container {
            margin: 16px 0;
            border-radius: 12px;
            overflow: hidden;
        }

        .media-image {
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .media-video {
            width: 100%;
            height: 200px;
            border-radius: 12px;
        }

        .media-audio {
            width: 100%;
            margin: 8px 0;
        }

        .media-caption {
            text-align: center;
            font-size: 14px;
            color: #6b7280;
            margin-top: 8px;
            font-style: italic;
        }

        .report-section {
            margin-bottom: 24px;
        }

        .report-highlight {
            background: linear-gradient(135deg, #ef4444, #3b82f6);
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
        }

        .report-warning {
            background: #fef3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
        }

        .report-success {
            background: #d1f2eb;
            border: 1px solid #a3e4d7;
            color: #0e6b56;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
        }

        /* ä¸åŒç—‡çŠ¶çš„é¢œè‰² */
        .symptom-card.thirsty { background: #3b82f6; }
        .symptom-card.dry-skin { background: #f59e0b; }
        .symptom-card.frequent-urination { background: #ef4444; }
        .symptom-card.fatigue { background: #8b5cf6; }
        .symptom-card.hunger { background: #10b981; }
        .symptom-card.blurred-vision { background: #6366f1; }

        /* åé¦ˆæŒ‰é’®æ ·å¼ - ä¸è¡€ç³–é¡µé¢ä¿æŒä¸€è‡´ */
        .feedback-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #d1d5db;
            background: white;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-btn:hover {
            background: #e5e7eb;
            transform: scale(1.05);
        }

        .feedback-btn.active.like {
            background: #fb923c;
            border-color: #fb923c;
            color: white;
        }

        .feedback-btn.active.dislike {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }

  
        /* åŒ»ç”Ÿä¿¡æ¯åŒºåŸŸæ ·å¼ */
        .doctor-section {
            margin-bottom: 4px;
        }

        .doctor-info-row {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .doctor-info-row .doctor-avatar {
            width: 60px;
            height: 80px;
            border-radius: 8px;
            margin-right: 16px;
            border: 3px solid white;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }

        .doctor-info-row .doctor-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .doctor-info-row .doctor-info {
            flex: 1;
            text-align: left;
        }

        .doctor-info-row .doctor-name {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .doctor-info-row .doctor-title {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 8px;
        }

        .doctor-info-row .doctor-actions {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }

        .doctor-info-row .doctor-actions .consultation-btn {
            padding: 0px 0px;
            font-size: 12px;
            min-width: 80px;
            min-height: 30px;
        }

        /* åˆ†å‰²çº¿æ ·å¼ */
        .doctor-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
            margin: 16px 0;
        }

        /* åŒ»ç”Ÿæè¿°å®¹å™¨ */
        .doctor-description-container {
            padding: 0 4px;
        }

        .doctor-description-container .doctor-description {
            font-size: 14px;
            color: #64748b;
            line-height: 1.5;
            margin: 0;
            text-align: left;
        }

        .consultation-btn.text-btn {
            background: linear-gradient(135deg, #059669, #10b981);
            box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
        }

        .consultation-btn.video-btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            box-shadow: 0 4px 16px rgba(79, 70, 229, 0.3);
        }

        /* è¡€å‹çŠ¶æ€æ ·å¼ */
        .pressure-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 8px;
        }

        .pressure-status.normal {
            background: #dcfce7;
            color: #16a34a;
        }

        .pressure-status.high-normal {
            background: #fef3c7;
            color: #d97706;
        }

        .pressure-status.stage1 {
            background: #fed7d7;
            color: #dc2626;
        }

        .pressure-status.stage2 {
            background: #fecaca;
            color: #991b1b;
        }

        /* AIæé†’å¡ç‰‡æ ·å¼ - ä»¿é€šçŸ¥æ ·å¼ */
        .ai-reminder-card {
            background: white;
            border-radius: 16px;
            margin: 16px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            position: relative;
            border: 1px solid #e5e7eb;
        }

        .ai-reminder-header {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            position: relative;
        }

        .ai-avatar-container {
            width: 30%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-right: 12px;
        }

        .ai-avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .ai-avatar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="35" r="20" fill="%23ffffff" opacity="0.8"/><path d="M20 80 Q20 60 50 60 Q80 60 80 80 L80 100 L20 100 Z" fill="%23ffffff" opacity="0.8"/></svg>') center/cover;
        }

        .ai-reminder-content {
            width: 70%;
            padding-left: 4px;
        }

        .ai-reminder-title {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .ai-reminder-message {
            font-size: 14px;
            line-height: 1.4;
            color: #4b5563;
        }

        .close-button {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            background: rgba(107, 114, 128, 0.1);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-button:hover {
            background: rgba(107, 114, 128, 0.2);
        }

        .close-button i {
            font-size: 12px;
            color: #6b7280;
        }

        /* æŒ‰é’®æ ·å¼ */
        .action-button {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .secondary-button {
            background: #f97316;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 40px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .secondary-button:hover {
            background: #ea580c;
        }

        /* ç¡®ä¿ç§»åŠ¨ç«¯ä¸€æ’æ˜¾ç¤º */
        .feedback-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: nowrap;
            gap: 8px;
        }

        .feedback-buttons {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .feedback-text {
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* åˆ†å‰²çº¿æ ·å¼ */
        .section-divider {
            display: flex;
            align-items: center;
            margin: 24px 0;
            padding: 0 16px;
        }

        .divider-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
        }

        .divider-text {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 16px;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            color: #6b7280;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .divider-text i {
            color: #f59e0b;
            font-size: 12px;
        }

        /* äº’è”ç½‘åŒ»é™¢é—®è¯Šå¡ç‰‡æ ·å¼ */
        .online-consultation-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(148, 163, 184, 0.1);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .online-consultation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4f46e5, #06b6d4, #10b981);
        }

        .consultation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .consultation-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            box-shadow: 0 4px 16px rgba(79, 70, 229, 0.3);
        }

        .consultation-title {
            flex: 1;
            margin-left: 16px;
        }

        .consultation-title h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.2;
        }

        .consultation-title p {
            margin: 4px 0 0 0;
            font-size: 13px;
            color: #64748b;
            line-height: 1.2;
        }

        .consultation-status {
            display: flex;
            align-items: center;
        }

        .status-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            position: relative;
        }

        .status-badge::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            background: #ffffff;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .consultation-question {
            margin-bottom: 20px;
        }

        .question-bubble {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            border-left: 4px solid #4f46e5;
        }

        .question-icon {
            color: #4f46e5;
            margin-right: 12px;
            font-size: 16px;
        }

        .question-bubble span {
            color: #374151;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
        }

        .consultation-doctors {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding: 16px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .doctor-avatars {
            display: flex;
            align-items: center;
        }

        .doctor-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: -8px;
            border: 2px solid white;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .doctor-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .doctor-count {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .doctor-info {
            text-align: right;
        }

        .hospital-name {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 2px;
        }

        .doctor-rating {
            font-size: 11px;
            color: #64748b;
        }

        .consultation-action {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .consultation-btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 16px 24px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(79, 70, 229, 0.3);
            flex: 1;
            margin-right: 16px;
        }

        .consultation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(79, 70, 229, 0.4);
        }

        .consultation-btn:active {
            transform: translateY(0);
        }

        .btn-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .consultation-btn:hover .btn-shine {
            left: 100%;
        }

        .consultation-price {
            text-align: right;
        }

        .price-label {
            display: block;
            font-size: 12px;
            color: #64748b;
            margin-bottom: 2px;
        }

        .price-value {
            font-size: 18px;
            font-weight: 700;
            color: #dc2626;
        }

        /* æ¨èå¡ç‰‡æ ·å¼ */
        .recommendation-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .recommendation-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .recommendation-info {
            display: flex;
            align-items: center;
        }

        .recommendation-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
        }

        .recommendation-text {
            font-size: 14px;
            font-weight: 500;
            color: #1f2937;
        }

        .recommendation-subtitle {
            font-size: 12px;
            color: #6b7280;
            margin-top: 2px;
        }

        /* æµ®åŠ¨å¯¹è¯æ¡†æ ·å¼ - é“ºæ»¡å±å¹•èƒŒæ™¯ */
        .chat-float-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            /* å…¨å®½åº¦èƒŒæ™¯ */
            background: white;
            padding: 12px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            border: none;
            /* æ ¹æ®æ‰‹æœºè§’åº¦è®¾ç½®åœ†è§’ï¼šä¸‹æ–¹åœ†è§’ï¼Œä¸Šæ–¹ç›´è§’ */
            border-radius: 0px 0px 0 0;
            /* ç¡®ä¿åœ¨é¡¶éƒ¨ */
            transform: translateZ(0);
        }

        .chat-buttons-wrapper {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .chat-float {
            background: #667eea;
            color: white;
            padding: 14px 24px;
            border-radius: 32px;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex: 1;
            border: none;
            min-height: 48px;
        }

        /* å¾®ä¿¡ç»¿è‰²æ ·å¼ - ç¬¬ä¸€ä¸ªæŒ‰é’® */
        .chat-float.wechat-green {
            background: #07C160;
            box-shadow: 0 4px 16px rgba(7, 193, 96, 0.3);
        }

        .chat-float:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .chat-float.wechat-green:hover {
            box-shadow: 0 6px 20px rgba(7, 193, 96, 0.4);
        }

        .chat-float:active {
            transform: translateY(0);
        }

        .chat-float i {
            margin-right: 8px;
            font-size: 16px;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .medical-report-card {
                padding: 16px;
                margin-bottom: 16px;
            }

            .ai-reminder-header {
                padding: 14px;
            }

            .ai-avatar {
                width: 56px;
                height: 56px;
            }

            .consultation-action {
                flex-direction: column;
                gap: 12px;
            }

            .consultation-btn {
                margin-right: 0;
                width: 100%;
                justify-content: center;
            }

            .consultation-price {
                text-align: center;
                width: 100%;
            }

            .secondary-button {
                padding: 6px 10px;
                min-width: 36px;
                height: 32px;
                font-size: 12px;
            }

            .feedback-text {
                font-size: 12px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="bg-blue-500 text-white">
        <div class="flex justify-between items-center px-4 py-3">
            <!-- è¿”å›æŒ‰é’® -->
            <button onclick="goBack()" class="text-white">
                <i class="fas fa-chevron-left text-xl"></i>
            </button>

            <!-- æ ‡é¢˜ -->
            <div class="flex-1 text-center">
                <span class="text-white text-lg font-medium">ææ™“é£</span>
            </div>

            <!-- å³ä¾§æŒ‰é’® -->
            <button onclick="shareResult()" class="text-white">
                <i class="fas fa-share text-xl"></i>
            </button>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="px-4 py-6">

        <!-- è¡€å‹ç»“æœå±•ç¤º -->
        <div class="text-center mb-4">
            <div class="blood-pressure-result-container">
                <!-- æ”¶ç¼©å‹åœ†ç¯ -->
                <div class="blood-pressure-result-circle systolic">
                    <div class="absolute inset-0 flex flex-col items-center justify-center z-10">
                        <span id="systolicValue" class="text-xl font-bold text-red-600">120</span>
                        <span class="text-xs text-gray-500">æ”¶ç¼©å‹</span>
                    </div>
                </div>

                <!-- èˆ’å¼ å‹åœ†ç¯ -->
                <div class="blood-pressure-result-circle diastolic">
                    <div class="absolute inset-0 flex flex-col items-center justify-center z-10">
                        <span id="diastolicValue" class="text-xl font-bold text-blue-600">80</span>
                        <span class="text-xs text-gray-500">èˆ’å¼ å‹</span>
                    </div>
                </div>
            </div>

            <!-- å¿ƒç‡å’Œè®°å½•æ—¶é—´ -->
            <div class="mt-6">
                <div id="heartRateContainer" class="heart-rate-display mb-2">
                    <i class="fas fa-heartbeat heart-rate-icon"></i>
                    <span class="heart-rate-value">å¿ƒç‡: <span id="heartRateValue">72</span> bpm</span>
                </div>
                <div class="flex items-center justify-center space-x-2">
                    <div class="text-md text-gray-800 font-medium" id="recordDateTime">2025å¹´9æœˆ15æ—¥ 14:30</div>
                    <i onclick="navigateToBloodPressureDevice()" class="fas fa-mobile-alt text-blue-500 text-sm cursor-pointer hover:text-blue-600" title="è®¾å¤‡è®°å½•"></i>
                </div>
            </div>
        </div>

        <!-- ä¼˜å”åŒ»ç”Ÿæé†’ -->
        <div class="ai-reminder-card">
            <div class="ai-reminder-header">
                <!-- å·¦ä¾§å¤´åƒåŒºåŸŸ (30%) -->
                <div class="ai-avatar-container">
                    <div class="ai-avatar">
                        <!-- ä½¿ç”¨ SVG äººç‰©å¤´åƒ -->
                    </div>
                </div>

                <!-- å³ä¾§å†…å®¹åŒºåŸŸ (70%) -->
                <div class="ai-reminder-content">
                    <div class="ai-reminder-title">å°ä¼˜æç¤º</div>
                    <div class="ai-reminder-message">
                        ä»¥ä¸‹å†…å®¹åŸºäºä¼˜å”AIåŠ©æ‰‹ç”Ÿæˆçš„æ™ºèƒ½å¥åº·ç®¡ç†æ„è§ï¼Œä»…ä¾›å‚è€ƒã€‚
                    </div>
                </div>

                <!-- å…³é—­æŒ‰é’® -->
                <button class="close-button" onclick="closeReminder()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- å¤šåª’ä½“å¥åº·æŠ¥å‘Š -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">è¡€å‹AIåˆ†ææŠ¥å‘Š</h3>

            <!-- æŠ¥å‘Šå¡ç‰‡å®¹å™¨ -->
            <div class="medical-report-card">
                <div id="reportContent" class="report-content">
                    <!-- é»˜è®¤æ˜¾ç¤ºçš„AIæŠ¥å‘Šå†…å®¹ -->
                    <h2>æ£€æµ‹ç»“æœæ¦‚è¿°</h2>
                    <p>æ‚¨å¥½ï¼Œ<strong>dnurse_788013</strong>ï¼æ ¹æ®æœ¬æ¬¡è¡€å‹æ£€æµ‹ç»“æœï¼š</p>
                    <ul>
                        <li><strong>æ”¶ç¼©å‹</strong>ï¼š120 mm/Hgï¼ˆæ­£å¸¸èŒƒå›´ï¼š90-140ï¼‰</li>
                        <li><strong>èˆ’å¼ å‹</strong>ï¼š80 mm/Hgï¼ˆæ­£å¸¸èŒƒå›´ï¼š60-90ï¼‰</li>
                        <li><strong>è¡€å‹åˆ†çº§</strong>ï¼šæ­£å¸¸è¡€å‹</li>
                    </ul>
                    <blockquote>
                        <p>ğŸ’¡ <strong>åŒ»ç”Ÿæé†’</strong>ï¼šè§„å¾‹çš„è¡€å‹ç›‘æµ‹æ˜¯é«˜è¡€å‹ç®¡ç†çš„é‡è¦ç¯èŠ‚ï¼Œå»ºè®®å®šæœŸæµ‹é‡å¹¶è®°å½•è¡€å‹å˜åŒ–ã€‚</p>
                    </blockquote>
                    <div class="report-success">
                        <p>âœ… <strong>æ­å–œæ‚¨</strong>ï¼šæœ¬æ¬¡æ£€æµ‹ç»“æœè‰¯å¥½ï¼Œè¡€å‹æ§åˆ¶åœ¨ç†æƒ³èŒƒå›´å†…ï¼</p>
                    </div>

                    <h2>å¥åº·å»ºè®®</h2>
                    <h3>ğŸ§‚ é¥®é£Ÿå»ºè®®</h3>
                    <ul>
                        <li><strong>ä½é’ é¥®é£Ÿ</strong>ï¼šæ¯æ—¥ç›æ‘„å…¥é‡æ§åˆ¶åœ¨6å…‹ä»¥ä¸‹</li>
                        <li><strong>å¢åŠ é’¾æ‘„å…¥</strong>ï¼šå¤šé£Ÿç”¨é¦™è•‰ã€æ©™å­ç­‰å¯Œå«é’¾çš„æ°´æœ</li>
                        <li><strong>é™åˆ¶é¥±å’Œè„‚è‚ª</strong>ï¼šå‡å°‘æ²¹ç‚¸é£Ÿå“å’ŒåŠ¨ç‰©è„‚è‚ª</li>
                        <li><strong>DASHé¥®é£Ÿ</strong>ï¼šå¤šé£Ÿç”¨è”¬èœã€æ°´æœã€å…¨è°·ç‰©</li>
                    </ul>

                    <h3>ğŸƒâ€â™‚ï¸ è¿åŠ¨å»ºè®®</h3>
                    <ul>
                        <li><strong>å¿«èµ°</strong>ï¼šæ¯å¤©30åˆ†é’Ÿï¼Œä¸­ç­‰å¼ºåº¦</li>
                        <li><strong>æ¸¸æ³³</strong>ï¼šæ¯å‘¨3-4æ¬¡ï¼Œæ¯æ¬¡45åˆ†é’Ÿ</li>
                        <li><strong>éª‘è¡Œ</strong>ï¼šæ¯å‘¨2-3æ¬¡ï¼Œæœ‰åŠ©äºå¿ƒè¡€ç®¡å¥åº·</li>
                    </ul>

                    <h3>ğŸ’Š ç”¨è¯æŒ‡å¯¼</h3>
                    <ul>
                        <li><strong>æŒ‰æ—¶æœè¯</strong>ï¼šä¸è¦éšæ„åœè¯æˆ–æ›´æ”¹å‰‚é‡</li>
                        <li><strong>ç›‘æµ‹è¡€å‹</strong>ï¼šå®šæœŸæµ‹é‡è¡€å‹ï¼Œè®°å½•å˜åŒ–</li>
                        <li><strong>å‰¯ä½œç”¨è§‚å¯Ÿ</strong>ï¼šæ³¨æ„è§‚å¯Ÿè¯ç‰©ä¸è‰¯ååº”</li>
                        <li><strong>åŒ»æ‚£æ²Ÿé€š</strong>ï¼šå®šæœŸå¤è¯Šï¼ŒåŠæ—¶è°ƒæ•´æ²»ç–—æ–¹æ¡ˆ</li>
                    </ul>

                    <p style="margin-top: 16px; padding: 12px; background: #f0f9ff; border-left: 4px solid #0ea5e9; border-radius: 4px; color: #0c4a6e; font-size: 14px; font-style: italic;">
                        <i class="fas fa-info-circle" style="color: #0ea5e9; margin-right: 8px;"></i>
                        å†…å®¹ç”±AIç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒ
                    </p>
                </div>
            </div>
        </div>

        <!-- å°æŠ¤çš„å»ºè®® -->
        <div class="mb-6">
            <div class="feedback-row">
                <span class="feedback-text text-sm text-gray-600">å°ä¼˜çš„å»ºè®®æ˜¯å¦æœ‰å¸®åŠ©ï¼š</span>
                <div class="feedback-buttons">
                    <button class="feedback-btn" id="likeBtn" onclick="handleFeedback('like')">
                        <i class="far fa-thumbs-up"></i>
                    </button>
                    <button class="feedback-btn" id="dislikeBtn" onclick="handleFeedback('dislike')">
                        <i class="far fa-thumbs-down"></i>
                    </button>
                </div>
            </div>
            <!-- AIæŠ¥å‘Šå±•å¼€æ”¶èµ·æŒ‰é’®å·²åˆ é™¤ï¼Œæ‰€æœ‰å†…å®¹é»˜è®¤å…¨éƒ¨æ˜¾ç¤º -->
        </div>

        <!-- åˆ†å‰²çº¿ - çœ‹ä¸€çœ‹ï¼Œåšä¸€åš -->
        <div class="section-divider">
            <div class="divider-line"></div>
            <div class="divider-text">
                <i class="fas fa-lightbulb"></i>
                <span>çœ‹ä¸€çœ‹ï¼Œåšä¸€åš</span>
            </div>
            <div class="divider-line"></div>
        </div>

        <!-- æ™ºèƒ½æ¨è -->
        <div class="mb-24">
            <!-- äº’è”ç½‘åŒ»é™¢é—®è¯ŠæŒ‰é’® -->
            <div class="online-consultation-card">
                <div class="consultation-header">
                    <div class="consultation-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="consultation-title">
                        <h3>åœ¨çº¿é—®è¯Š</h3>
                        <p>ä¸“ä¸šåŒ»ç”ŸÂ·ç²¾å‡†æœåŠ¡</p>
                    </div>
                </div>

                <div class="consultation-question">
                    <div class="question-bubble">
                        <i class="fas fa-comment-dots question-icon"></i>
                        <span id="randomQuestion">"è¡€å‹é«˜äº†åº”è¯¥åƒä»€ä¹ˆè¯ï¼Ÿ"</span>
                    </div>
                </div>

                <!-- åŒ»ç”Ÿä¿¡æ¯åŒºåŸŸ -->
            <div class="doctor-section">
                <div class="doctor-info-row">
                    <div class="doctor-avatar">
                        <img src="../imgs/æ¬§é˜³å­˜.png" alt="æ¬§é˜³å­˜åŒ»ç”Ÿ">
                    </div>
                    <div class="doctor-info">
                        <h4 class="doctor-name">æ¬§é˜³å­˜</h4>
                        <p class="doctor-title">ä¸»ä»»åŒ»å¸ˆ</p>
                        <div class="doctor-actions">
                            <button class="consultation-btn text-btn" onclick="startTextConsultation()">
                                <i class="fas fa-comments"></i>
                                <span>å›¾æ–‡é—®è¯Š</span>
                                <div class="btn-shine"></div>
                            </button>
                            <button class="consultation-btn video-btn" onclick="startVideoConsultation()">
                                <i class="fas fa-video"></i>
                                <span>è§†é¢‘é—®è¯Š</span>
                                <div class="btn-shine"></div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- åˆ†å‰²çº¿ -->
                <div class="doctor-divider"></div>

                <!-- åŒ»ç”Ÿæè¿° -->
                <div class="doctor-description-container">
                    <p class="doctor-description">ç¡•å£«ç”Ÿå¯¼å¸ˆï¼ŒåŸæ±Ÿæ±‰å¤§å­¦ç¥ç»å†…ç§‘æ•™ç ”å®¤ä¸»ä»»å’Œæ­¦æ±‰å¸‚ç¬¬å…­åŒ»é™¢ç¥ç»å†…ç§‘ä¸»ä»»ï¼Œæ“…é•¿å¿ƒè„‘è¡€ç®¡ç–¾ç—…é¢„é˜²ã€æ²»ç–—ã€åº·å¤ï¼Œå„ç±»ç¥ç»ç—…å˜çš„ä¸´åºŠè¯Šç–—ã€‚</p>
                </div>
            </div>
            </div>

    </div>

    <!-- æµ®åŠ¨å¯¹è¯æ¡† - ç™½è‰²èƒŒæ™¯å¡ç‰‡ä¸Šçš„ä¸¤ä¸ªæŒ‰é’® -->
    <div class="chat-float-container">
        <div class="chat-buttons-wrapper">
            <div class="chat-float wechat-green" onclick="openChat()">
                <i class="fas fa-comments"></i>
                è”ç³»å®¢æœ
            </div>
            <div class="chat-float" onclick="openConsultation()">
                <i class="fas fa-user-md"></i>
                çº¿ä¸Šé—®è¯Š
            </div>
        </div>
    </div>

  
    <script>
        // é¡µé¢åˆå§‹åŒ–
        function initializePage() {
            // è·å–è¡€å‹è®°å½•æ•°æ®
            const urlParams = new URLSearchParams(window.location.search);
            const systolic = parseInt(urlParams.get('systolic')) || 120;
            const diastolic = parseInt(urlParams.get('diastolic')) || 80;
            const heartRate = urlParams.get('heartRate') ? parseInt(urlParams.get('heartRate')) : null;
            const dateTime = urlParams.get('dateTime') || '2025å¹´9æœˆ15æ—¥ 14:30';

            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('systolicValue').textContent = systolic;
            document.getElementById('diastolicValue').textContent = diastolic;
            document.getElementById('systolicDisplay').textContent = systolic;
            document.getElementById('diastolicDisplay').textContent = diastolic;
            document.getElementById('recordDateTime').textContent = dateTime;

            // æ˜¾ç¤ºå¿ƒç‡ï¼ˆä½¿ç”¨ä¼ å…¥çš„å€¼æˆ–é»˜è®¤å€¼ï¼‰
            if (heartRate) {
                document.getElementById('heartRateValue').textContent = heartRate;
            } else {
                // å¦‚æœæ²¡æœ‰ä¼ å…¥å¿ƒç‡å€¼ï¼Œä½¿ç”¨é»˜è®¤å€¼72
                document.getElementById('heartRateValue').textContent = '72';
            }
            document.getElementById('heartRateContainer').style.display = 'inline-flex';

            // æ ¹æ®è¡€å‹å€¼æ›´æ–°åœ†ç¯é¢œè‰²å’ŒçŠ¶æ€
            updatePressureStatus(systolic, diastolic);
        }

        // æ›´æ–°è¡€å‹çŠ¶æ€å’Œåœ†ç¯é¢œè‰²
        function updatePressureStatus(systolic, diastolic) {
            const systolicCircle = document.querySelector('.blood-pressure-result-circle.systolic');
            const diastolicCircle = document.querySelector('.blood-pressure-result-circle.diastolic');
            const statusElement = document.getElementById('pressureStatus');

            let status = 'normal';
            let statusText = 'æ­£å¸¸è¡€å‹';
            let statusClass = 'normal';
            let systolicColor = '#10b981';
            let diastolicColor = '#3b82f6';
            let percentage = 60;

            // è¡€å‹åˆ†çº§åˆ¤æ–­
            if (systolic >= 160 || diastolic >= 100) {
                status = 'stage2';
                statusText = 'é«˜è¡€å‹2çº§';
                statusClass = 'stage2';
                systolicColor = '#991b1b';
                diastolicColor = '#991b1b';
                percentage = 85;
            } else if (systolic >= 140 || diastolic >= 90) {
                status = 'stage1';
                statusText = 'é«˜è¡€å‹1çº§';
                statusClass = 'stage1';
                systolicColor = '#dc2626';
                diastolicColor = '#dc2626';
                percentage = 80;
            } else if (systolic >= 120 || diastolic >= 80) {
                status = 'high-normal';
                statusText = 'æ­£å¸¸é«˜å€¼';
                statusClass = 'high-normal';
                systolicColor = '#d97706';
                diastolicColor = '#d97706';
                percentage = 70;
            }

            // æ›´æ–°åœ†ç¯é¢œè‰²
            systolicCircle.style.background = `conic-gradient(from -90deg, ${systolicColor} 0deg ${percentage * 3.6}deg, #e5e7eb ${percentage * 3.6}deg 360deg)`;
            diastolicCircle.style.background = `conic-gradient(from -90deg, ${diastolicColor} 0deg ${percentage * 3.6}deg, #e5e7eb ${percentage * 3.6}deg 360deg)`;

            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            statusElement.className = `pressure-status ${statusClass}`;
            statusElement.querySelector('span').textContent = statusText;

            // æ›´æ–°å›¾æ ‡
            const icon = statusElement.querySelector('i');
            if (status === 'normal') {
                icon.className = 'fas fa-check-circle';
            } else if (status === 'high-normal') {
                icon.className = 'fas fa-exclamation-triangle';
            } else {
                icon.className = 'fas fa-exclamation-circle';
            }
        }

        // è¿”å›åŠŸèƒ½
        function goBack() {
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'navigate',
                    page: 'home'
                }, '*');
            } else {
                window.location.href = 'home.html';
            }
        }

        // åˆ†äº«ç»“æœ
        function shareResult() {
            const systolic = document.getElementById('systolicDisplay').textContent;
            const diastolic = document.getElementById('diastolicDisplay').textContent;

            if (navigator.share) {
                navigator.share({
                    title: 'æˆ‘çš„è¡€å‹è®°å½•',
                    text: `è¡€å‹ï¼š${systolic}/${diastolic} mm/Hg`,
                    url: window.location.href
                });
            } else {
                alert('åˆ†äº«åŠŸèƒ½æš‚ä¸æ”¯æŒ');
            }
        }

        // æ‰“å¼€èŠå¤©
        function openChat() {
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'navigate',
                    page: 'chat'
                }, '*');
            } else {
                window.location.href = 'chat.html';
            }
        }

        // å…³é—­æé†’å¡ç‰‡
        function closeReminder() {
            const reminderCard = document.querySelector('.ai-reminder-card');
            reminderCard.style.transition = 'all 0.3s ease';
            reminderCard.style.transform = 'translateX(100%)';
            reminderCard.style.opacity = '0';

            setTimeout(() => {
                reminderCard.style.display = 'none';
            }, 300);
        }

        // æ‰“å¼€çº¿ä¸Šé—®è¯Š
        function openConsultation() {
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'navigate',
                    page: 'consultation'
                }, '*');
            } else {
                window.location.href = 'consultation.html';
            }
        }

        // å¤šåª’ä½“æŠ¥å‘Šå†…å®¹æ¸²æŸ“å‡½æ•°
        function renderReportContent() {
            // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰å†…å®¹ï¼Œå¦‚æœæœ‰å°±ä¸è¦†ç›–
            const reportContainer = document.getElementById('reportContent');
            if (!reportContainer) {
                console.error('æ‰¾ä¸åˆ°æŠ¥å‘Šå®¹å™¨å…ƒç´ ');
                return;
            }

            // å¦‚æœå·²ç»æœ‰å†…å®¹ï¼Œå°±ä¸å†é‡æ–°æ¸²æŸ“ï¼Œè®©HTMLä¸­çš„é»˜è®¤å†…å®¹æ˜¾ç¤º
            if (reportContainer.innerHTML.trim().length > 50) {
                console.log('AIæŠ¥å‘Šä½¿ç”¨HTMLé»˜è®¤å†…å®¹');
                return;
            }

            try {
                const summaryMarkdown = `
## æ£€æµ‹ç»“æœæ¦‚è¿°

æ‚¨å¥½ï¼Œ**dnurse_788013**ï¼æ ¹æ®æœ¬æ¬¡è¡€å‹æ£€æµ‹ç»“æœï¼š

- **æ”¶ç¼©å‹**ï¼š120 mm/Hgï¼ˆæ­£å¸¸èŒƒå›´ï¼š90-140ï¼‰
- **èˆ’å¼ å‹**ï¼š80 mm/Hgï¼ˆæ­£å¸¸èŒƒå›´ï¼š60-90ï¼‰
- **è¡€å‹åˆ†çº§**ï¼šæ­£å¸¸è¡€å‹

> ğŸ’¡ **åŒ»ç”Ÿæé†’**ï¼šè§„å¾‹çš„è¡€å‹ç›‘æµ‹æ˜¯é«˜è¡€å‹ç®¡ç†çš„é‡è¦ç¯èŠ‚ï¼Œå»ºè®®å®šæœŸæµ‹é‡å¹¶è®°å½•è¡€å‹å˜åŒ–ã€‚

<div class="report-success">
âœ… **æ­å–œæ‚¨**ï¼šæœ¬æ¬¡æ£€æµ‹ç»“æœè‰¯å¥½ï¼Œè¡€å‹æ§åˆ¶åœ¨ç†æƒ³èŒƒå›´å†…ï¼
</div>
`;

                // æ£€æŸ¥markedåº“æ˜¯å¦å¯ç”¨
                if (typeof marked !== 'undefined' && marked.parse) {
                    const summaryHtml = marked.parse(summaryMarkdown);
                    reportContainer.innerHTML = summaryHtml;
                    console.log('AIæŠ¥å‘Šå†…å®¹å·²æˆåŠŸæ¸²æŸ“');
                } else {
                    console.warn('markedåº“æœªåŠ è½½ï¼Œä¿æŒHTMLé»˜è®¤å†…å®¹');
                }

            } catch (error) {
                console.error('æ¸²æŸ“æŠ¥å‘Šå†…å®¹æ—¶å‡ºé”™ï¼š', error);
                console.log('ä¿æŒHTMLé»˜è®¤å†…å®¹æ˜¾ç¤º');
            }
        }

        // å±•å¼€è¯¦æƒ…åŠŸèƒ½
        function expandDetails() {
            const reportContainer = document.getElementById('reportContent');
            const summaryMarkdown = `
# è¡€å‹æ£€æµ‹åˆ†ææŠ¥å‘Š

## æ£€æµ‹ç»“æœæ¦‚è¿°

æ‚¨å¥½ï¼Œ**dnurse_788013**ï¼æ ¹æ®æœ¬æ¬¡è¡€å‹æ£€æµ‹ç»“æœï¼š

- **æ”¶ç¼©å‹**ï¼š120 mm/Hgï¼ˆæ­£å¸¸èŒƒå›´ï¼š90-140ï¼‰
- **èˆ’å¼ å‹**ï¼š80 mm/Hgï¼ˆæ­£å¸¸èŒƒå›´ï¼š60-90ï¼‰
- **è¡€å‹åˆ†çº§**ï¼šæ­£å¸¸è¡€å‹

> ğŸ’¡ **åŒ»ç”Ÿæé†’**ï¼šè§„å¾‹çš„è¡€å‹ç›‘æµ‹æ˜¯é«˜è¡€å‹ç®¡ç†çš„é‡è¦ç¯èŠ‚ï¼Œå»ºè®®å®šæœŸæµ‹é‡å¹¶è®°å½•è¡€å‹å˜åŒ–ã€‚
`;

            const fullContent = summaryMarkdown + window.detailContent + `
<div class="report-success">
âœ… **æ­å–œæ‚¨**ï¼šæœ¬æ¬¡æ£€æµ‹ç»“æœè‰¯å¥½ï¼Œè¡€å‹æ§åˆ¶åœ¨ç†æƒ³èŒƒå›´å†…ï¼
</div>
`;

            const htmlContent = marked.parse(fullContent);
            reportContainer.innerHTML = htmlContent;

            // å¤„ç†æ‰€æœ‰åª’ä½“å…ƒç´ 
            processMediaElements(reportContainer);

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateToggleButton(true);
        }

        // æ”¶èµ·è¯¦æƒ…åŠŸèƒ½
        function collapseDetails() {
            renderReportContent(); // é‡æ–°æ¸²æŸ“æ¦‚è¿°å†…å®¹
            updateToggleButton(false);
        }

        // æ›´æ–°å±•å¼€/æ”¶èµ·æŒ‰é’®
        function updateToggleButton(isExpanded) {
            const toggleButton = document.querySelector('.feedback-toggle-btn');
            if (isExpanded) {
                toggleButton.textContent = 'æ”¶èµ·è¯¦æƒ…';
                toggleButton.onclick = collapseDetails;
            } else {
                toggleButton.textContent = 'å±•å¼€è¯¦æƒ…';
                toggleButton.onclick = expandDetails;
            }
        }

        // å¤„ç†åª’ä½“å…ƒç´ çš„é€šç”¨å‡½æ•°
        function processMediaElements(container) {
            // å¤„ç†å›¾ç‰‡
            const images = container.querySelectorAll('img');
            images.forEach(img => {
                const mediaContainer = document.createElement('div');
                mediaContainer.className = 'media-container';

                const newImg = document.createElement('img');
                newImg.src = img.src;
                newImg.alt = img.alt;
                newImg.className = 'media-image';

                const caption = document.createElement('div');
                caption.className = 'media-caption';
                caption.textContent = img.alt;

                mediaContainer.appendChild(newImg);
                mediaContainer.appendChild(caption);

                img.parentNode.replaceChild(mediaContainer, img);
            });

            // å¤„ç†è§†é¢‘
            const videos = container.querySelectorAll('video');
            videos.forEach(video => {
                const mediaContainer = document.createElement('div');
                mediaContainer.className = 'media-container';

                const newVideo = document.createElement('video');
                newVideo.src = video.src;
                newVideo.poster = video.poster;
                newVideo.controls = true;
                newVideo.className = 'media-video';

                const caption = document.createElement('div');
                caption.className = 'media-caption';
                caption.textContent = 'è§†é¢‘ï¼šé«˜è¡€å‹ç®¡ç†ä¸“å®¶è®²è§£';

                mediaContainer.appendChild(newVideo);
                mediaContainer.appendChild(caption);

                video.parentNode.replaceChild(mediaContainer, video);
            });

            // å¤„ç†éŸ³é¢‘
            const audios = container.querySelectorAll('audio');
            audios.forEach(audio => {
                const mediaContainer = document.createElement('div');
                mediaContainer.className = 'media-container';

                const newAudio = document.createElement('audio');
                newAudio.src = audio.src;
                newAudio.controls = true;
                newAudio.className = 'media-audio';

                const caption = document.createElement('div');
                caption.className = 'media-caption';
                caption.textContent = 'éŸ³é¢‘ï¼šæ·±å‘¼å¸æ”¾æ¾æŒ‡å¯¼';

                mediaContainer.appendChild(newAudio);
                mediaContainer.appendChild(caption);

                audio.parentNode.replaceChild(mediaContainer, audio);
            });

            // ä»£ç é«˜äº®
            if (typeof hljs !== 'undefined') {
                hljs.highlightAll();
            }
        }

        // è¡€å‹ç›¸å…³é—®é¢˜åˆ—è¡¨
        const randomQuestions = [
            "è¡€å‹é«˜äº†åº”è¯¥åƒä»€ä¹ˆè¯ï¼Ÿ",
            "é«˜è¡€å‹æ‚£è€…èƒ½å–é…’å—ï¼Ÿ",
            "è¡€å‹æ­£å¸¸äº†å¯ä»¥åœè¯å—ï¼Ÿ",
            "é«˜è¡€å‹å¦‚ä½•é¥®é£Ÿè°ƒç†ï¼Ÿ",
            "è¡€å‹å¿½é«˜å¿½ä½æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ",
            "é«˜è¡€å‹ä¼šé—ä¼ å—ï¼Ÿ",
            "è¡€å‹é«˜æ€ä¹ˆå¿«é€Ÿé™ä¸‹æ¥ï¼Ÿ",
            "é«˜è¡€å‹æ‚£è€…èƒ½è¿åŠ¨å—ï¼Ÿ",
            "é«˜è¡€å‹å’Œç³–å°¿ç—…æœ‰å…³ç³»å—ï¼Ÿ",
            "è¡€å‹è®¡æ€ä¹ˆé€‰æ‹©å’Œä½¿ç”¨ï¼Ÿ"
        ];

        // å½“å‰é—®é¢˜ç´¢å¼•
        let currentQuestionIndex = 0;

        // æ˜¾ç¤ºéšæœºé—®é¢˜ï¼ˆè½®æ’­æ–¹å¼ï¼‰
        function showRandomQuestion() {
            const questionElement = document.getElementById('randomQuestion');
            questionElement.textContent = `"${randomQuestions[currentQuestionIndex]}"`;
            currentQuestionIndex = (currentQuestionIndex + 1) % randomQuestions.length;
        }

        // å¯åŠ¨é—®é¢˜è½®æ’­ï¼ˆæ¯2ç§’åˆ‡æ¢ä¸€æ¬¡ï¼‰
        function startQuestionRotation() {
            // ç«‹å³æ˜¾ç¤ºç¬¬ä¸€ä¸ªé—®é¢˜
            showRandomQuestion();
            // æ¯2ç§’åˆ‡æ¢ä¸€æ¬¡é—®é¢˜
            setInterval(showRandomQuestion, 2000);
        }

        // å›¾æ–‡é—®è¯ŠåŠŸèƒ½
        function startTextConsultation() {
            // è§¦è§‰åé¦ˆ
            if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                MedicalApp.HapticManager.selection();
            }

            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                MedicalApp.NotificationManager.info('æ­£åœ¨å¯åŠ¨å›¾æ–‡é—®è¯Š...');
            }

            // æ¨¡æ‹Ÿè·³è½¬åˆ°å›¾æ–‡é—®è¯Šé¡µé¢
            setTimeout(() => {
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'navigate',
                        page: 'text-consultation'
                    }, '*');
                } else {
                    alert('å›¾æ–‡é—®è¯ŠåŠŸèƒ½å³å°†å¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼');
                }
            }, 500);
        }

        // è§†é¢‘é—®è¯ŠåŠŸèƒ½
        function startVideoConsultation() {
            // è§¦è§‰åé¦ˆ
            if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                MedicalApp.HapticManager.selection();
            }

            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                MedicalApp.NotificationManager.info('æ­£åœ¨å¯åŠ¨è§†é¢‘é—®è¯Š...');
            }

            // æ¨¡æ‹Ÿè·³è½¬åˆ°è§†é¢‘é—®è¯Šé¡µé¢
            setTimeout(() => {
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'navigate',
                        page: 'video-consultation'
                    }, '*');
                } else {
                    alert('è§†é¢‘é—®è¯ŠåŠŸèƒ½å³å°†å¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼');
                }
            }, 500);
        }

        // åé¦ˆå¤„ç†åŠŸèƒ½
        let feedbackState = {
            like: false,
            dislike: false
        };

        // å¤„ç†ç”¨æˆ·åé¦ˆ
        function handleFeedback(type) {
            // è§¦è§‰åé¦ˆ
            if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                MedicalApp.HapticManager.selection();
            }

            const likeBtn = document.getElementById('likeBtn');
            const dislikeBtn = document.getElementById('dislikeBtn');

            if (type === 'like') {
                // åˆ‡æ¢ç‚¹èµçŠ¶æ€
                feedbackState.like = !feedbackState.like;
                feedbackState.dislike = false; // å–æ¶ˆä¸å–œæ¬¢çŠ¶æ€

                if (feedbackState.like) {
                    likeBtn.classList.add('active', 'like');
                    likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i>';

                    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                        MedicalApp.NotificationManager.success('æ„Ÿè°¢æ‚¨çš„ç‚¹èµï¼');
                    }
                } else {
                    likeBtn.classList.remove('active', 'like');
                    likeBtn.innerHTML = '<i class="far fa-thumbs-up"></i>';
                }

                dislikeBtn.classList.remove('active', 'dislike');
                dislikeBtn.innerHTML = '<i class="far fa-thumbs-down"></i>';

            } else if (type === 'dislike') {
                // åˆ‡æ¢ä¸å–œæ¬¢çŠ¶æ€
                feedbackState.dislike = !feedbackState.dislike;
                feedbackState.like = false; // å–æ¶ˆç‚¹èµçŠ¶æ€

                if (feedbackState.dislike) {
                    dislikeBtn.classList.add('active', 'dislike');
                    dislikeBtn.innerHTML = '<i class="fas fa-thumbs-down"></i>';

                    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    if (typeof MedicalApp !== 'undefined' && MedicalApp.NotificationManager) {
                        MedicalApp.NotificationManager.info('å·²è®°å½•æ‚¨çš„åé¦ˆ');
                    }
                } else {
                    dislikeBtn.classList.remove('active', 'dislike');
                    dislikeBtn.innerHTML = '<i class="far fa-thumbs-down"></i>';
                }

                likeBtn.classList.remove('active', 'like');
                likeBtn.innerHTML = '<i class="far fa-thumbs-up"></i>';
            }
        }

    
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            renderReportContent();
            startQuestionRotation(); // å¯åŠ¨é—®é¢˜è½®æ’­
        });

        /**
         * å¯¼èˆªåˆ°è¡€å‹æ™ºèƒ½è®¾å¤‡é¡µé¢
         */
        function navigateToBloodPressureDevice() {
            // è§¦è§‰åé¦ˆ
            if (typeof MedicalApp !== 'undefined' && MedicalApp.HapticManager) {
                MedicalApp.HapticManager.impact('light');
            }

            // å¦‚æœåœ¨iframeä¸­ï¼Œå‘é€æ¶ˆæ¯ç»™çˆ¶é¡µé¢
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'navigateToPage',
                    page: 'blood_pressure_device'
                }, '*');
            } else {
                // ç›´æ¥å¯¼èˆªåˆ°è¡€å‹æ™ºèƒ½è®¾å¤‡é¡µé¢
                window.location.href = 'blood_pressure_device.html';
            }
        }
    </script>

    <!-- å…¨å±€é”™è¯¯å¤„ç† -->
    <script>
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.message);
            // é˜»æ­¢é”™è¯¯å¼¹çª—ï¼Œä½†ä¸å½±å“é¡µé¢æ˜¾ç¤º
            return true;
        });

        // å®‰å…¨çš„getElementByIdåŒ…è£…å‡½æ•°
        function safeGetElement(id) {
            return document.getElementById(id);
        }

        // å®‰å…¨çš„textContentè®¾ç½®å‡½æ•°
        function safeSetText(id, text) {
            const element = document.getElementById(id);
            if (element && text !== undefined && text !== null) {
                element.textContent = text;
            }
            return element;
        }
        // å®‰å…¨çš„éœ‡åŠ¨å‡½æ•°ï¼ˆé¿å…iframeä¸­çš„è·¨åŸŸé™åˆ¶ï¼‰
        function safeVibrate(duration) {
            try {
                // æ£€æŸ¥æ˜¯å¦æ”¯æŒéœ‡åŠ¨API
                if (navigator.vibrate && window.self === window.top) {
                    navigator.vibrate(duration);
                }
            } catch (e) {
                // å¿½ç•¥éœ‡åŠ¨APIé”™è¯¯
                console.debug('Vibrate not available:', e.message);
            }
        }

    </script>
</body>
</html>